{"version":3,"file":"js/exposed-./IntegrationsWizard.xxxxxxxxxxxxxxxxxxxx.js","mappings":"6UA6CO,MAAMA,EAET,EACFC,SACAC,SACAC,WACAC,cACAC,aACAC,eAEA,MAAMC,EAAkB,CACtB,CAAC,MAAS,IACV,CAAC,MAAc,IACf,CAAC,MAAe,IAChB,CAAC,MAAmB,IACpB,CAAC,MAAgB,KAEbC,GAA0B,IAAAC,SAC9B,8CAEIC,GAAqB,IAAAD,SAAQ,oCAC7BE,GAAgB,UACfC,EAAYC,GAAiB,WAAwBZ,GAK5D,OAJA,aAAgB,KACdY,EAAcZ,EAAO,GACpB,CAACA,IAGF,gBAAC,WAAc,KACZW,GACC,gBAAC,IAAY,CACXE,QAAQ,OACNR,EACAJ,EACAM,EACAE,GAEFK,gBAAiB,IAAK,QAAoBR,GAC1CS,SAAU,EACRC,MACA,CAAC,MAAmBC,EACpBC,OACA,eAAgBC,EAChB,oBAAqBC,EACrBC,eAEA,MAAOC,EAAMC,IAAYN,aAAO,EAAPA,EAASO,MAAM,OAAQ,CAAC,WAC3CC,EAAO,CACXP,OACAQ,SAAS,EACTJ,UACIC,GAAY,CAAEA,YAClBI,YAAa,GACbC,WAAY,CACVC,OAAQ,OACRb,MACAc,0BAA0B,EAC1BX,eACAE,eAEEd,GAA2B,CAC7Ba,YAAaA,EACTW,OAAOC,OAAOZ,GAAuBa,QAAQF,OAAOG,MACpD,KAGRjC,IAAUC,aAAQ,EAARA,EAAUiC,KAChB,QACEjC,aAAQ,EAARA,EAAUiC,GACVV,OACAW,EACA1B,EACAP,IAEF,QAAesB,EAAMf,EAAeP,GACxCC,GAAY,EAEdiC,cACEpC,EACI,IACKC,EACH,eAAgBA,aAAQ,EAARA,EAAUoC,aAE5B,CAAC,EAEPC,SAAUnC,IAERoC,GAAU,gBAAC,KAAe,IAAKA,EAAOC,kBAAkB,MAIjE,EAeH,EAVI,EAAGC,WAAUF,KACRE,EACL,gBAAC,EAAAC,SAAQ,CAACD,MAAOA,GACf,gBAAC3C,EAAiB,IAAKyC,KAGzB,gBAACzC,EAAiB,IAAKyC,G,gFCpGpB,MAAMI,EAAkBC,GAC7BA,EAAOvB,OAASwB,EAAiBC,oBACjCF,EAAOvB,OAASwB,EAAiBE,OAEtBC,EACXJ,GACgCA,EAAOvB,OAASwB,EAAiBI,YAEnE,IAAYJ,EAkDL,SAASK,EACdvB,GAEA,OAAOA,EAAWN,OAASwB,EAAiBC,kBAC9C,CAEO,SAASK,EACdxB,GAEA,OAAOA,EAAWN,OAASwB,EAAiBE,MAC9C,EA5DA,SAAYF,GACV,0CACA,kBACA,2BACD,CAJD,CAAYA,IAAAA,EAAgB,KA8D5B,MAAMO,EACJC,GAEOA,EACJC,KAAKV,QACWT,IAAXS,EACK,MAACT,GAGNS,EAAOvB,OAASwB,EAAiBI,YAC5B,CAACL,EAAOW,YAAYrB,IAEpBU,EAAOY,UAAUF,KAAKG,GAAMA,EAAEC,kBAGxCC,OAGQC,EAAkB,CAC7BC,EACAC,KAEA,GAAID,EAASE,SAAWD,EAASC,OAC/B,OAAO,EAGT,MAAMC,EAAgBZ,EAAkBS,GAClCI,EAAgBb,EAAkBU,GAExC,OAAIE,EAAcD,SAAWE,EAAcF,QAKpCC,EAAcE,OAAM,CAACC,EAAKC,IAAUD,IAAQF,EAAcG,IAAO,C,sDCrJnE,MAAeC,EAGpB,YAAsBC,GACpBC,KAAKD,YAAcA,CACrB,EAMK,MAAME,UAA6BH,EAGxC,YAAmBd,GACjBkB,MAAMlB,EAAYtC,MAAQsC,EAAYmB,UAAY,GAAK,gBACvDH,KAAKhB,YAAcA,CACrB,CAEO,MAAAoB,GACL,OAAOJ,KAAKhB,YAAYrB,EAC1B,CAEO,MAAA0C,CAAOpB,GACZ,OAAIA,aAAqBgB,GAChBhB,EAAUD,YAAYrB,KAAOqC,KAAKhB,YAAYrB,EAIzD,EAGK,MAAe2C,UAAkCR,EAKtD,YACEC,EACA5C,EACAgC,EACAoB,GAEAL,MAAMH,GAENC,KAAKO,IAAMA,EACXP,KAAK7C,YAAcA,EACnB6C,KAAKb,cAAgBA,CACvB,CAEO,MAAAiB,GACL,OAAOJ,KAAKO,GACd,EAGK,MAAMC,UAAkCF,EAI7C,YACEnB,EACAsB,EACAC,GAEA,IAAIX,EACA5C,EAEAsD,GACFV,EAAc,SACd5C,EAAc,iDAEd4C,EAAc,MACd5C,EACE,iGAGJ+C,MACEH,EACA5C,EACAgC,EACAsB,EAAc,cAAgB,aAGhCT,KAAKS,YAAcA,EACnBT,KAAKU,kBAAoBA,CAC3B,CAEO,MAAAL,CAAOpB,GACZ,OAAIA,aAAqBuB,GAErBvB,EAAUwB,cAAgBT,KAAKS,aAC/BxB,EAAUyB,oBAAsBV,KAAKU,iBAK3C,EAGK,MAAMC,UAAuCL,EAKlD,YACEnB,EACAyB,EACAC,GAEA,IAAId,EACAe,EACAC,EAEkC,iBAA3BF,GACTd,EAAcc,EACdC,GAAY,EACZC,GAAW,IAEXhB,EAAc,UACde,EAAYD,EACZE,GAAYF,GAGdX,MAAMH,OAAanC,EAAWuB,EAAe,cAAcyB,KAE3DZ,KAAKY,QAAUA,EACfZ,KAAKc,UAAYA,EACjBd,KAAKe,SAAWA,CAClB,CAEO,MAAAV,CAAOpB,GACZ,OAAIA,aAAqB0B,GAChB1B,EAAU2B,UAAYZ,KAAKY,OAItC,E","sources":["webpack:///./src/pages/Integrations/Create/IntegrationWizard.tsx","webpack:///./src/types/Notification.ts","webpack:///./src/types/Recipient.ts"],"sourcesContent":["import componentMapper from '@data-driven-forms/pf4-component-mapper/component-mapper';\nimport Pf4FormTemplate from '@data-driven-forms/pf4-component-mapper/form-template';\nimport FormRenderer from '@data-driven-forms/react-form-renderer/form-renderer';\nimport * as React from 'react';\nimport Review from './Review';\nimport CardSelect from './CustomComponents/CardSelect';\nimport InlineAlert from './CustomComponents/InlineAlert';\nimport SelectableTable from './CustomComponents/SelectableTable';\nimport { schema } from './schema';\nimport {\n  CARD_SELECT,\n  INLINE_ALERT,\n  INTEGRATION_TYPE,\n  REVIEW,\n  SELECTABLE_TABLE,\n  TABLE_TOOLBAR,\n} from './helpers';\nimport { Integration } from '../../../types/Integration';\nimport TableToolbar from './CustomComponents/TableToolbar';\nimport { useFlag } from '@unleash/proxy-client-react';\nimport {\n  createEndpoint,\n  updateEndpoint,\n} from '../../../api/helpers/integrations/endpoints-helper';\nimport { useNotification } from '../../../utils/AlertUtils';\nimport { Provider } from 'react-redux';\nimport { Store } from 'redux';\n\nexport interface IntegrationWizardProps {\n  category: string;\n  isOpen: boolean;\n  isEdit: boolean;\n  template?: Partial<\n    Integration & {\n      secretToken: string;\n      id: string;\n      extras?: {\n        channel?: string;\n      };\n    }\n  >;\n  closeModal: () => void;\n  afterSubmit: () => void;\n}\n\nexport const IntegrationWizard: React.FunctionComponent<\n  IntegrationWizardProps\n> = ({\n  isOpen,\n  isEdit,\n  template,\n  afterSubmit,\n  closeModal,\n  category,\n}: IntegrationWizardProps) => {\n  const mapperExtension = {\n    [REVIEW]: Review,\n    [CARD_SELECT]: CardSelect,\n    [INLINE_ALERT]: InlineAlert,\n    [SELECTABLE_TABLE]: SelectableTable,\n    [TABLE_TOOLBAR]: TableToolbar,\n  };\n  const isBehaviorGroupsEnabled = useFlag(\n    'platform.integrations.behavior-groups-move'\n  );\n  const isPagerDutyEnabled = useFlag('platform.integrations.pager-duty');\n  const notifications = useNotification();\n  const [wizardOpen, setWizardOpen] = React.useState<boolean>(isOpen);\n  React.useEffect(() => {\n    setWizardOpen(isOpen);\n  }, [isOpen]);\n\n  return (\n    <React.Fragment>\n      {wizardOpen && (\n        <FormRenderer\n          schema={schema(\n            category,\n            isEdit,\n            isBehaviorGroupsEnabled,\n            isPagerDutyEnabled\n          )}\n          componentMapper={{ ...componentMapper, ...mapperExtension }}\n          onSubmit={({\n            url,\n            [INTEGRATION_TYPE]: intType,\n            name,\n            'secret-token': secret_token,\n            'event-types-table': event_types,\n            severity,\n          }) => {\n            const [type, sub_type] = intType?.split(':') || ['webhook'];\n            const data = {\n              name,\n              enabled: true,\n              type,\n              ...(sub_type && { sub_type }),\n              description: '',\n              properties: {\n                method: 'POST',\n                url,\n                disable_ssl_verification: false,\n                secret_token,\n                severity,\n              },\n              ...(isBehaviorGroupsEnabled && {\n                event_types: event_types\n                  ? Object.values(event_types as object).flatMap(Object.keys)\n                  : [],\n              }),\n            };\n            isEdit && template?.id\n              ? updateEndpoint(\n                  template?.id,\n                  data,\n                  undefined,\n                  notifications,\n                  afterSubmit\n                )\n              : createEndpoint(data, notifications, afterSubmit);\n            closeModal();\n          }}\n          initialValues={\n            isEdit\n              ? {\n                  ...template,\n                  'secret-token': template?.secretToken,\n                }\n              : {}\n          }\n          onCancel={closeModal}\n        >\n          {(props) => <Pf4FormTemplate {...props} showFormControls={false} />}\n        </FormRenderer>\n      )}\n    </React.Fragment>\n  );\n};\n\nconst IntegrationWizardWrapper: React.FC<\n  { store?: Store } & IntegrationWizardProps\n> = ({ store, ...props }) => {\n  return store ? (\n    <Provider store={store}>\n      <IntegrationWizard {...props} />\n    </Provider>\n  ) : (\n    <IntegrationWizard {...props} />\n  );\n};\n\nexport default IntegrationWizardWrapper;\n","import { Schemas } from '../generated/OpenapiNotifications';\nimport { UserIntegration } from './Integration';\nimport { BaseNotificationRecipient } from './Recipient';\n\nexport type UUID = Schemas.UUID;\n\nexport interface EventType {\n  id: UUID;\n  applicationDisplayName: string;\n  eventTypeDisplayName: string;\n  description?: string;\n}\n\nexport interface Notification extends EventType {\n  actions?: Array<Action>;\n  useDefault?: boolean;\n}\n\nexport interface NotificationBehaviorGroup extends EventType {\n  readonly behaviors: ReadonlyArray<BehaviorGroup>;\n}\n\nexport type IntegrationRef = Pick<\n  UserIntegration,\n  'id' | 'name' | 'type' | 'isEnabled'\n>;\n\nexport interface DefaultNotificationBehavior {\n  actions: Array<Action>;\n}\n\nexport interface ActionBase {\n  type: NotificationType;\n}\n\nexport interface ActionIntegration extends ActionBase {\n  type: NotificationType.INTEGRATION;\n  integration: IntegrationRef;\n}\n\nexport interface ActionNotify extends ActionBase {\n  type: NotificationType.EMAIL_SUBSCRIPTION | NotificationType.DRAWER;\n  recipient: ReadonlyArray<BaseNotificationRecipient>;\n}\n\nexport type Action = ActionIntegration | ActionNotify;\n\nexport const isActionNotify = (action: Action): action is ActionNotify =>\n  action.type === NotificationType.EMAIL_SUBSCRIPTION ||\n  action.type === NotificationType.DRAWER;\n\nexport const isActionIntegration = (\n  action: Action\n): action is ActionIntegration => action.type === NotificationType.INTEGRATION;\n\nexport enum NotificationType {\n  EMAIL_SUBSCRIPTION = 'EMAIL_SUBSCRIPTION',\n  DRAWER = 'DRAWER',\n  INTEGRATION = 'INTEGRATION',\n}\n\nexport type Facet = Schemas.Facet;\n\nexport type LocalTime = Schemas.LocalTime;\n\nexport type ServerNotificationRequest = Schemas.EventType;\nexport type ServerNotificationResponse = Schemas.EventType;\n\nexport type BehaviorGroup = {\n  readonly id: UUID;\n  readonly actions: ReadonlyArray<Action>;\n  readonly events: ReadonlyArray<EventType>;\n  readonly bundleId: UUID;\n  readonly displayName: string;\n  readonly bundleName?: string;\n  readonly isDefault: boolean;\n};\n\nexport type NewBehaviorGroup = Partial<Pick<BehaviorGroup, 'id'>> &\n  Omit<BehaviorGroup, 'id'>;\n\nexport type BehaviorGroupRequest = Omit<\n  BehaviorGroup | NewBehaviorGroup,\n  'isDefault'\n>;\n\nexport type EmailSystemProperties = {\n  type: NotificationType.EMAIL_SUBSCRIPTION;\n  props: {\n    onlyAdmins: boolean;\n    ignorePreferences: false;\n    groupId: undefined | UUID;\n  };\n};\nexport type DrawerSystemProperties = {\n  type: NotificationType.DRAWER;\n  props: {\n    onlyAdmins: boolean;\n    groupId: undefined | UUID;\n    ignorePreferences: false;\n  };\n};\n\nexport type SystemProperties = EmailSystemProperties | DrawerSystemProperties;\n\nexport function isEmailSystemProperties(\n  properties: SystemProperties\n): properties is EmailSystemProperties {\n  return properties.type === NotificationType.EMAIL_SUBSCRIPTION;\n}\n\nexport function isDrawerSystemProperties(\n  properties: SystemProperties\n): properties is DrawerSystemProperties {\n  return properties.type === NotificationType.DRAWER;\n}\n\nconst getIntegrationIds = (\n  actions: ReadonlyArray<Action | undefined>\n): Array<UUID | undefined> => {\n  return actions\n    .map((action) => {\n      if (action === undefined) {\n        return [undefined];\n      }\n\n      if (action.type === NotificationType.INTEGRATION) {\n        return [action.integration.id];\n      } else {\n        return action.recipient.map((r) => r.integrationId);\n      }\n    })\n    .flat();\n};\n\nexport const areActionsEqual = (\n  actions1: ReadonlyArray<Action | undefined>,\n  actions2: ReadonlyArray<Action | undefined>\n): boolean => {\n  if (actions1.length !== actions2.length) {\n    return false;\n  }\n\n  const integrations1 = getIntegrationIds(actions1);\n  const integrations2 = getIntegrationIds(actions2);\n\n  if (integrations1.length !== integrations2.length) {\n    return false;\n  }\n\n  // Order matters here, no sorting.\n  return integrations1.every((val, index) => val === integrations2[index]);\n};\n","import { IntegrationRef, UUID } from './Notification';\n\nexport abstract class Recipient {\n  readonly displayName: string;\n\n  protected constructor(displayName: string) {\n    this.displayName = displayName;\n  }\n\n  public abstract getKey();\n  public abstract equals(recipient: Recipient);\n}\n\nexport class IntegrationRecipient extends Recipient {\n  readonly integration: IntegrationRef;\n\n  public constructor(integration: IntegrationRef) {\n    super(integration.name + (integration.isEnabled ? '' : ' - Disabled'));\n    this.integration = integration;\n  }\n\n  public getKey() {\n    return this.integration.id;\n  }\n\n  public equals(recipient: Recipient) {\n    if (recipient instanceof IntegrationRecipient) {\n      return recipient.integration.id === this.integration.id;\n    }\n\n    return false;\n  }\n}\n\nexport abstract class BaseNotificationRecipient extends Recipient {\n  readonly integrationId: UUID | undefined;\n  readonly key: string;\n  readonly description: string | undefined;\n\n  protected constructor(\n    displayName: string,\n    description: string | undefined,\n    integrationId: UUID | undefined,\n    key: string\n  ) {\n    super(displayName);\n\n    this.key = key;\n    this.description = description;\n    this.integrationId = integrationId;\n  }\n\n  public getKey() {\n    return this.key;\n  }\n}\n\nexport class NotificationUserRecipient extends BaseNotificationRecipient {\n  readonly sendToAdmin: boolean;\n  readonly ignorePreferences: boolean;\n\n  public constructor(\n    integrationId: UUID | undefined,\n    sendToAdmin: boolean,\n    ignorePreferences: boolean\n  ) {\n    let displayName;\n    let description;\n\n    if (sendToAdmin) {\n      displayName = 'Admins';\n      description = 'Organization administrators for your account';\n    } else {\n      displayName = 'All';\n      description =\n        'All users in your organization who subscribed to this email in their Notification Preferences';\n    }\n\n    super(\n      displayName,\n      description,\n      integrationId,\n      sendToAdmin ? 'users-admin' : 'users-all'\n    );\n\n    this.sendToAdmin = sendToAdmin;\n    this.ignorePreferences = ignorePreferences;\n  }\n\n  public equals(recipient: Recipient) {\n    if (recipient instanceof NotificationUserRecipient) {\n      return (\n        recipient.sendToAdmin === this.sendToAdmin &&\n        recipient.ignorePreferences === this.ignorePreferences\n      );\n    }\n\n    return false;\n  }\n}\n\nexport class NotificationRbacGroupRecipient extends BaseNotificationRecipient {\n  readonly groupId: UUID;\n  readonly isLoading: boolean;\n  readonly hasError: boolean;\n\n  public constructor(\n    integrationId: UUID | undefined,\n    groupId: UUID,\n    displayNameOrIsLoading: string | boolean\n  ) {\n    let displayName;\n    let isLoading;\n    let hasError;\n\n    if (typeof displayNameOrIsLoading === 'string') {\n      displayName = displayNameOrIsLoading;\n      isLoading = false;\n      hasError = false;\n    } else {\n      displayName = 'Loading';\n      isLoading = displayNameOrIsLoading;\n      hasError = !displayNameOrIsLoading;\n    }\n\n    super(displayName, undefined, integrationId, `rbac-group-${groupId}`);\n\n    this.groupId = groupId;\n    this.isLoading = isLoading;\n    this.hasError = hasError;\n  }\n\n  public equals(recipient: Recipient) {\n    if (recipient instanceof NotificationRbacGroupRecipient) {\n      return recipient.groupId === this.groupId;\n    }\n\n    return false;\n  }\n}\n"],"names":["IntegrationWizard","isOpen","isEdit","template","afterSubmit","closeModal","category","mapperExtension","isBehaviorGroupsEnabled","useFlag","isPagerDutyEnabled","notifications","wizardOpen","setWizardOpen","schema","componentMapper","onSubmit","url","intType","name","secret_token","event_types","severity","type","sub_type","split","data","enabled","description","properties","method","disable_ssl_verification","Object","values","flatMap","keys","id","undefined","initialValues","secretToken","onCancel","props","showFormControls","store","Provider","isActionNotify","action","NotificationType","EMAIL_SUBSCRIPTION","DRAWER","isActionIntegration","INTEGRATION","isEmailSystemProperties","isDrawerSystemProperties","getIntegrationIds","actions","map","integration","recipient","r","integrationId","flat","areActionsEqual","actions1","actions2","length","integrations1","integrations2","every","val","index","Recipient","displayName","this","IntegrationRecipient","super","isEnabled","getKey","equals","BaseNotificationRecipient","key","NotificationUserRecipient","sendToAdmin","ignorePreferences","NotificationRbacGroupRecipient","groupId","displayNameOrIsLoading","isLoading","hasError"],"sourceRoot":""}