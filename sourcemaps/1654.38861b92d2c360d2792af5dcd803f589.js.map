{"version":3,"file":"js/1654.f5d9a4c048ec0431cd36.js","mappings":"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","sources":["webpack:///./src/components/Notifications/TimeConfig.tsx","webpack:///./src/services/Notifications/GetTimePreference.ts","webpack:///./src/services/Notifications/SaveTimePreference.ts"],"sourcesContent":["import {\n  AlertActionLink,\n  Button,\n  Dropdown,\n  DropdownItem,\n  DropdownToggle,\n  HelperText,\n  HelperTextItem,\n  Modal,\n  ModalVariant,\n  Radio,\n  Skeleton,\n  Split,\n  SplitItem,\n  Stack,\n  StackItem,\n  Text,\n  TextVariants,\n  TimePicker,\n  Title,\n} from '@patternfly/react-core';\nimport { Alert } from '@patternfly/react-core';\nimport { addHours } from 'date-fns';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport timezones from 'timezones.json';\nimport { style } from 'typestyle';\n\nimport { useGetTimePreference } from '../../services/Notifications/GetTimePreference';\nimport { useUpdateTimePreference } from '../../services/Notifications/SaveTimePreference';\nimport { useNotification } from '../../utils/AlertUtils';\n\nconst dropDownClassName = style({\n  width: '280px',\n});\n\nconst alertClassName = style({\n  marginTop: '12px',\n});\n\ninterface TimeConfigState {\n  utcTime: string;\n  baseCustomTime: string;\n  timezoneText: string | undefined;\n}\n\nexport const TimeConfigComponent: React.FunctionComponent = () => {\n  const [showCustomSelect, setShowCustomSelect] = React.useState(false);\n  const [timeSelect, setTimeSelect] = React.useState<TimeConfigState>();\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const getTimePreference = useGetTimePreference();\n  const saveTimePreference = useUpdateTimePreference();\n  const { addSuccessNotification, addDangerNotification } = useNotification();\n\n  const timePref = useMemo(() => {\n    if (getTimePreference.status === 200) {\n      return getTimePreference.payload?.value as string;\n    }\n\n    return undefined;\n  }, [getTimePreference.payload?.value, getTimePreference.status]);\n\n  // Set the time preference value once we load it from the server\n  useEffect(() => {\n    if (timePref) {\n      setTimeSelect({\n        baseCustomTime: timePref,\n        utcTime: timePref,\n        timezoneText: undefined,\n      });\n      setShowCustomSelect(timePref !== '00:00:00');\n    }\n  }, [timePref]);\n\n  const handleRadioSelect = React.useCallback(() => {\n    setShowCustomSelect(false);\n    setTimeSelect({\n      utcTime: '00:00',\n      baseCustomTime: '00:00',\n      timezoneText: undefined,\n    });\n  }, []);\n\n  const [isOpen, setIsOpen] = React.useState(false);\n\n  const dropdownItems = timezones.map((tz) => (\n    // Abbr, value, offset, etc are not unique by themselves\n    <DropdownItem key={tz.text}>{tz.text}</DropdownItem>\n  ));\n\n  const handleCustomRadioSelect = React.useCallback(() => {\n    setShowCustomSelect(true);\n  }, []);\n\n  const handleTimePrefSelect = React.useCallback((time) => {\n    setTimeSelect({\n      baseCustomTime: time,\n      utcTime: time,\n      timezoneText: undefined,\n    });\n  }, []);\n\n  const handleTimezoneChange = React.useCallback(\n    (event?: React.SyntheticEvent<HTMLDivElement>) => {\n      if (event?.target) {\n        const target = event.target;\n        const textContent = (target as HTMLElement).textContent;\n        const targetTimezone = timezones.find((t) => t.text === textContent);\n        if (targetTimezone) {\n          setTimeSelect((prev) => {\n            if (prev?.baseCustomTime) {\n              const pieces = prev.baseCustomTime\n                .split(':')\n                .map((t) => parseInt(t));\n              const date = new Date();\n              date.setUTCHours(pieces[0], pieces[1]);\n              // Going from UTC to the timezone\n              const zonedDate = addHours(date, -targetTimezone.offset);\n              const utcHours = zonedDate\n                .getUTCHours()\n                .toString()\n                .padStart(2, '0');\n              const utcMinutes = zonedDate\n                .getUTCMinutes()\n                .toString()\n                .padStart(2, '0');\n\n              return {\n                ...prev,\n                utcTime: `${utcHours}:${utcMinutes}`,\n                timezoneText: targetTimezone.text,\n              };\n            }\n\n            return prev;\n          });\n        }\n      }\n\n      setIsOpen(false);\n    },\n    []\n  );\n\n  const handleButtonSave = React.useCallback(() => {\n    if (timeSelect) {\n      const mutate = saveTimePreference.mutate;\n      mutate({\n        body: timeSelect.utcTime,\n      }).then((response) => {\n        if (response.status === 204) {\n          addSuccessNotification('Action settings saved', '');\n        } else {\n          addDangerNotification('Failed to save action settings', '');\n        }\n      });\n    }\n\n    setIsModalOpen(false);\n  }, [\n    addDangerNotification,\n    addSuccessNotification,\n    saveTimePreference.mutate,\n    timeSelect,\n  ]);\n\n  const isLoading = saveTimePreference.loading || getTimePreference.loading;\n\n  const handleModalToggle = () => {\n    setIsModalOpen(!isModalOpen);\n  };\n\n  const timeconfigTitle = () => {\n    return `Any daily digest emails you've opted into will be sent at ${\n      timePref ? timePref : '00:00'\n    } UTC`;\n  };\n\n  return (\n    <>\n      <Alert\n        className={alertClassName}\n        isInline\n        title={timeconfigTitle()}\n        actionLinks={\n          <AlertActionLink onClick={handleModalToggle} ouiaId=\"TimeConfigModal\">\n            Edit time settings\n          </AlertActionLink>\n        }\n      />\n      <Modal\n        className=\"pf-v5-u-pl-xl\"\n        variant={ModalVariant.small}\n        isOpen={isModalOpen}\n        onClose={handleModalToggle}\n        actions={[\n          <Button\n            key=\"save\"\n            variant=\"primary\"\n            type=\"submit\"\n            isLoading={isLoading}\n            isDisabled={isLoading}\n            onClick={handleButtonSave}\n          >\n            {isLoading ? 'Loading' : 'Save'}\n          </Button>,\n          <Button key=\"cancel\" variant=\"link\" onClick={handleModalToggle}>\n            Cancel\n          </Button>,\n        ]}\n        ouiaId=\"TimeConfigModal\"\n      >\n        <Stack hasGutter>\n          <StackItem>\n            <Title headingLevel=\"h2\">Action settings</Title>\n          </StackItem>\n          <StackItem>\n            <Text component={TextVariants.p}>Daily digest email receipt</Text>\n            <HelperText>\n              <HelperTextItem variant=\"indeterminate\">\n                Schedule the time at which to send your account&apos;s daily\n                digest email. All times will be converted to UTC after saving.\n              </HelperTextItem>\n            </HelperText>\n          </StackItem>\n        </Stack>\n        <br></br>\n        <Split>\n          <SplitItem isFilled>\n            <Stack hasGutter>\n              <StackItem>\n                {getTimePreference.loading ? (\n                  <Skeleton />\n                ) : (\n                  <Radio\n                    isChecked={!showCustomSelect}\n                    onChange={handleRadioSelect}\n                    id=\"settings-time-config\"\n                    label=\"Default time\"\n                    value=\"Default\"\n                    description=\"00:00 UTC\"\n                    name=\"radio-select\"\n                  ></Radio>\n                )}\n              </StackItem>\n              <StackItem>\n                {getTimePreference.loading ? (\n                  <Skeleton />\n                ) : (\n                  <Radio\n                    isChecked={showCustomSelect}\n                    onChange={handleCustomRadioSelect}\n                    id=\"settings-time-config-custom\"\n                    label=\"Custom time\"\n                    name=\"radio-select\"\n                  ></Radio>\n                )}\n              </StackItem>\n              {showCustomSelect && (\n                <>\n                  <StackItem className=\"pf-v5-u-pl-lg\">\n                    <Text component={TextVariants.h6}>Time</Text>\n                    <TimePicker\n                      onChange={handleTimePrefSelect}\n                      time={timeSelect?.baseCustomTime}\n                      width=\"263px\"\n                      stepMinutes={15}\n                      placeholder=\"00:00\"\n                      is24Hour\n                    />\n                  </StackItem>\n                  <StackItem className=\"pf-v5-u-pl-lg\">\n                    <Text component={TextVariants.h6}>Time zone</Text>\n                    <Dropdown\n                      className={dropDownClassName}\n                      toggle={\n                        <DropdownToggle\n                          isOpen={isOpen}\n                          id=\"timezone\"\n                          onToggle={() => setIsOpen(!isOpen)}\n                        >\n                          {timeSelect?.timezoneText ??\n                            '(UTC-00:00) Universal Time'}\n                        </DropdownToggle>\n                      }\n                      isOpen={isOpen}\n                      onSelect={handleTimezoneChange}\n                      menuAppendTo={() => document.body}\n                      dropdownItems={dropdownItems}\n                    ></Dropdown>\n                  </StackItem>\n                </>\n              )}\n            </Stack>\n          </SplitItem>\n        </Split>\n      </Modal>\n    </>\n  );\n};\n\nexport default TimeConfigComponent;\n","import { useQuery } from 'react-fetching-library';\n\nimport { Operations } from '../../generated/OpenapiNotifications';\n\nexport const useGetTimePreference = () => {\n  return useQuery(\n    Operations.OrgConfigResourceGetDailyDigestTimePreference.actionCreator()\n  );\n};\n","import { useMutation } from 'react-fetching-library';\n\nimport { Operations } from '../../generated/OpenapiNotifications';\n\nexport type SaveTimePrefActionsParams = {\n  body: string;\n};\n\nconst actionCreator = (params: SaveTimePrefActionsParams) => {\n  return Operations.OrgConfigResourceSaveDailyDigestTimePreference.actionCreator(\n    {\n      body: params.body,\n    }\n  );\n};\n\nexport const useUpdateTimePreference = () => {\n  return useMutation(actionCreator);\n};\n"],"names":["dropDownClassName","style","width","alertClassName","marginTop","TimeConfigComponent","showCustomSelect","setShowCustomSelect","timeSelect","setTimeSelect","isModalOpen","setIsModalOpen","useState","getTimePreference","saveTimePreference","addSuccessNotification","addDangerNotification","timePref","useMemo","status","payload","value","useEffect","baseCustomTime","utcTime","timezoneText","undefined","handleRadioSelect","isOpen","setIsOpen","dropdownItems","tz","DropdownItem","key","text","handleCustomRadioSelect","handleTimePrefSelect","time","handleTimezoneChange","event","target","textContent","targetTimezone","t","prev","pieces","split","map","parseInt","date","Date","setUTCHours","zonedDate","offset","utcHours","getUTCHours","toString","padStart","utcMinutes","getUTCMinutes","handleButtonSave","mutate","body","then","response","isLoading","loading","handleModalToggle","Alert","className","isInline","title","actionLinks","AlertActionLink","onClick","ouiaId","Modal","variant","ModalVariant","onClose","actions","Button","type","isDisabled","Stack","hasGutter","StackItem","Title","headingLevel","Text","component","TextVariants","HelperText","HelperTextItem","Split","SplitItem","isFilled","Skeleton","Radio","isChecked","onChange","id","label","description","name","TimePicker","stepMinutes","placeholder","is24Hour","Dropdown","toggle","DropdownToggle","onToggle","onSelect","menuAppendTo","document","useGetTimePreference","useQuery","actionCreator","params","useUpdateTimePreference","useMutation"],"sourceRoot":""}