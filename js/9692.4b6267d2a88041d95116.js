"use strict";(self.webpackChunknotifications_frontend=self.webpackChunknotifications_frontend||[]).push([[9692],{86836:(e,t,n)=>{n.d(t,{Z:()=>ti});var a=n(21242),l=n(68199),i=n(55140),o=n(55128),r=n(21472),s=n(93264),c=n.n(s),u=n(8813),d=n(42150),m=n(89063),p=n(68519),E=n(70670),g=n(84456),v=n(79153),h=n(76347),f=n(86896),y=n(77365),b=n(94782),C=n(16721);const T=(e,t=!0)=>(0,b.useQuery)((e=>C.B.NotificationResourceGetBundleFacets.actionCreator({includeApplications:e}))(!!e),t);var S=n(28216);const k=l.Main,I=e=>{const t=(0,S.useStore)();return s.createElement(k,{store:t,...e})},N=()=>{var e,t;const{bundleName:n}=(0,E.useParams)(),i=T(),r=(0,s.useMemo)((()=>{var e;if(200===(null===(e=i.payload)||void 0===e?void 0:e.status))return i.payload.value.find((e=>e.name===n))}),[n,null===(e=i.payload)||void 0===e?void 0:e.status,null===(t=i.payload)||void 0===t?void 0:t.value]),u=(0,E.useLocation)(),d=(0,f.Z)(),m=c().createElement("a",{href:(0,o.localUrl)("/user-preferences/notifications/",(0,o.getInsights)().chrome.isBeta())}," User Preferences"),p=c().createElement("a",{href:(0,o.localUrl)("/settings/my-user-access?bundle=rhel }",(0,o.getInsights)().chrome.isBeta())}," My User Access "),g=c().useMemo((()=>{switch((0,h.y)(u.pathname)){case v.ZP.integrations.subAppId:return d.formatMessage(y.Z.integrations);case v.ZP.notifications.subAppId:return u.pathname===Hl.eventLog()?"Event Log":d.formatMessage(y.Z.notifications);default:return""}}),[d,u.pathname]),b=c().useMemo((()=>"Notifications"===g?`${g} | ${r?r.displayName:c().createElement(a.Skeleton,null)}`:`${g}`),[r,g]),C=c().useMemo((()=>"Notifications"===g?c().createElement("span",null,"This service allows you to configure which notifications different users within your organization will be entitled to receiving. To do this, create behavior groups and apply them to different events. Users will be able to opt-in or out of receiving authorized event notifications in their",c().createElement("a",{href:(0,o.localUrl)("/user-preferences/notifications/",(0,o.getInsights)().chrome.isBeta())}," User Preferences"),"."):c().createElement("span",null)),[g]);return c().createElement(c().Fragment,null,c().createElement(l.PageHeader,null,c().createElement(a.Split,null,c().createElement(a.SplitItem,{isFilled:!0},c().createElement(l.PageHeaderTitle,{title:b,paddingBottom:"8px"}," "),c().createElement(a.StackItem,null,C)))),c().createElement(I,null,c().createElement(l.NotAuthorized,{description:c().createElement(c().Fragment,null," Contact your organization administrator for more information or visit",p," to learn more about your permissions. To manage your notifications, go to your ",m,"."),serviceName:g})))},w=e=>{const{rbac:t}=(0,g.b)(),n=(0,E.useLocation)(),a=c().useMemo((()=>{switch((0,h.y)(n.pathname)){case v.ZP.integrations.subAppId:return null==t?void 0:t.canReadIntegrationsEndpoints;case v.ZP.notifications.subAppId:return n.pathname===Hl.eventLog()?null==t?void 0:t.canReadEvents:null==t?void 0:t.canReadNotifications}return!1}),[t,n]);return c().createElement(c().Fragment,null,a?e.children:c().createElement(N,null))},A="rhel",L=()=>s.createElement(p.l_,{from:Hl.notifications(""),to:Hl.notifications(A)});var D=n(11047),P=n(18115);const O=(0,E.withRouter)((e=>s.createElement(D.Z,{headerTitle:P.V.pages.error.title,errorTitle:P.V.pages.error.emptyState.title,errorDescription:P.V.pages.error.emptyState.content},e.children)));var x=n(98673);const F=()=>{const{updateDocumentTitle:e}=(0,i.Z)();null==e||e("Integrations");const t=(0,m.useFlag)("platform.notifications.overhaul");return s.createElement(l.Section,{className:"pf-c-page__main-section pf-m-light"},s.createElement(l.PageHeader,null,s.createElement(a.Split,null,s.createElement(a.SplitItem,{isFilled:!0},s.createElement(l.PageHeaderTitle,{title:P.V.pages.integrations.list.title})),!t&&s.createElement(a.SplitItem,null,s.createElement(a.Button,{variant:"secondary",component:()=>s.createElement(E.Link,{to:Hl.eventLog()})}," View event log ")))),s.createElement(I,null,s.createElement(x.Z,null)))};var R=n(43551);const G=P.V.pages.splunk.page.helpUrl,B="https://access.redhat.com/support/cases/#/case/new/open-case/describe-issue?intcmp=hp|a|a3|case&caseCreate=true&product=Red%20Hat%20Insights&version=Red%20Hat%20Insights",M=({isSuccess:e,error:t})=>e?c().createElement(U,null):c().createElement(V,{error:t}),U=()=>c().createElement(a.EmptyState,null,c().createElement(a.EmptyStateIcon,{icon:R.CheckCircleIcon,color:"var(--pf-global--success-color--100)"}),c().createElement(a.Title,{headingLevel:"h4",size:"lg"},"Splunk integration in Insights completed"),c().createElement(a.EmptyStateBody,null,"Splunk integration in Insights was completed. To confirm these changes, ",c().createElement("strong",null,"go back to Splunk application"),".")),V=({error:e})=>c().createElement(a.EmptyState,null,c().createElement(a.EmptyStateIcon,{icon:R.ExclamationCircleIcon,color:"var(--pf-global--danger-color--100)"}),c().createElement(a.Title,{headingLevel:"h4",size:"lg"},"Configuration failed"),c().createElement(a.EmptyStateBody,null,c().createElement("p",{className:"pf-u-mb-md"},"There was a problem processing the request. Please try again. If the problem persists, contact Red Hat support by opening the ticket."),e&&c().createElement("p",null,`${e}`)),c().createElement(a.Button,{variant:"primary",component:"a",href:B,target:"_blank",rel:"noopener noreferrer"},"Open a Red Hat Support ticket"),c().createElement(a.EmptyStateSecondaryActions,null,c().createElement(a.Button,{variant:"link",component:"a",href:G,target:"_blank",rel:"noopener noreferrer"},"Go to documentation")));var _=n(63055),Z=n(70070),$=n(10406);const H=e=>{const t=(null!=e?e:o.Page.defaultPage()).toQuery();return C.B.NotificationResourceGetEventTypes.actionCreator({limit:+t.limit,offset:+t.offset,applicationIds:t.filterApplicationId,eventTypeName:t.filterEventFilterName,bundleId:t.filterBundleId,sortBy:`${t.sortColumn}:${t.sortDirection}`})},z=(0,Z.validationResponseTransformer)((e=>200===e.status?(0,Z.validatedResponse)("eventTypesArray",200,{...e.value,data:(0,$.Jc)(e.value.data)},e.errors):e)),q=e=>(0,o.useTransformQueryResponse)((0,b.useQuery)(H(e)),z),W=(0,Z.validationResponseTransformer)((e=>200===e.status?(0,Z.validatedResponse)("BehaviorGroupId",200,e.value.map((e=>e.id)),e.errors):e));var Q=C.B.NotificationResourceUpdateEventTypeBehaviors;const Y=(e,t)=>Q.actionCreator({body:t,eventTypeId:e}),j=(0,Z.validationResponseTransformer)((e=>{if("CreateBehaviorGroupResponse"===e.type){const t={id:e.value.id,displayName:e.value.display_name,bundleId:e.value.bundle_id,isDefault:!1,bundleName:void 0,actions:[],events:[]};return(0,Z.validatedResponse)("BehaviorGroup",e.status,t,e.errors)}return e})),K=e=>"id"in e?C.B.NotificationResourceUpdateBehaviorGroup.actionCreator({id:e.id,body:{display_name:e.displayName,endpoint_ids:e.endpointIds,event_type_ids:e.eventTypesIds}}):C.B.NotificationResourceCreateBehaviorGroup.actionCreator({body:{bundle_id:e.bundleId,display_name:e.displayName,endpoint_ids:e.endpointIds,event_type_ids:e.eventTypesIds}}),J=()=>(0,o.useTransformQueryResponse)((0,b.useMutation)(K),j),X=e=>C.B.NotificationResourceUpdateBehaviorGroupActions.actionCreator({behaviorGroupId:e.behaviorGroupId,body:e.endpointIds});var ee=n(5543),te=n(73091);const ne={advisor:"*",policies:"*",drift:"*",compliance:"*","malware-detection":"*",patch:"*",vulnerability:"*"},ae=()=>{const e=(()=>{const{query:e}=(0,b.useClient)(),t=async n=>{var a;n||(n=o.Page.defaultPage().withSort(o.Sort.by("application",o.Direction.ASCENDING)));const{errorObject:l,payload:i}=await e(H(n));if(l)throw l;if("PageEventType"===(null==i?void 0:i.type)){const e=null===(a=null==i?void 0:i.value)||void 0===a?void 0:a.data;return 0===e.length?[]:[...e,...await t(n.nextPage())]}throw new Error(`Unknow payload type for eventTypes ${null==i?void 0:i.type}`)};return t})(),t=(0,b.useClient)(),n=(()=>{const e=(0,b.useClient)();return async t=>{const{errorObject:n,payload:a}=await e.query((e=>C.B.NotificationResourceGetLinkedBehaviorGroups.actionCreator({eventTypeId:e}))(t));if(n)throw n;return W(a)}})(),a=async(e,a)=>{const l=[...(await n(e.id)).value,a.id],{payload:i,errorObject:o,error:r}=await t.query(Y(e.id,l));if(o)throw o;if(r)throw new Error(`Unsuccessful linking of event type ${e.id}`);return i};return async(t,n,l)=>{var i;const o=(await e()).filter((e=>{if(!(null==e?void 0:e.application))return!1;if(e.application.bundle_id!==t.bundleId)return!1;const a=n[e.application.name];return!(!a||"*"!==a&&!a.includes(e.name))}));for(const e of o){l(`  ${null===(i=e.application)||void 0===i?void 0:i.display_name} - ${e.display_name}...`);try{await a(e,t),l(" ASSOCIATED\n","pf-u-success-color-200")}catch(e){l(" ERROR!\n","pf-u-danger-color-200"),console.log(e)}}}},le=(0,_.Z_)().url().test("has-no-path","URL contains path or parameters",(e=>{let t;try{t=new URL(e)}catch{return!1}return("/"===t.pathname||""===t.pathname)&&""===t.search})),ie=({setStep:e,stepIsInProgress:t,setStepIsInProgress:n,stepVariant:l,setStepVariant:i,hecToken:r,setHecToken:u,splunkServerHostName:d,setHostName:m,automationLogs:p,setAutomationLogs:E,setError:g})=>{const v=(()=>{const e=(()=>{const{mutate:e}=(0,ee.TK)();return async({integrationName:t,splunkServerHostName:n,hecToken:a})=>{const l={type:te.WN.SPLUNK,name:t,url:n,secretToken:a,isEnabled:!0,sslVerificationEnabled:!0},{payload:i,error:o,errorObject:r}=await e(l);if(r)throw r;if(o)throw new Error(`Error when creating integration ${t}`);return null==i?void 0:i.value}})(),t=(()=>{const{mutate:e}=J(),t=(()=>{const{query:e}=T(!1,!1);return async t=>{const n=await e(),a=n.payload;if(n.errorObject)throw n.errorObject;if(n.error||!a)throw new Error(`Unable to retrieve bundles, status ${a.status}`);return a.value.find((e=>e.name===t))}})();return async({behaviorGroupName:n,bundleName:a})=>{const l=await t(a);if(!l)throw new Error(`Unable to find bundle ${a}`);const i={bundleId:l.id,displayName:n,actions:[],events:[]},{payload:o,error:r,errorObject:s}=await e(i);if(s)throw s;if(r)throw new Error(`Error when creating behavior group ${n}`);return null==o?void 0:o.value}})(),n=(()=>{const{mutate:e}=(0,b.useMutation)(X);return async(t,n)=>{const a=t.actions||[];a.push(n.id);const l={behaviorGroupId:t.id,endpointIds:a},{payload:i,error:o,errorObject:r}=await e(l);if(r)throw r;if(o)throw new Error(`Error when linking behavior group ${t.id} with integration ${n.id}`);return null==i?void 0:i.value}})(),a=ae();return async({hecToken:l,splunkServerHostName:i},o)=>{const r="SPLUNK_AUTOMATION",s="SPLUNK_AUTOMATION_GROUP",c=ne;o(`Creating Integration ${r}...`);const u=await e({integrationName:r,hecToken:l,splunkServerHostName:i});o(" OK","pf-u-success-color-200"),o(`\nCreating Behavior Group ${s}...`);const d=await t({behaviorGroupName:s,bundleName:"rhel"});o(" OK","pf-u-success-color-200"),o("\nAssociating integration as an action for the behavior group..."),await n(d,u),o(" OK","pf-u-success-color-200"),o("\n\nAssociating events to the behavior group:\n"),await a(d,c,o)}})(),[h,f]=(0,s.useState)(!0),[y,C]=(0,s.useState)(a.ValidatedOptions.default),[S,k]=(0,s.useState)(a.ValidatedOptions.default);(0,s.useEffect)((()=>{[y,S].every((e=>e===a.ValidatedOptions.success))?f(!1):f(!0)}),[y,S]);const I=(e,t)=>{let n=e;t&&(n=c().createElement("span",{className:t},e)),E((e=>[...e,n]))};return c().createElement(a.Grid,null,c().createElement(a.GridItem,{span:6},c().createElement(a.Form,{className:"pf-u-mr-md"},c().createElement(a.FormGroup,{label:"Splunk HEC URL",labelIcon:c().createElement(a.Popover,{headerContent:c().createElement("div",null,"The server ",c().createElement("b",null,"hostname/IP Address")," and ",c().createElement("b",null,"port")," of your splunk HTTP Event Collector"),bodyContent:c().createElement("div",null,"For Splunk Enterprise the port is by default 8088.",c().createElement("br",null),"For Splunk Cloud Platform see"," ",c().createElement("a",{target:"_blank",rel:"noreferrer",href:"https://docs.splunk.com/Documentation/SplunkCloud/latest/Data/UsetheHTTPEventCollector#Send_data_to_HTTP_Event_Collector"},"documentation"),".")},c().createElement("button",{type:"button","aria-label":"More info for name field",onClick:e=>e.preventDefault(),"aria-describedby":"splunk-server-hostname",className:"pf-c-form__group-label-help"},c().createElement(R.HelpIcon,{noVerticalAlign:!0}))),isRequired:!0,fieldId:"splunk-server-hostname",helperTextInvalid:"Invalid URL. Example: https://hostname:8088",validated:y},c().createElement(a.TextInput,{isRequired:!0,type:"text",id:"splunk-server-hostname",name:"splunk-server-hostname","aria-describedby":"splunk-server-hostname-helper",value:d,validated:y,onChange:async e=>{if(m(e),""===e)C(a.ValidatedOptions.default);else{const t=await le.isValid(e);C(t?a.ValidatedOptions.success:a.ValidatedOptions.error)}}})),c().createElement(a.FormGroup,{label:"Splunk HEC Token",fieldId:"splunk-hec-token",isRequired:!0,helperTextInvalid:"Invalid HEC token. Example: 123e4567-e89b-12d3-a456-426614174000",validated:S},c().createElement(a.TextInput,{isRequired:!0,type:"text",id:"splunk-hec-token",name:"splunk-hec-token","aria-describedby":"splunk-hec-token-helper",validated:S,value:r,onChange:async e=>{if(u(e),""===e)k(a.ValidatedOptions.default);else{const t=await(0,_.Z_)().uuid().isValid(e);k(t?a.ValidatedOptions.success:a.ValidatedOptions.error)}}})),c().createElement(a.ActionGroup,null,c().createElement(oe,{onStart:async()=>{n(!0),E([]);try{await v({hecToken:r,splunkServerHostName:d},I)}catch(e){return I(`\n${e}`,"pf-u-danger-color-200"),n(!1),i("danger"),(0,o.addDangerNotification)("Configuration failed",c().createElement(re,null),!0),void g(e)}f(!1),n(!1),i("success"),I("\nDONE!","pf-u-success-color-200")},onFinish:()=>{e((e=>e+1))},stepIsInProgress:t,stepVariant:l,isDisabled:h})))),c().createElement(a.GridItem,{span:6},c().createElement(a.CodeBlock,null,c().createElement(a.CodeBlockCode,null,p))))},oe=({onStart:e,onFinish:t,stepIsInProgress:n,stepVariant:l,isDisabled:i})=>n?c().createElement(a.Button,{variant:"primary",isLoading:!0},"Configuration in progress"):"success"===l||"danger"===l?c().createElement(a.Button,{variant:"primary",onClick:t},"success"===l?c().createElement(R.CheckCircleIcon,null):c().createElement(R.ExclamationCircleIcon,null)," ","Next: Review"):c().createElement(a.Button,{variant:"primary",isDisabled:i,onClick:e},"Run Configuration"),re=()=>c().createElement(c().Fragment,null,c().createElement("p",{className:"pf-u-mb-md"},"There was a problem processing the request. Please try again. If the problem persists, contact Red Hat support by opening the ticket."),c().createElement(a.List,{variant:a.ListVariant.inline},c().createElement(a.ListItem,null,c().createElement("a",{target:"_blank",rel:"noopener noreferrer",href:B},"Open a Red Hat Support ticket")),c().createElement(a.ListItem,null,c().createElement("a",{target:"_blank",rel:"noopener noreferrer",href:G},"Go to documentation")))),se=()=>c().createElement(c().Fragment,null,c().createElement(l.PageHeaderTitle,{title:c().createElement(c().Fragment,null,P.V.pages.splunk.page.title,c().createElement(a.Popover,{bodyContent:P.V.pages.splunk.page.help,footerContent:c().createElement("a",{target:"_blank",rel:"noopener noreferrer",href:G},"Learn more ",c().createElement(R.ExternalLinkSquareAltIcon,null))},c().createElement(a.Button,{variant:"plain","aria-label":"Help description",className:"title-help-label"},c().createElement(R.HelpIcon,{noVerticalAlign:!0}))))}),P.V.pages.splunk.page.description);var ce=n(46242);const ue=e=>s.createElement(E.Link,{...e,component:t=>s.createElement(a.Button,{...e,onClick:t.navigate},e.children)},e.children);var de,me=n(64258),pe=n(3276),Ee=n(29987),ge=n(47435),ve=n(29422),he=n(313),fe=n(42699),ye=n(23855),be=n(37950),Ce=n(18172);!function(e){e.TODAY="today",e.YESTERDAY="yesterday",e.LAST_7="last_7",e.LAST_14="last_14",e.CUSTOM="custom"}(de||(de={}));const Te={[de.TODAY]:"Today",[de.YESTERDAY]:"Yesterday",[de.LAST_7]:"Last 7 days",[de.LAST_14]:"Last 14 days",[de.CUSTOM]:"Custom"},Se=(0,u.style)({paddingLeft:me.S.value,paddingRight:me.S.value,color:pe.p.value}),ke=(0,u.style)({backgroundColor:(0,ge.important)("white"),cursor:"pointer",$nest:{"&::placeholder":{color:(0,ge.important)("black")},"&:hover":{borderBottomColor:Ee.h.value}}});class Ie{constructor(e){this.value=e}toString(){return Te[this.value]}compareTo(e){return e instanceof Ie&&e.value===this.value}}const Ne={isReadOnly:!0,className:ke},we=e=>{const t=s.useMemo((()=>new Date),[]),n=s.useMemo((()=>(0,ve.Z)(t,{days:-14})),[t]),l=s.useMemo((()=>[a=>(0,he.Z)(a,n)?"Date is before the retention policy":(0,fe.Z)(a,t)?"Date is after today":e.period[1]&&(0,fe.Z)(a,e.period[1])?"Start date must be before end date":""]),[n,t,e.period]),i=s.useMemo((()=>[a=>(0,he.Z)(a,n)?"Date is before the retention policy":(0,fe.Z)(a,t)?"Date is after today":e.period[0]&&(0,he.Z)(a,e.period[0])?"End date must be after start date":""]),[n,t,e.period]),o=s.useCallback((n=>{const a=e.setPeriod,l=(0,ye.Z)(n);a((0,Ce.ZP)((e=>{e[0]=l,e[1]||(e[1]=(0,be.Z)([(0,ve.Z)(l,{days:1}),t]))})))}),[e.setPeriod,t]),c=s.useCallback((t=>{(0,e.setPeriod)((0,Ce.ZP)((e=>{e[1]=(0,ye.Z)(t)})))}),[e.setPeriod]),u=s.useMemo((()=>e.period[0]?(0,r.Z)(e.period[0],"yyyy-MM-dd"):void 0),[e.period]),d=s.useMemo((()=>e.period[1]?(0,r.Z)(e.period[1],"yyyy-MM-dd"):void 0),[e.period]),m=(0,s.useRef)(null),p=(0,s.useRef)(null),E=s.useCallback((()=>{var e;null===(e=m.current)||void 0===e||e.setCalendarOpen(!0)}),[m]),g=s.useCallback((()=>{var e;null===(e=p.current)||void 0===e||e.setCalendarOpen(!0)}),[p]),v=s.useMemo((()=>({...Ne,onClick:E})),[E]),h=s.useMemo((()=>({...Ne,onClick:g})),[g]);return s.createElement(a.Split,null,s.createElement(a.SplitItem,null,s.createElement(a.DatePicker,{placeholder:"Start",inputProps:v,validators:l,onChange:o,value:u,ref:m})),s.createElement(a.SplitItem,null,s.createElement(a.Bullseye,null,s.createElement("span",{className:Se},"to"))),s.createElement(a.SplitItem,null,s.createElement(a.DatePicker,{placeholder:"End",inputProps:h,validators:i,onChange:c,value:d,ref:p})))},Ae=e=>{const t=s.useMemo((()=>Object.values(de).map((e=>s.createElement(a.SelectOption,{key:e,value:new Ie(e)})))),[]),[n,l]=s.useState(!1),i=s.useCallback((()=>l((e=>!e))),[l]),o=s.useMemo((()=>new Ie(e.value)),[e.value]),r=s.useCallback(((t,n)=>{const a=e.setValue;n instanceof Ie&&(a(n.value),l(!1))}),[e.setValue]);return s.createElement(a.Split,null,s.createElement(a.SplitItem,null,s.createElement(a.Select,{isOpen:n,variant:a.SelectVariant.single,onToggle:i,selections:o,onSelect:r},t)),e.value===de.CUSTOM&&s.createElement(a.SplitItem,null,s.createElement(we,{period:e.period,setPeriod:e.setPeriod,retentionDays:e.retentionDays})))};var Le=n(76871),De=n(71652),Pe=n(89887),Oe=n(12990),xe=n(4088),Fe=n(32564),Re=n(54971);const Ge=()=>s.createElement(Re.q,{text:"Failure"},s.createElement(R.ExclamationCircleIcon,{"data-testid":"fail-icon",color:Oe.Q.value})),Be=()=>s.createElement(Re.q,{text:"Unknown"},s.createElement(R.UnknownIcon,{"data-testid":"unknown-icon"})),Me=()=>s.createElement(Re.q,{text:"Processing"},s.createElement(R.InProgressIcon,{"data-testid":"in-progress-icon"})),Ue=()=>s.createElement(Re.q,{text:"Sent"},s.createElement(R.CheckCircleIcon,{"data-testid":"success-icon",color:xe.g.value})),Ve=()=>s.createElement(Re.q,{text:"Success"},s.createElement(R.CheckCircleIcon,{"data-testid":"success-icon",color:xe.g.value})),_e=()=>s.createElement(Re.q,{text:"Warning"},s.createElement(R.ExclamationTriangleIcon,{color:Fe.k.value})),Ze=[[s.createElement(Ve,{key:"status-success"}),"The notification was executed successfully"],[s.createElement(Ue,{key:"status-sent"}),"The notification was sent for processing - but there is no way to assert if it was executed successfully"],[s.createElement(_e,{key:"status-warning"}),"The notification was executed successfully after some retries"],[s.createElement(Me,{key:"status-processing"}),"The notification was sent for processing and is awaiting an outcome result"],[s.createElement(Ge,{key:"status-failed-externally"}),"An unexpected error occurred while processing the notification"]],$e=e=>s.createElement(Pe.d,{title:"Action status meaning",tableBody:Ze},s.createElement(s.Fragment,null,e.children));var He=n(36441),ze=n(21095);const qe=(0,u.style)({minWidth:(0,ge.important)("90px")}),We=(0,u.style)({color:He.D.value}),Qe=e=>{const{action:{id:t},getIntegrationRecipient:n}=e,l=(0,ze.Z)((async()=>t&&n(t)),[t,n]);return s.createElement(Le.TableComposable,{borders:!1,variant:Le.TableVariant.compact,isStickyHeader:!0},s.createElement(Le.Thead,null,s.createElement(Le.Tr,null,s.createElement(Le.Th,{className:qe},"Action"),s.createElement(Le.Th,{className:qe},"Recipient"),s.createElement(Le.Th,{className:qe},"Status"))),s.createElement(Le.Tbody,null,s.createElement(Le.Tr,null,s.createElement(Le.Td,null,v.ZP.integrations.types[e.action.endpointType].action),s.createElement(Le.Td,null,t?l.loading?s.createElement(a.Skeleton,{width:"150px"}):l.value:s.createElement(a.Tooltip,{content:"The integration no longer exists, it could have been deleted."},s.createElement("span",null,"Unknown integration"))),s.createElement(Le.Td,null,s.createElement("div",null,(e=>{switch(e.last){case"SUCCESS":return e.isDegraded?s.createElement(_e,null):s.createElement(Ve,null);case"SENT":return s.createElement(Ue,null);case"PROCESSING":return s.createElement(Me,null);case"FAILED":return s.createElement(Ge,null);case"UNKNOWN":return s.createElement(Be,null);default:(0,ce.ZP)(e.last)}})(e.action.status)),e.action.successCount>1&&s.createElement("div",{className:We},e.action.successCount," ",e.action.endpointType===te.WN.EMAIL_SUBSCRIPTION?"emails sent":"succeeded"," "),e.action.errorCount>1&&s.createElement("div",{className:We},e.action.errorCount," ",e.action.endpointType===te.WN.EMAIL_SUBSCRIPTION?"emails failed":"failed"," ")))))};var Ye;!function(e){e[e.EVENT=0]="EVENT",e[e.SERVICE=1]="SERVICE",e[e.DATE=2]="DATE"}(Ye||(Ye={}));const je=(0,u.style)({cursor:"pointer"}),Ke=e=>{switch(e.last){case"FAILED":return{color:"red",icon:s.createElement(R.ExclamationCircleIcon,null)};case"SENT":case"SUCCESS":return e.isDegraded?{color:"orange",icon:s.createElement(R.ExclamationTriangleIcon,null)}:{color:"green",icon:s.createElement(R.CheckCircleIcon,null)};case"PROCESSING":return{color:"grey",icon:s.createElement(R.InProgressIcon,null)};case"UNKNOWN":return{color:"grey",icon:s.createElement(R.UnknownIcon,null)};default:(0,ce.ZP)(e.last)}},Je=e=>{const t=s.useCallback(((t,n,a,l)=>{(0,e.onSort)(n,a)}),[e.onSort]),n=s.useMemo((()=>({[Ye.EVENT]:void 0,[Ye.SERVICE]:void 0,[Ye.DATE]:{sortBy:{direction:e.sortDirection,index:e.sortColumn},columnIndex:Ye.DATE,onSort:t}})),[e.sortColumn,e.sortDirection,t]),i=s.useMemo((()=>{const t=e.events;return e.loading?[...Array(10)].map(((e,t)=>s.createElement(Le.Tr,{key:`loading-row-${t}`},s.createElement(Le.Td,null,s.createElement(a.Skeleton,null)),s.createElement(Le.Td,null,s.createElement(a.Skeleton,null)),s.createElement(Le.Td,null,s.createElement(a.Skeleton,null)),s.createElement(Le.Td,null,s.createElement(a.Skeleton,null))))):t.map((t=>s.createElement(Le.Tr,{key:t.id},s.createElement(Le.Td,null,t.event),s.createElement(Le.Td,null,t.application," - ",t.bundle),s.createElement(Le.Td,null,t.actions.length>0?s.createElement(a.LabelGroup,null,t.actions.map((t=>s.createElement(a.Popover,{key:t.id,hasAutoWidth:!0,bodyContent:s.createElement(Qe,{action:t,getIntegrationRecipient:e.getIntegrationRecipient})},s.createElement(a.Label,{className:je,...Ke(t.status)},v.ZP.integrations.types[t.endpointType].action))))):"No actions"),s.createElement(Le.Td,null,s.createElement(l.DateFormat,{type:"exact",date:t.date})))))}),[e.loading,e.events,e.getIntegrationRecipient]);return 0===i.length?s.createElement(De.G,{variant:a.EmptyStateVariant.full,title:P.V.components.eventLog.table.notFound.title,description:P.V.components.eventLog.table.notFound.description}):s.createElement(Le.TableComposable,{isStickyHeader:!0},s.createElement(Le.Thead,null,s.createElement(Le.Tr,null,s.createElement(Le.Th,{sort:n[Ye.EVENT]},"Event type"),s.createElement(Le.Th,{sort:n[Ye.SERVICE]},"Service"),s.createElement(Le.Th,null,"Action taken ",s.createElement($e,null,s.createElement(a.Button,{variant:a.ButtonVariant.plain},s.createElement(R.HelpIcon,null)))),s.createElement(Le.Th,{sort:n[Ye.DATE]},"Date and time"))),s.createElement(Le.Tbody,null,i))};var Xe=n(37655),et=n(69930);const tt=()=>{const e=(0,o.getInsights)(),t=(0,o.getInsightsEnvironment)(e);return(0,v.Lk)(t)};var nt,at=n(56437),lt=n(37869);!function(e){e.EVENT="event",e.BUNDLE="bundle",e.APPLICATION="application",e.ACTION_TYPE="endpointTypes",e.ACTION_STATUS="invocationResults"}(nt||(nt={}));const it=(e,t,n)=>!(!e||!t)&&(e===t||e.length===t.length&&e.every(((a,l)=>!!(n&&t.includes(a)||!n&&e[l]===t[l])))),ot=e=>!!e.checkProps.checked,rt=e=>e.children?e.children.some((e=>rt(e))):ot(e),st=e=>e.children?e.children.every((e=>st(e))):ot(e),ct=e=>{const{groups:t,placeholder:n,filters:l,updateFilters:i}=e,o=c().useMemo((()=>((e,t)=>{const n={};return e.forEach((e=>{var a;const l=t.find((t=>t.bundleId===e.name)),i=null===(a=null==l?void 0:l.chips)||void 0===a?void 0:a.map((e=>e.value)),o=e.children,r=0!==o.length&&o.every((e=>null==i?void 0:i.includes(e.name)));n[e.name]={id:e.name,name:e.displayName,checkProps:{checked:r||!!l&&null},children:0!==o.length?o.map((e=>({id:e.name,name:e.displayName,checkProps:{checked:r||(null==i?void 0:i.includes(e.name))}}))):void 0}})),n})(t,l)),[t,l]),[r,s]=c().useState(o),[u,d]=c().useState(!1),m=c().useMemo((()=>Object.values(r)),[r]),[p,E]=c().useMemo((()=>{const e=[];return[m.filter((e=>e.checkProps.checked||null===e.checkProps.checked)).map((t=>{var n,a;return e.push(t.id),{bundleId:t.id,category:t.name,chips:null!==(a=null===(n=t.children)||void 0===n?void 0:n.filter((e=>e.checkProps.checked)).map((e=>({name:e.name,value:e.id,isRead:!0}))))&&void 0!==a?a:[{name:t.name,value:t.id,isRead:!0}]}})),e]}),[m]);return c().useEffect((()=>{0!==t.length&&s((0,Ce.ZP)((e=>0===Object.keys(e).length||0===l.length?o:void l.forEach((t=>{var n;const a=e[t.bundleId],l=t.chips.map((e=>e.value));null===(n=a.children)||void 0===n||n.forEach((e=>{e.checkProps.checked=l.includes(e.id)})),st(a)?a.checkProps.checked=!0:rt(a)?a.checkProps.checked=null:a.checkProps.checked=!1})))))}),[t,l,o]),c().useEffect((()=>{i((0,Ce.ZP)((e=>{if(0===e.length&&0===p.length)return e;if(0!==e.length&&0===p.length)return[];{const t=e.map((e=>e.bundleId));return it(t,E)&&p.every(((t,n)=>{if(e[n]&&t.bundleId===e[n].bundleId){const a=e[n].chips.map((e=>e.value)),l=t.chips.map((e=>e.value));return it(a,l,!0)}return!1}))?e:p}})))}),[p,E,i]),c().createElement(a.Dropdown,{toggle:c().createElement(a.DropdownToggle,{onToggle:()=>d(!u),toggleIndicator:R.AngleDownIcon},n),isOpen:u},c().createElement(a.TreeView,{data:m,hasChecks:!0,onCheck:(e,t,n)=>{((e,t,n)=>{const a=e.target.checked;s((0,Ce.ZP)((e=>{var l;if(n){const l=e[n.id].children;null==l||l.some((e=>e.id===t.id&&(e.checkProps.checked=a,!0))),st(e[n.id])?e[n.id].checkProps.checked=!0:rt(e[n.id])?e[n.id].checkProps.checked=null:e[n.id].checkProps.checked=a}else e[t.id].checkProps.checked=a,null===(l=e[t.id].children)||void 0===l||l.forEach((e=>e.checkProps.checked=a))})))})(e,t,n)}}))},ut={[at.k$.EMAIL_SUBSCRIPTION]:{name:"Email"},[at.k$.DRAWER]:{name:"Drawer"},[at.k$.INTEGRATION]:{name:"Integration"}},dt=(0,u.style)({color:Xe.F.value}),mt=[{value:"true",chipValue:"Success",label:s.createElement("span",null,s.createElement(R.CheckCircleIcon,{color:"green"})," Success")},{value:"false",chipValue:"Sent",label:s.createElement("span",null,s.createElement(R.CheckCircleIcon,{color:"green"})," Sent")},{value:"false",chipValue:"Warning",label:s.createElement("span",null,s.createElement(R.ExclamationTriangleIcon,{className:dt})," Warning ")},{value:"false",chipValue:"Processing",label:s.createElement("span",null,s.createElement(R.InProgressIcon,null)," Processing ")},{value:"false",chipValue:"Failure",label:s.createElement("span",null,s.createElement(R.ExclamationCircleIcon,{color:"red"})," Failure")}],pt=e=>{const t=tt(),n=(0,et.N)(),i=s.useMemo((()=>t.map((e=>({value:e.toUpperCase(),chipValue:ut[e].name,label:ut[e].name}))).concat(n.map((e=>({value:e.toUpperCase(),chipValue:v.ZP.integrations.types[e].name,label:v.ZP.integrations.types[e].name}))))),[t,n]),r=s.useMemo((()=>({[nt.EVENT]:{label:"Event",placeholder:"Filter by event"},[nt.APPLICATION]:{label:"Application",placeholder:"Filter by application"},[nt.ACTION_TYPE]:{label:"Action Type",placeholder:"Filter by action type",options:{exclusive:!1,items:i}},[nt.ACTION_STATUS]:{label:"Action Status",placeholder:"Filter by action status",options:{exclusive:!1,items:mt}}})),[i]),u=((e,t,n,a,l)=>{const[i,r]=c().useState([]),s=(0,o.usePrimaryToolbarFilterConfig)(nt,t,n,a,l),u=c().useMemo((()=>s.activeFiltersConfig.onDelete),[s.activeFiltersConfig.onDelete]),d=c().useCallback(((e,t)=>{const n=[],a=[];t.forEach((e=>{e.bundleId?a.push(e):n.push(e)})),u(e,n),0!==a.length&&r((0,Ce.ZP)((e=>{const t=[];e.forEach(((e,n)=>{a.some((a=>{if(e.bundleId===a.bundleId){const l=a.chips.map((e=>e.value));return e.chips=e.chips.filter((e=>!l.includes(e.value))),0===e.chips.length&&t.push(n),!0}return!1}))})),t.forEach(((t,n)=>{e.splice(t-n,1)}))})))}),[u,r]),m=c().useCallback(((e,t)=>{var n,a;const l=(e,t,n)=>({bundleId:e,category:(null==t?void 0:t.displayName)||`${e} Loading...`,chips:(null==t?void 0:t.children)?0!==(null==n?void 0:n.length)?null==n?void 0:n.map((e=>({name:e.displayName,value:e.name,isRead:!0}))):[{name:t.displayName,value:t.name,isRead:!0}]:[{name:"Loading",value:e,isRead:!0}]}),i={};null===(n=e.application)||void 0===n||n.forEach((e=>{const t=e.split("."),n=t[0],a=t[1];i[n]?i[n].push(a):i[n]=[a]}));const o=Object.keys(i).map((e=>{var n;const a=null==t?void 0:t.find((t=>t.name===e)),o=null===(n=null==a?void 0:a.children)||void 0===n?void 0:n.filter((t=>i[e].includes(t.name)));return l(e,a,o)}));return((null===(a=e.bundle)||void 0===a?void 0:a.map((e=>{const n=null==t?void 0:t.find((t=>t.name===e));return l(e,n,null==n?void 0:n.children)})))||[]).concat(o)}),[]);c().useEffect((()=>{r(m(t,0!==e.length?e:void 0))}),[e,m]);const p=c().useMemo((()=>({label:"Application",type:"custom",filterValues:{children:c().createElement(ct,{groups:e,placeholder:"Filter by Application",filters:i,updateFilters:r})}})),[e,i]),E=c().useMemo((()=>s.activeFiltersConfig.filters.filter((e=>e&&!e.bundleId)).concat(i)),[i,s.activeFiltersConfig.filters]),g=c().useMemo((()=>(0,Ce.ZP)(t.bundle,(t=>{if(0===e.length)return;const n=[];return e.forEach((e=>{i.some((t=>{var n,a;return t.bundleId===e.name&&(0===(null===(n=e.children)||void 0===n?void 0:n.length)&&1===t.chips.length||(null===(a=e.children)||void 0===a?void 0:a.length)===t.chips.length)}))&&n.push(e.name)})),it(t,n,!0)?t:n}))),[e,t.bundle,i]),v=c().useMemo((()=>(0,Ce.ZP)(t.application,(t=>{if(0===e.length)return;const n=[];return i.forEach((t=>{var a,l;const i=e.find((e=>e.name===t.bundleId)),o=null===(a=t.chips)||void 0===a?void 0:a.map((e=>e.value));o&&(null===(l=i.children)||void 0===l?void 0:l.some((e=>!o.includes(e.name))))&&o.forEach((e=>{const t=`${i.name}.${e}`;n.push(t)}))})),it(t,n,!0)?t:n}))),[e,t.application,i]);return n.bundle(g),n.application(v),(0,Ce.ZP)(s,(e=>{e.filterConfig.items[1]=p,e.activeFiltersConfig.filters=E,e.activeFiltersConfig.onDelete=d}))})(e.bundleOptions,e.filters,e.setFilters,e.clearFilter,r),d=s.useCallback(((t,n)=>{(0,e.pageChanged)(n)}),[e.pageChanged]),m=s.useCallback(((t,n)=>{(0,e.perPageChanged)(n)}),[e.perPageChanged]),p=s.useMemo((()=>({itemCount:e.count,page:e.page,perPage:e.perPage,isCompact:!0,variant:a.PaginationVariant.top,onSetPage:d,onFirstClick:d,onPreviousClick:d,onNextClick:d,onLastClick:d,onPageInput:d,onPerPageSelect:m})),[e.count,e.page,e.perPage,d,m]),E=s.useMemo((()=>({...p,isCompact:!1,variant:a.PaginationVariant.bottom})),[p]);return s.createElement("div",{...(0,lt.k)("Notifications/EventLog/DualToolbar",e)},s.createElement(l.PrimaryToolbar,{...u,filterConfig:u.filterConfig,activeFiltersConfig:u.activeFiltersConfig,dedicatedAction:s.createElement(Ae,{value:e.dateFilter,setValue:e.setDateFilter,retentionDays:e.retentionDays,setPeriod:e.setPeriod,period:e.period}),pagination:p}),e.children,s.createElement(l.PrimaryToolbar,{pagination:E}))};var Et=n(43542);const gt=(0,u.style)({paddingTop:me.S.value}),vt=(0,u.style)({marginLeft:Et.p.value}),ht=e=>s.createElement(l.PageHeader,{className:"pf-u-pb-0"},s.createElement(a.Split,null,s.createElement(a.SplitItem,{isFilled:!0},s.createElement(l.PageHeaderTitle,{title:e.title}),s.createElement(a.TextContent,{className:gt},s.createElement(a.Text,null,e.subtitle))),e.action&&s.createElement(a.SplitItem,{className:vt},e.action)));var ft=n(2028),yt=n(77836);const bt=e=>({id:e.id,bundle:e.bundle,application:e.application,event:e.event_type,date:(0,o.fromUtc)(new Date(e.created)),actions:Ct(Tt(e.actions))}),Ct=e=>e.sort(((e,t)=>e.endpointType.localeCompare(t.endpointType))),Tt=e=>{const t={},n=[];return e.forEach((e=>{if(e.endpoint_id)if(t[e.endpoint_id]){const n=St(e),a=t[e.endpoint_id];kt(n.status.last)?a.status.isDegraded=!0:a.status.last=n.status.last,a.errorCount+=n.errorCount,a.successCount+=n.successCount}else t[e.endpoint_id]=St(e);else n.push(St(e))})),[...Object.values(t),...n]},St=e=>{var t;return{id:null!==(t=e.endpoint_id)&&void 0!==t?t:void 0,endpointType:(0,yt.LW)({type:e.endpoint_type,sub_type:e.endpoint_sub_type}),status:{last:e.status,isDegraded:kt(e.status)},successCount:kt(e.status)?0:1,errorCount:kt(e.status)?1:0}},kt=e=>"FAILED"===e,It=(0,Z.validationResponseTransformer)((e=>200===e.status?(0,Z.validatedResponse)("Events",200,{...e.value,data:e.value.data.map(bt)},e.errors):e));var Nt=n(45295);const wt=e=>Nt.B.EndpointResourceGetEndpoint.actionCreator({id:e});var At=n(33479),Lt=n(19013);const Dt="yyyy-MM-dd",Pt=()=>{const e=(0,m.useFlag)("platform.notifications.overhaul"),t=(0,b.useParameterizedQuery)(wt),{rbac:n}=(0,g.b)(),l=T(!0),i=s.useMemo((()=>{const e=l.payload;return 200===(null==e?void 0:e.status)?e.value:[]}),[l.payload]),[c,u]=s.useState(de.LAST_14),d=((e=250)=>{const t=(0,s.useMemo)((()=>{const e=()=>(0,o.useUrlStateMultipleOptions)("application"),t=()=>(0,o.useUrlStateMultipleOptions)("bundle"),n=()=>(0,o.useUrlStateMultipleOptions)("endpointTypes"),a=()=>(0,o.useUrlStateMultipleOptions)("invocationResults"),l=()=>(0,o.useUrlStateString)("event");return i=>{switch(i){case nt.APPLICATION:return e;case nt.BUNDLE:return t;case nt.EVENT:return l;case nt.ACTION_TYPE:return n;case nt.ACTION_STATUS:return a;default:(0,ce.ZP)(i)}}}),[]);return(0,o.useFilters)(nt,e,t)})(),[p,E]=s.useState([void 0,void 0]),[h,f]=s.useState("desc"),[y,S]=s.useState(Ye.DATE),k=s.useCallback(((e,t)=>{f(t),S(e)}),[f,S]),N=((e,t,n)=>(0,s.useCallback)((a=>{const l=new o.Filter;if(null==a?void 0:a.bundle){const t=null==a?void 0:a.bundle,n=e.filter((e=>t.includes(e.name))).map((e=>e.id));l.and("bundleIds",o.Operator.EQUAL,n)}if(null==a?void 0:a.application){const t=a.application,n=[];t.forEach((t=>{var a;const l=t.split("."),i=l[0],o=l[1],r=e.find((e=>e.name===i));if(r){const e=null===(a=r.children)||void 0===a?void 0:a.find((e=>e.name===o));e&&n.push(e.id)}})),l.and("appIds",o.Operator.EQUAL,n)}(null==a?void 0:a.event)&&l.and("event",o.Operator.EQUAL,a.event),(null==a?void 0:a.invocationResults)&&l.and("invocationResults",o.Operator.EQUAL,a.invocationResults),(null==a?void 0:a.endpointTypes)&&l.and("endpointTypes",o.Operator.EQUAL,a.endpointTypes);let i=[void 0,void 0];const s=(0,o.toUtc)(new Date);switch(t){case de.LAST_14:i=[(0,At.Z)((0,Lt.Z)(s),{days:14}),s];break;case de.LAST_7:i=[(0,At.Z)((0,Lt.Z)(s),{days:7}),s];break;case de.TODAY:i=[s,s];break;case de.YESTERDAY:const e=(0,At.Z)((0,Lt.Z)(s),{days:1});i=[e,e];break;case de.CUSTOM:i=n}return i[0]&&i[1]&&(l.and("start",o.Operator.EQUAL,(0,r.Z)(i[0],Dt)),l.and("end",o.Operator.EQUAL,(0,r.Z)(i[1],Dt))),l}),[e,t,n]))(i,c,p),w=s.useMemo((()=>{const e=h.toUpperCase();let t;if(y!==Ye.DATE)throw new Error(`Invalid sorting index: ${y}`);return t="created",o.Sort.by("created",e)}),[y,h]),A=(0,ft.q)(v.ZP.paging.defaultPerPage,N,d.filters,w),L=(e=>{const t=(null!=e?e:o.Page.defaultPage()).toQuery();return(0,o.useTransformQueryResponse)((0,b.useQuery)(C.B.EventResourceGetEvents.actionCreator({limit:+t.limit,offset:+t.offset,bundleIds:t.filterBundleIds,appIds:t.filterAppIds,invocationResults:t.filterInvocationResults,endpointTypes:t.filterEndpointTypes,startDate:t.filterStart,endDate:t.filterEnd,eventTypeDisplayName:t.filterEvent,sortBy:`${t.sortColumn}:${t.sortDirection}`,includeActions:!0})),It)})(A.page),D=s.useMemo((()=>{var e;return 200===(null===(e=L.payload)||void 0===e?void 0:e.status)?{data:L.payload.value.data,count:L.payload.value.meta.count}:{data:[],count:0}}),[L]),O=s.useMemo((()=>{const e=d.filters.bundle;return e&&e.length>0?Hl.notifications(e[0]):Hl.notifications("")}),[d.filters]),x=s.useCallback((async e=>{var n;const a=t.query,l=await a(e);if("Endpoint"===(null===(n=l.payload)||void 0===n?void 0:n.type)){const e=l.payload.value.type;switch(e){case"camel":case"webhook":case"ansible":return l.payload.value.name;case"email_subscription":case"drawer":return l.payload.value.properties.only_admins?"Users: Admin":"Users: All";default:(0,ce.ZP)(e)}}return"Error while loading"}),[t.query]);return s.createElement(s.Fragment,null,s.createElement(ht,{title:P.V.pages.notifications.eventLog.title,subtitle:P.V.pages.notifications.eventLog.subtitle,action:!e&&s.createElement(ue,{isDisabled:!n.canReadEvents,to:O,variant:a.ButtonVariant.secondary},P.V.pages.notifications.eventLog.viewNotifications)}),s.createElement(I,null,s.createElement(pt,{...d,bundleOptions:i,dateFilter:c,setDateFilter:u,count:D.count,perPageChanged:A.changeItemsPerPage,pageChanged:A.changePage,perPage:A.page.size,page:A.page.index,pageCount:D.data.length,retentionDays:14,period:p,setPeriod:E},s.createElement(Je,{events:D.data,loading:L.loading,onSort:k,sortColumn:y,sortDirection:h,getIntegrationRecipient:x}))))},Ot=()=>{const e=(0,l.useOuia)({type:"AppSkeleton"});return s.createElement("div",{...e},s.createElement(l.PageHeader,null,s.createElement("div",{className:"pf-c-content"},s.createElement(l.PageHeaderTitle,{title:s.createElement(l.Skeleton,{size:"sm"})}))),s.createElement(I,null,s.createElement(l.Section,null,s.createElement(a.Bullseye,null,s.createElement(l.Spinner,{centered:!0})))))},xt=e=>C.B.NotificationResourceGetApplicationsFacets.actionCreator({bundleName:e});var Ft=n(64799),Rt=n(28551);const Gt=(0,u.style)({backgroundColor:Ft.C.var}),Bt=(0,u.style)({paddingLeft:Rt.J.value}),Mt=e=>{const[t,n]=c().useState(0),l=c().useCallback((e=>{n(e)}),[]);return c().createElement("div",{className:Gt},c().createElement(a.Tabs,{className:Bt,defaultActiveKey:t,role:"region",onClick:l},e.children))};var Ut=n(78343),Vt=n(65326);const _t=e=>C.B.OrgConfigResourceSaveDailyDigestTimePreference.actionCreator({body:e.body});var Zt=n(21503);const $t=(0,u.style)({width:"280px"}),Ht=(0,u.style)({paddingLeft:Rt.J.value}),zt=()=>{var e,t;const[n,l]=c().useState(!1),[i,o]=c().useState(),r=(0,b.useQuery)(C.B.OrgConfigResourceGetDailyDigestTimePreference.actionCreator()),u=(0,b.useMutation)(_t),{addSuccessNotification:d,addDangerNotification:m}=(0,Zt.l)(),p=(0,s.useMemo)((()=>{var e;if(200===r.status)return null===(e=r.payload)||void 0===e?void 0:e.value}),[null===(e=r.payload)||void 0===e?void 0:e.value,r.status]);(0,s.useEffect)((()=>{p&&(o({baseCustomTime:p,utcTime:p,timezoneText:void 0}),l("00:00:00"!==p))}),[p]);const E=c().useCallback((()=>{l(!1),o({utcTime:"00:00",baseCustomTime:"00:00",timezoneText:void 0})}),[]),[g,v]=c().useState(!1),h=Vt.map((e=>c().createElement(a.DropdownItem,{key:e.text},e.text))),f=c().useCallback((()=>{l(!0)}),[]),y=c().useCallback((e=>{o({baseCustomTime:e,utcTime:e,timezoneText:void 0})}),[]),T=c().useCallback((e=>{if(null==e?void 0:e.target){const t=e.target.textContent,n=Vt.find((e=>e.text===t));n&&o((e=>{if(null==e?void 0:e.baseCustomTime){const t=e.baseCustomTime.split(":").map((e=>parseInt(e))),a=new Date;a.setUTCHours(t[0],t[1]);const l=(0,Ut.Z)(a,-n.offset),i=l.getUTCHours().toString().padStart(2,"0"),o=l.getUTCMinutes().toString().padStart(2,"0");return{...e,utcTime:`${i}:${o}`,timezoneText:n.text}}return e}))}v(!1)}),[]),S=c().useCallback((()=>{i&&(0,u.mutate)({body:i.utcTime}).then((e=>{204===e.status?d("Action settings saved",""):m("Failed to save action settings","")}))}),[m,d,u.mutate,i]),k=u.loading||r.loading;return c().createElement(c().Fragment,null,c().createElement(c().Fragment,null,c().createElement(a.Card,null,c().createElement(a.CardBody,null,c().createElement(a.Stack,{hasGutter:!0},c().createElement(a.StackItem,null,c().createElement(a.Title,{headingLevel:"h2"},"Action settings")),c().createElement(a.StackItem,null,c().createElement(a.Text,{component:a.TextVariants.p},"Daily digest email receipt"),c().createElement(a.HelperText,null,c().createElement(a.HelperTextItem,{variant:"indeterminate"},"Schedule the time at which to send your account's daily digest email. All times will be converted to UTC after saving.")))),c().createElement("br",null),c().createElement(a.Split,null,c().createElement(a.SplitItem,{isFilled:!0},c().createElement(a.Stack,{hasGutter:!0},c().createElement(a.StackItem,null,r.loading?c().createElement(a.Skeleton,null):c().createElement(a.Radio,{isChecked:!n,onChange:E,id:"settings-time-config",label:"Default time",value:"Default",description:"00:00 UTC",name:"radio-select"})),c().createElement(a.StackItem,null,r.loading?c().createElement(a.Skeleton,null):c().createElement(a.Radio,{isChecked:n,onChange:f,id:"settings-time-config-custom",label:"Custom time",name:"radio-select"})),n&&c().createElement(c().Fragment,null,c().createElement(a.StackItem,{className:Ht},c().createElement(a.Text,{component:a.TextVariants.h6},"Time"),c().createElement(a.TimePicker,{onChange:y,time:null==i?void 0:i.baseCustomTime,width:"263px",stepMinutes:15,placeholder:"00:00",is24Hour:!0})),c().createElement(a.StackItem,{className:Ht},c().createElement(a.Text,{component:a.TextVariants.h6},"Time zone"),c().createElement(a.Dropdown,{className:$t,toggle:c().createElement(a.DropdownToggle,{isOpen:g,id:"timezone",onToggle:()=>v(!g)},null!==(t=null==i?void 0:i.timezoneText)&&void 0!==t?t:"(UTC-00:00) Universal Time"),isOpen:g,onSelect:T,menuAppendTo:()=>document.body,dropdownItems:h}))))))),c().createElement(a.CardFooter,null,c().createElement(a.Button,{variant:"primary",type:"submit",isLoading:k,isDisabled:k,onClick:S},k?"Loading":"Save")))))};var qt,Wt=n(77125),Qt=n(96191);!function(e){e.ASC="asc",e.DESC="desc"}(qt||(qt={}));const Yt=Object.freeze([]),jt=Object.freeze({}),Kt=()=>c().createElement(a.EmptyState,{variant:"full"},c().createElement(a.EmptyStateIcon,{className:"pf-u-mb-xl",icon:R.SearchIcon}),c().createElement(a.Title,{headingLevel:"h2",size:"lg"},"No results found"),c().createElement(a.EmptyStateBody,null,c().createElement(a.TextContent,null,c().createElement(a.Text,null,"No notifications match your filter choices above. Try removing or changing the filters to see results."))));var Jt=n(98133),Xt=n(53426);const en=e=>{return t=e,"id",e=>e.id===t;var t},tn=(0,u.style)({color:He.D.value}),nn=(0,u.style)({textAlign:"left"}),an=(0,u.style)({marginRight:me.S.value}),ln=(0,u.style)({marginRight:Jt.Q.value}),on=()=>s.createElement("span",null,", "),rn=e=>{const t=s.useCallback((()=>{const t=e.onSelect;t&&t(e.notification,e.behaviorGroup,!1)}),[e.onSelect,e.behaviorGroup,e.notification]);return s.createElement(a.Chip,{onClick:t,isReadOnly:e.behaviorGroup.isDefault},e.behaviorGroup.displayName)},sn=e=>{const[t,n]=s.useState(!1),l=s.useCallback((t=>{var n,a,l;const i=null!==(l=null===(a=null===(n=null==t?void 0:t.currentTarget)||void 0===n?void 0:n.firstChild)||void 0===a?void 0:a.dataset)&&void 0!==l?l:jt,o=e.onSelect;if(!e.behaviorGroupContent.isLoading&&!e.behaviorGroupContent.hasError&&o&&i.behaviorGroupId){const t=e.behaviorGroupContent.content.find(en(i.behaviorGroupId));if(t){const n=!!e.selected.find(en(t.id));o(e.notification,t,!n)}}}),[e.onSelect,e.behaviorGroupContent,e.notification,e.selected]),i=s.useMemo((()=>e.behaviorGroupContent.isLoading||e.behaviorGroupContent.hasError?[s.createElement(a.OptionsMenuItem,{key:"is-loading",isDisabled:!0},"Loading")]:0===e.behaviorGroupContent.content.length?[s.createElement(a.OptionsMenuItem,{key:"empty",isDisabled:!0},s.createElement("span",{className:nn},"You have no behavior groups. ",s.createElement("br",null),"Create a new group by clicking on the ",s.createElement("br",null),"'Create new group' button above."))]:[...e.selected.filter((e=>e.isDefault)),...e.behaviorGroupContent.content.filter((e=>!e.isDefault))].map((t=>{const n=!!e.selected.find(en(t.id));return s.createElement(a.OptionsMenuItem,{key:t.id,onSelect:l,"data-behavior-group-id":t.id,isSelected:n,isDisabled:t.isDefault},t.isDefault&&s.createElement(R.LockIcon,{className:an})," ",t.displayName)}))),[e.behaviorGroupContent,e.selected,l]),r=s.useMemo((()=>[...e.selected.filter((e=>e.isDefault)),...e.selected.filter((e=>!e.isDefault))]),[e.selected]),c=s.useMemo((()=>s.createElement(a.OptionsMenuToggle,{onToggle:n,toggleTemplate:0===r.length?s.createElement("span",{className:tn},"Select behavior group"):s.createElement(a.ChipGroup,null,r.map((t=>s.createElement(rn,{key:t.id,behaviorGroup:t,notification:e.notification,onSelect:e.onSelect}))))})),[r,e.notification,e.onSelect]),u=s.useMemo((()=>0===r.length?s.createElement(a.Split,null,s.createElement(a.SplitItem,{className:an},s.createElement(R.BellSlashIcon,{color:Xt.O.value})),s.createElement(a.SplitItem,null,"Mute")):(0,o.join)(r.map((e=>s.createElement(s.Fragment,{key:e.id},e.isDefault&&s.createElement(a.Tooltip,{content:`${e.displayName} behavior is attached to this event and cannot be changed.\n                Add additional behavior groups to assign different actions or recipients.`},s.createElement(R.LockIcon,{color:Xt.O.value,className:ln}))," ",e.displayName))),on)),[r]);return e.isEditMode?s.createElement(a.OptionsMenu,{id:e.id,direction:"down",menuItems:i,toggle:c,isOpen:t,menuAppendTo:document.body}):s.createElement(Le.TableText,{wrapModifier:"truncate"}," ",u," ")};var cn;!function(e){e[e.EVENT=0]="EVENT",e[e.APPLICATION=1]="APPLICATION",e[e.BEHAVIOR=2]="BEHAVIOR"}(cn||(cn={}));const un=(0,u.style)({float:"right"}),dn=()=>s.createElement(s.Fragment,null),mn=(e,t)=>{const n="done"!==e.loadingActionStatus;return e.isEditMode?{actionsToggle:dn,items:[{key:"done",className:un,title:s.createElement(a.Button,{"aria-label":"done",variant:a.ButtonVariant.plain,isDisabled:n},s.createElement(R.CheckIcon,{color:n?Qt.J.value:Ee.h.value})),isOutsideDropdown:!0,onClick:()=>null==t?void 0:t.onFinishEditing(e.id),isDisabled:n||!t},{key:"cancel",className:un,title:s.createElement(a.Button,{"aria-label":"cancel",variant:a.ButtonVariant.plain,isDisabled:n},s.createElement(R.CloseIcon,{color:n?Qt.J.value:pe.p.value})),isOutsideDropdown:!0,onClick:()=>null==t?void 0:t.onCancelEditing(e.id),isDisabled:n||!t}]}:{actionsToggle:dn,items:[{key:"edit",className:un,title:s.createElement(a.Button,{"aria-label":"edit",variant:a.ButtonVariant.plain,isDisabled:n},s.createElement(R.PencilAltIcon,null)),isOutsideDropdown:!0,onClick:()=>null==t?void 0:t.onStartEditing(e.id),isDisabled:n||!t}]}},pn=((e,t)=>{var n;const a=t=>s.createElement("div",{...(0,lt.k)("Notifications/Table",t)},s.createElement(e,{...t}));return a.displayName=`Ouia(${null!==(n=e.displayName)&&void 0!==n?n:e.name})`,a})((e=>{const t=s.useMemo((()=>{if(e.onStartEditing&&e.onFinishEditing&&e.onCancelEditing)return{onStartEditing:e.onStartEditing,onFinishEditing:e.onFinishEditing,onCancelEditing:e.onCancelEditing,onBehaviorGroupLinkUpdated:e.onBehaviorGroupLinkUpdated}}),[e.onStartEditing,e.onFinishEditing,e.onCancelEditing,e.onBehaviorGroupLinkUpdated]),n=s.useCallback(((t,n,a,l)=>{(0,e.onSort)(n,(e=>{switch(e.toLowerCase()){case qt.ASC:return qt.ASC;case qt.DESC:return qt.DESC;default:throw new Error(`Invalid sort direction ${e}`)}})(a))}),[e.onSort]),l=s.useMemo((()=>{const t={direction:e.sortDirection,index:e.sortBy};return{[cn.EVENT]:{sortBy:t,columnIndex:cn.EVENT,onSort:n},[cn.APPLICATION]:{sortBy:t,columnIndex:cn.APPLICATION,onSort:n},[cn.BEHAVIOR]:void 0}}),[e.sortDirection,e.sortBy,n]),i=s.useMemo((()=>{const n=e.notifications,l=e.behaviorGroupContent;return n.map((e=>{var n;return s.createElement(Le.Tr,{key:e.id},s.createElement(Le.Td,null,e.eventTypeDisplayName),s.createElement(Le.Td,null,e.applicationDisplayName),s.createElement(Le.Td,null,"loading"===e.loadingActionStatus?s.createElement(a.Skeleton,{width:"90%"}):s.createElement(sn,{id:`behavior-group-cell-${e.id}`,notification:e,behaviorGroupContent:l,selected:null!==(n=e.behaviors)&&void 0!==n?n:Yt,onSelect:null==t?void 0:t.onBehaviorGroupLinkUpdated,isEditMode:e.isEditMode})),s.createElement(Le.Td,{actions:mn(e,t)}))}))}),[e.notifications,e.behaviorGroupContent,t]);return s.createElement(Le.TableComposable,{"aria-label":"Notifications",isStickyHeader:!0,variant:Le.TableVariant.compact},s.createElement(Le.Thead,null,s.createElement(Le.Tr,null,s.createElement(Le.Th,{sort:l[cn.EVENT]},"Event"),s.createElement(Le.Th,{sort:l[cn.APPLICATION]},"Application"),s.createElement(Le.Th,{sort:l[cn.BEHAVIOR],width:35},"Behavior"),s.createElement(Le.Th,null))),s.createElement(Le.Tbody,null,0===e.notifications.length?s.createElement(Kt,null):i))}));var En,gn,vn=n(55490),hn=n(58399);!function(e){e.NAME="name",e.APPLICATION="application",e.ACTION="action"}(En||(En={})),function(e){e[e.NONE=0]="NONE",e[e.PAGE=1]="PAGE",e[e.ALL=2]="ALL"}(gn||(gn={}));const fn=[En.NAME,En.APPLICATION,En.ACTION],yn=e=>{var t;const n=(0,o.getInsights)(),i=null!==(t=e.filterColumns)&&void 0!==t?t:fn,r=(0,s.useMemo)((()=>{const t=e.appFilterOptions.map((e=>({value:e.displayName,label:s.createElement(s.Fragment,null," ",e.displayName)})));return{[En.NAME]:i.includes(En.NAME)?{label:"Event type",placeholder:"Filter by event type"}:void 0,[En.APPLICATION]:i.includes(En.APPLICATION)?{label:"Application",placeholder:"Filter by application",options:{exclusive:!1,default:[],items:t}}:void 0,[En.ACTION]:i.includes(En.ACTION)&&(0,hn.Zg)(n)?{label:"Action",placeholder:"Filter by action"}:void 0}}),[e.appFilterOptions,n,i]),c=s.useMemo((()=>{var t;const n=e.onSelectionChanged,a=e.count,l=e.pageAdapter,i=e.selectedCount,o=l.page.size;if(!n)return;const r=()=>n(gn.ALL),s=()=>n(gn.NONE);return{count:null!=i?i:0,items:[{title:"Select none (0)",onClick:s},{title:`Select page (${null!==(t=e.pageCount)&&void 0!==t?t:o})`,onClick:()=>n(gn.PAGE)},{title:`Select all (${a})`,onClick:r}],checked:0!==i&&i===a,onSelect:e=>e?r():s(),isDisabled:e.bulkSelectionDisabled}}),[e.onSelectionChanged,e.selectedCount,e.pageAdapter,e.count,e.bulkSelectionDisabled,e.pageCount]),u=(0,o.usePrimaryToolbarFilterConfig)(En,e.filters,e.setFilters,e.clearFilter,r),d=(0,vn.B)(e.onExport),m=u.filterConfig,p=u.activeFiltersConfig,E=(0,o.useInsightsEnvironmentFlag)((0,o.getInsights)(),hn._n,void 0,(0,s.useCallback)((()=>d),[d])),g=s.useCallback(((t,n)=>{(0,e.pageAdapter.changePage)(n)}),[e.pageAdapter]),v=s.useCallback(((t,n)=>{(0,e.pageAdapter.changeItemsPerPage)(n)}),[e.pageAdapter]),h=s.useMemo((()=>({itemCount:e.count,page:e.pageAdapter.page.index,perPage:e.pageAdapter.page.size,isCompact:!0,variant:a.PaginationVariant.top,onSetPage:g,onFirstClick:g,onPreviousClick:g,onNextClick:g,onLastClick:g,onPageInput:g,onPerPageSelect:v})),[e.count,e.pageAdapter,g,v]),f=s.useMemo((()=>({...h,isCompact:!1,variant:a.PaginationVariant.bottom})),[h]);return s.createElement("div",{...(0,lt.k)("Notifications/DualToolbar",e)},s.createElement(l.PrimaryToolbar,{bulkSelect:c,filterConfig:m,activeFiltersConfig:p,exportConfig:E,pagination:h}),e.children,s.createElement(l.PrimaryToolbar,{pagination:f}))},bn=(e,t,n)=>{const a=((e,t,n=250)=>{const a=(0,s.useMemo)((()=>{const n=e=>(0,o.useUrlStateString)("name",e),a=t=>(0,o.useUrlStateMultipleOptions)("app",e,t),l=e=>(0,o.useUrlStateString)("action",e);return e=>{switch(e){case En.NAME:return t?n:s.useState;case En.ACTION:return t?l:s.useState;case En.APPLICATION:return t?a:s.useState;default:(0,ce.vE)(e)}}}),[]);return(0,o.useFilters)(En,n,a)})(t.map((e=>e.displayName.toString())),n),l=((e,t)=>(0,s.useCallback)((n=>{const a=new o.Filter,l=n&&n[En.APPLICATION];if(l){const e=[];for(const n of(0,o.arrayValue)(l)){const a=t.find((e=>e.displayName===n));a&&e.push(a.id)}a.and("applicationId",o.Operator.EQUAL,e)}a.and("bundleId",o.Operator.EQUAL,e.id);const i=n&&n[En.NAME];if(i){const e=(0,o.stringValue)(i);a.and("eventFilterName",o.Operator.EQUAL,e)}return a}),[e,t]))(e,t),[i,r]=s.useState({sortDirection:qt.ASC,sortBy:cn.APPLICATION}),c=s.useCallback(((e,t)=>{r({sortBy:e,sortDirection:t})}),[r]),u=s.useMemo((()=>{const e=i.sortDirection.toUpperCase();let t;switch(i.sortBy){case cn.APPLICATION:t="application";break;case cn.EVENT:t="display_name";break;default:throw new Error(`Invalid sorting index: ${i.sortBy}`)}return o.Sort.by(t,e)}),[i]);return{pageController:(0,ft.q)(v.ZP.paging.defaultPerPage,l,a.filters,u),onSort:c,sortBy:i.sortBy,sortDirection:i.sortDirection,filters:a.filters,setFilters:a.setFilters,clearFilters:a.clearFilter}};var Cn=n(36219),Tn=n(49836),Sn=n(15173),kn=n(36853);const In=n.p+"fonts/WebhookIcon.svg",Nn=(0,u.style)({verticalAlign:"-0.125em",width:"1em",height:"1em"}),wn=()=>s.createElement("img",{alt:"Webhook",className:Nn,src:In}),An=(0,u.style)({marginLeft:me.S.var}),Ln=(0,u.style)({color:"#888"}),Dn=e=>{switch(e.actionType){case at.k$.DRAWER:return s.createElement(kn.ZP,null);case at.k$.EMAIL_SUBSCRIPTION:return s.createElement(R.EnvelopeIcon,null);case at.k$.INTEGRATION:return s.createElement(wn,null);default:(0,ce.vE)(e.actionType)}},Pn=e=>s.createElement("div",{...(0,lt.k)("Notifications/ActionComponent",e)},e.children),On=e=>e.loading?s.createElement(Pn,{...e},s.createElement(a.Spinner,{size:"md"})):e.hasError?s.createElement(Pn,{...e},s.createElement("span",null,"Error loading actions")):e.action?s.createElement(Pn,{...e},s.createElement(Dn,{actionType:e.action.type}),s.createElement("span",{className:An},v.ZP.notifications.types[e.action.type].name),e.action.type===at.k$.INTEGRATION&&s.createElement("span",null,": ",v.ZP.integrations.types[e.action.integration.type].name)):s.createElement(Pn,{...e},s.createElement("span",{className:Ln},s.createElement("div",null,"No actions."),s.createElement("div",null,"Users will not be notified.")));var xn=n(69696),Fn=n(13986);const Rn=(0,u.style)({color:Fn.C.value}),Gn=e=>{const t="User Access group (Not found)";return s.createElement(a.Tooltip,{content:"This User Access group was not found, and may have been deleted. Remove it from your behavior group to stop seeing it."},e.onClose?s.createElement(a.Label,{variant:"outline",color:"red",onClose:e.onClose},t):s.createElement("span",{className:Rn}," ",t," "))},Bn=(0,u.style)({marginLeft:me.S.var,color:Qt.J.value}),Mn=(0,u.style)({color:Qt.J.value}),Un=()=>s.createElement("span",null,", "),Vn=e=>{if(e.action.type===at.k$.INTEGRATION)return s.createElement(s.Fragment,null,e.action.integration.isEnabled?e.action.integration.name:s.createElement("span",{className:Mn}," ",e.action.integration.name,s.createElement(a.Tooltip,{content:"This integration has been disabled. This action wil not fire until it is enabled.",position:"bottom"},s.createElement(R.BanIcon,{className:Bn}))));const t=e.action.recipient.filter((e=>e instanceof xn.dt)),n=e.action.recipient.filter((e=>e instanceof xn.nc));return s.createElement("span",null,t.length>0&&s.createElement("div",null,"Users: ",(0,o.join)(t.map((e=>s.createElement(s.Fragment,null,e.displayName,e.ignorePreferences&&s.createElement("span",null,s.createElement(a.Tooltip,{content:"You may still receive forced notifications for this service",position:"bottom"},s.createElement(R.LockIcon,{className:Bn})))," "))),Un)),n.length>0&&s.createElement("div",null,"User Access Groups: ",(0,o.join)(n.map((e=>e.hasError?s.createElement(Gn,null):e.isLoading?s.createElement(a.Skeleton,{width:"40px"}):e.displayName)),Un)))},_n=(0,u.style)({fontSize:Sn.U.value}),Zn=e=>s.createElement(a.Grid,null,s.createElement(a.GridItem,{span:6},s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h6,className:_n},"Action"))),s.createElement(a.GridItem,{span:6},s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h6,className:_n},"Recipient"))),e.children),$n=e=>s.createElement(Zn,null,e.actions.map(((e,t)=>s.createElement(s.Fragment,{key:`${t}-${e.type}`},s.createElement(a.GridItem,{span:6},s.createElement(On,{action:e})),s.createElement(a.GridItem,{className:"pf-u-text-break-word",span:6},s.createElement(Vn,{action:e})))))),Hn=()=>{const e="150px";return s.createElement(Zn,null,[...Array(3).values()].map(((t,n)=>s.createElement(s.Fragment,{key:`skeleton-${n}`},s.createElement(a.GridItem,{span:6},s.createElement(a.Skeleton,{width:e})),s.createElement(a.GridItem,{span:6},s.createElement(a.Skeleton,{width:e}))))))},zn=e=>e.actions?s.createElement($n,{actions:e.actions}):s.createElement(Hn,null),qn=(0,u.style)({width:450,height:"100%"}),Wn=(0,u.style)({marginRight:me.S.value}),Qn=e=>{const[t,n]=s.useState(!1),l=s.useCallback((()=>n((e=>!e))),[n]);return s.createElement(a.Card,{isFlat:!0,className:qn},s.createElement(a.CardHeader,null,s.createElement(a.CardHeaderMain,null,s.createElement(a.Split,null,s.createElement(a.SplitItem,null,e.isDefaultBehavior&&s.createElement(a.Tooltip,{position:"top",appendTo:()=>document.body,content:s.createElement("div",null,"System required behavior group",s.createElement("br",null),s.createElement("br",null),"This group is system generated and can not be edited, deleted, or removed from being applied to an event")},s.createElement(R.LockIcon,{className:Wn}))),s.createElement(a.SplitItem,null,s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h4}," ",e.title," "))))),s.createElement(a.CardActions,null,!e.isDefaultBehavior&&s.createElement(a.Dropdown,{onSelect:l,toggle:s.createElement(a.KebabToggle,{onToggle:n,isDisabled:!e.dropdownItems}),isOpen:t,isPlain:!0,dropdownItems:e.dropdownItems,position:a.DropdownPosition.right,menuAppendTo:()=>document.body}))),s.createElement(a.CardBody,null,e.children))},Yn=e=>{const t=s.useCallback((()=>{const t=e.onEdit;t&&t(e.behaviorGroup)}),[e.behaviorGroup,e.onEdit]),n=s.useCallback((()=>{const t=e.onDelete;t&&t(e.behaviorGroup)}),[e.behaviorGroup,e.onDelete]),l=s.useMemo((()=>[s.createElement(a.DropdownItem,{key:"on-edit",onClick:t,isDisabled:!t}," Edit "),s.createElement(a.DropdownItem,{key:"on-delete",onClick:n,isDisabled:!n}," Delete ")]),[t,n]);return s.createElement(Qn,{title:e.behaviorGroup.displayName,dropdownItems:l,isDefaultBehavior:e.behaviorGroup.isDefault},s.createElement(zn,{actions:e.behaviorGroup.actions}))},jn=()=>s.createElement(Qn,{title:s.createElement(a.Skeleton,{width:"300px"})},s.createElement(zn,null)),Kn=e=>e.behaviorGroup?s.createElement(Yn,{...e,behaviorGroup:e.behaviorGroup}):s.createElement(jn,null),Jn=(0,u.style)({overflow:"auto"}),Xn=(0,u.style)({paddingBottom:Tn._.var}),ea=e=>s.createElement("div",{"data-testid":"ref-card-list-container"},s.createElement(a.Flex,{alignItems:{default:"alignItemsStretch"},alignContent:{default:"alignContentSpaceBetween"},flexWrap:{default:"nowrap"},className:Jn,"data-testid":"card-list-container"},e.children)),ta=e=>s.createElement(ea,null,e.behaviorGroups.map((t=>s.createElement(a.FlexItem,{key:t.id,className:Xn},s.createElement(Kn,{behaviorGroup:t,onEdit:e.onEdit,onDelete:e.onDelete}))))),na=()=>s.createElement(ea,null,[...Array(3).values()].map(((e,t)=>s.createElement(a.FlexItem,{key:`behavior-group-card-skeleton-${t}`,className:Xn},s.createElement(Kn,null))))),aa=e=>e.behaviorGroups?s.createElement(ta,{...e,behaviorGroups:e.behaviorGroups}):s.createElement(na,null);var la=n(52857),ia=n(45871),oa=n(92534);const ra=(0,u.style)({marginTop:"auto",marginBottom:14}),sa=(0,u.style)({marginRight:5}),ca=e=>{var t;const n=s.useContext(a.WizardContext);return s.createElement(a.WizardFooter,null,s.createElement(a.Button,{variant:a.ButtonVariant.primary,type:"submit",onClick:()=>{e.onNext(n.onNext)},isDisabled:e.isLoading||!n.activeStep.enableNext},null!==(t=n.activeStep.nextButtonText)&&void 0!==t?t:"Next"),!n.activeStep.hideBackButton&&s.createElement(a.Button,{variant:a.ButtonVariant.secondary,onClick:()=>{e.onBack(n.onBack)},isDisabled:0===n.activeStep.id||e.isLoading},"Back"),!n.activeStep.hideCancelButton&&s.createElement(a.Button,{variant:a.ButtonVariant.link,onClick:n.onClose,isDisabled:e.isLoading},"Cancel"),e.isLoading?s.createElement("div",{className:ra},s.createElement(a.Spinner,{size:"md"})):e.error&&s.createElement(a.Split,null,s.createElement(a.SplitItem,null,s.createElement(R.ExclamationCircleIcon,{className:sa,color:Oe.Q.value})),s.createElement(a.SplitItem,null,e.error)))},ua=e=>{const{values:t}=(0,oa.useFormikContext)(),n=(t.id?"Edit":"Create")+" behavior group";return s.createElement(oa.Form,null,s.createElement(a.Wizard,{title:n,steps:e.steps,footer:s.createElement(ca,{isLoading:e.loading,onNext:e.onNext,onBack:e.onBack}),isOpen:!0,startAtStep:1,onGoToStep:t=>{var n;return e.onGoToStep(null!==(n=t.id)&&void 0!==n?n:1)},onClose:e.onClose,onSave:e.onSave}))},da=(0,s.createContext)({getIntegrations:async()=>{throw new Error("No IntegrationContext found")},getNotificationRecipients:async()=>{throw new Error("No RecipientContext found")}}),ma=()=>(0,s.useContext)(da),pa=da.Provider;var Ea,ga=n(45093),va=n(81952),ha=n(21551);!function(e){e[e.CREATE=0]="CREATE",e[e.UPDATE=1]="UPDATE"}(Ea||(Ea={}));var fa=n(37176);class ya{constructor(e){this.recipient=e}compareTo(e){return e instanceof ya&&this.recipient.equals(e.recipient)}toString(){return this.recipient.displayName}}const ba=(e,t,n,l)=>n?l?l():[s.createElement(a.SelectOption,{key:"loading-option",isNoResultsOption:!0},s.createElement(a.Skeleton,{width:"100%"}))]:t(e),Ca=(e,t,n)=>s.useMemo((()=>"default"===e.show?ba(e.defaultValues,t,e.loadingDefault,n):"filter"===e.show?ba(e.filterValues,t,e.loadingFilter,n):void(0,ce.ZP)(e.show)),[e,t,n]);var Ta,Sa=n(62554);!function(e){e[e.LOAD_FILTER_VALUE=0]="LOAD_FILTER_VALUE",e[e.SET_FILTER_VALUE=1]="SET_FILTER_VALUE",e[e.USE_DEFAULTS=2]="USE_DEFAULTS",e[e.SET_DEFAULTS=3]="SET_DEFAULTS"}(Ta||(Ta={}));const ka=(e,t)=>(0,Ce.ZP)(e,(n=>{switch(t.type){case Ta.SET_FILTER_VALUE:t.search===e.lastSearch&&t.values!==n.filterValues&&(n.loadingFilter=!1,n.filterValues=(0,Ce.cA)(t.values));break;case Ta.LOAD_FILTER_VALUE:t.search===n.lastSearch&&"filter"===n.show||(n.loadingFilter=!0,n.filterValues=[],n.lastSearch=t.search,n.show="filter");break;case Ta.USE_DEFAULTS:"default"!==n.show&&(n.show="default");break;case Ta.SET_DEFAULTS:n.defaultValues=(0,Ce.cA)(t.values),n.loadingDefault=!1;break;default:(0,ce.ZP)(t)}})),Ia=()=>{const[e,t]=(0,s.useReducer)(ka,{filterValues:[],defaultValues:[],show:"default",loadingFilter:!1,loadingDefault:!0,lastSearch:""}),[n,a]=(0,s.useState)(e);(0,Sa.Z)((()=>{a(e)}),400,[e]);const l=(0,s.useCallback)(((e,n)=>t({type:Ta.SET_FILTER_VALUE,values:n,search:e})),[t]),i=(0,s.useCallback)((e=>t({type:Ta.LOAD_FILTER_VALUE,search:e})),[t]),o=(0,s.useCallback)((e=>t({type:Ta.SET_DEFAULTS,values:e})),[t]),r=(0,s.useCallback)((()=>t({type:Ta.USE_DEFAULTS})),[t]);return[n,(0,s.useMemo)((()=>({setFilterValue:l,loadFilterValue:i,setDefaults:o,useDefaults:r})),[l,i,o,r])]},Na=e=>{const[t,n]=s.useState(!1),l=(0,fa.Z)(t),{getIntegrations:i}=ma(),{values:o}=(0,oa.useFormikContext)(),[r,c]=Ia(),u=s.useCallback((e=>{n(e)}),[n]);s.useEffect((()=>{const n=e.onOpenChange;void 0!==l&&l!==t&&n&&n(t)}),[l,t,e.onOpenChange]),s.useEffect((()=>{i(e.integrationType,"").then((e=>{const t=e.map((e=>new xn.YO(e)));c.setDefaults(t)}))}),[i,e.integrationType,c]),s.useEffect((()=>{r.loadingFilter&&i(e.integrationType,r.lastSearch).then((e=>c.setFilterValue(r.lastSearch,e.map((e=>new xn.YO(e))))))}),[i,e.integrationType,r.loadingFilter,r.lastSearch,c]);const d=s.useMemo((()=>{var e;const t=(null!==(e=o.actions)&&void 0!==e?e:[]).filter((e=>(null==e?void 0:e.type)===at.k$.INTEGRATION)).map((e=>{var t;return null===(t=e)||void 0===t?void 0:t.integration.id}));return new Set(t)}),[o]),m=s.useCallback((e=>e.map((e=>{const t=null==d?void 0:d.has(e.integration.id);return s.createElement(a.SelectOption,{key:e.getKey(),value:new ya(e),description:t?"This integration has already been added":void 0,isDisabled:t})}))),[d]),p=Ca(r,m),E=s.useCallback((e=>{var t;if(null===e)return p;const n=null===(t=e.target.value)||void 0===t?void 0:t.trim();return""===n?c.useDefaults():c.loadFilterValue(n),p}),[c,p]),g=s.useMemo((()=>{const t=e.selected;if(void 0!==t&&void 0!==t.name&&void 0!==t.id&&void 0!==t.type)return new ya(new xn.YO(t))}),[e.selected]),h=s.useCallback(((t,a)=>{const l=e.onSelected;a instanceof ya&&(l(a),n(!1))}),[e.onSelected]),f=`Choose ${v.ZP.integrations.types[e.integrationType].name.toLowerCase()}`;return s.createElement("div",{...(0,lt.k)("IntegrationRecipientTypeahead",e)},s.createElement(a.Select,{maxHeight:400,variant:a.SelectVariant.typeahead,typeAheadAriaLabel:f,placeholderText:f,selections:g,onSelect:h,onToggle:u,isOpen:t,onFilter:E,menuAppendTo:document.body,isDisabled:e.isDisabled,validated:e.error?"error":void 0},p))},wa="groups",Aa="User Access Groups",La=(e,t,n)=>n.length>0?s.createElement(a.SelectGroup,{key:e,label:t},n.map((e=>e instanceof xn.nc&&e.isLoading?s.createElement(a.SelectOption,{key:e.getKey(),isNoResultsOption:!0},s.createElement(a.Skeleton,{width:"100%"})):s.createElement(a.SelectOption,{key:e.getKey(),value:new ya(e),description:e.description})))):s.createElement(s.Fragment,{key:e}),Da=e=>[La(wa,Aa,e)],Pa=()=>[s.createElement(a.SelectGroup,{key:wa,label:Aa},s.createElement(a.SelectOption,{key:"loading-group",isNoResultsOption:!0},s.createElement(a.Skeleton,{width:"100%"})))],Oa=[La("users","Users",[new xn.dt(void 0,!1,!1),new xn.dt(void 0,!0,!1)])],xa=e=>{const[t,n]=s.useState(!1),[l,i]=Ia(),o=(0,fa.Z)(t),{getNotificationRecipients:r}=ma();s.useEffect((()=>{r().then((e=>i.setDefaults(e)))}),[r,i]),s.useEffect((()=>{l.loadingFilter&&r().then((e=>i.setFilterValue(l.lastSearch,e)))}),[r,l.loadingFilter,l.lastSearch,i]);const c=s.useCallback((e=>{n(e)}),[n]);s.useEffect((()=>{const n=e.onOpenChange;void 0!==o&&o!==t&&n&&n(t)}),[o,t,e.onOpenChange]);const u=Ca(l,Da,Pa),d=s.useMemo((()=>[...Oa,...u]),[u]),m=s.useMemo((()=>{const t=e.selected;if(void 0!==t)return t.map((e=>new ya(e)))}),[e.selected]),p=s.useCallback(((t,n)=>{const a=e.onSelected;n instanceof ya&&a(n)}),[e.onSelected]),E=s.useMemo((()=>null==m?void 0:m.map((e=>{const t=e=>t=>{t.stopPropagation(),p(t,e)},n=e.recipient.getKey();if(e.recipient instanceof xn.nc){if(e.recipient.isLoading)return s.createElement(a.Chip,{key:n,onClick:t(e)},s.createElement(a.Skeleton,{"data-testid":"loading-group",width:"40px"}));if(e.recipient.hasError)return s.createElement(Gn,{key:n,onClose:t(e)})}return s.createElement(a.Chip,{onClick:t(e),key:n},e.recipient.displayName)}))),[m,p]);return s.createElement("div",{...(0,lt.k)("RecipientTypeahead",e)},s.createElement(a.Select,{maxHeight:400,variant:a.SelectVariant.checkbox,selections:m,onSelect:p,onToggle:c,isOpen:t,menuAppendTo:document.body,isDisabled:e.isDisabled,onClear:e.onClear,validated:e.error?"error":void 0,isGrouped:!0,isCheckboxSelectionBadgeHidden:!0,isInputValuePersisted:!0,placeholderText:s.createElement(a.ChipGroup,null,E)},d))},Fa=()=>!1,Ra=e=>{var t,n;let l;return l=e.action?e.action.type===at.k$.INTEGRATION?s.createElement(Na,{onSelected:e.integrationSelected,integrationType:null!==(n=null===(t=e.action.integration)||void 0===t?void 0:t.type)&&void 0!==n?n:te.WN.WEBHOOK,selected:e.action.integration,onOpenChange:e.onOpenChange,error:!!e.error}):s.createElement(xa,{onSelected:e.recipientSelected,selected:e.action.recipient,onClear:e.recipientOnClear,onOpenChange:e.onOpenChange,error:!!e.error}):s.createElement("div",null,s.createElement(a.Select,{variant:a.SelectVariant.typeahead,isDisabled:!0,onToggle:Fa,isOpen:!1})),s.createElement(s.Fragment,null," ",l,e.error&&s.createElement(a.FormHelperText,{isError:!0,isHidden:!e.error},e.error))};class Ga{constructor(e){"integration"===e.kind?(this.notificationType=at.k$.INTEGRATION,this.integrationType=e.type):(this.notificationType=e.type,this.integrationType=void 0)}compareTo(e){return e instanceof Ga&&e.notificationType===this.notificationType&&e.integrationType===this.integrationType}toString(){const e=v.ZP.notifications.types[this.notificationType].name;return this.integrationType?`${e}: ${v.ZP.integrations.types[this.integrationType].name}`:e}}const Ba=e=>s.createElement(s.Fragment,null,s.createElement("div",null,"You have no integration configured."),s.createElement("div",null,"Go to Settings ",">"," ",s.createElement(E.Link,{style:{pointerEvents:"all"},rel:e.testNoIntegrationRenderWithoutRelAndTarget?void 0:"noopener noreferrer",target:e.testNoIntegrationRenderWithoutRelAndTarget?void 0:"_blank",to:Hl.integrations()},"Integrations")," to configure.")),Ma=e=>{const[t,n]=s.useState(!1),{getIntegrations:l}=ma(),[i,o]=s.useState(Object.values(te.j3).reduce(((e,t)=>(e[t]=!0,e)),{}));s.useEffect((()=>{Object.values(te.j3).forEach((async e=>{const t=await l(e);o((0,Ce.ZP)((n=>{n[e]=t.length>0})))}))}),[l]);const r=s.useCallback((e=>{n(e)}),[n]),c=s.useCallback(((t,a)=>{const l=e.onSelected;a instanceof Ga&&(l(a),n(!1))}),[e.onSelected,n]),u=s.useMemo((()=>{if(e.action)return e.action.type===at.k$.INTEGRATION?new Ga({kind:"integration",type:e.action.integration.type}):new Ga({kind:"notification",type:e.action.type})}),[e.action]),d=(0,et.N)(),m=tt(),p=s.useMemo((()=>{return(t=m,n=d,l=e.selectedNotifications,[...t.filter((e=>!l.includes(e))).map((e=>new Ga({kind:"notification",type:e}))),...n.map((e=>new Ga({kind:"integration",type:e})))]).map((t=>{const n=(0,te.F8)(t.integrationType)&&!i[t.integrationType];return s.createElement(a.SelectOption,{isDisabled:n,key:t.toString(),value:t,description:n&&s.createElement(Ba,{testNoIntegrationRenderWithoutRelAndTarget:e.testNoIntegrationRenderWithoutRelAndTarget})})}));var t,n,l}),[m,d,e.selectedNotifications,i,e.testNoIntegrationRenderWithoutRelAndTarget]);return s.createElement("div",{...(0,lt.k)("ActionTypeahead",e)},s.createElement(a.Select,{maxHeight:400,variant:a.SelectVariant.single,"aria-label":"Select action",placeholderText:"Select action",selections:u,onToggle:r,isOpen:t,onSelect:c,menuAppendTo:document.body,isDisabled:e.isDisabled},p))};(0,u.cssRaw)("\n    @media only screen and (max-width: 768px) {\n        .pf-c-select .pf-c-select__toggle-typeahead {\n            --pf-c-select__toggle-typeahead--FlexBasis: 0;\n        }\n    }\n");const Ua=(0,u.style)({$nest:{"& tr":{borderBottom:(0,ge.important)(0)},"& th:first-child":{paddingLeft:(0,ge.important)(0)},"& th:last-child, & td:last-child":{paddingRight:(0,ge.important)(0)}}}),Va=(0,u.style)({$nest:{"& td:first-child":{paddingLeft:(0,ge.important)(0)},"& td:last-child":{paddingRight:(0,ge.important)(0)},"& td":{verticalAlign:(0,ge.important)("top")}}}),_a=(0,u.style)({textAlign:"left",paddingLeft:0}),Za=[{title:"Actions",transforms:[(0,Le.cellWidth)(50)]},{title:"Recipient"}],$a=()=>s.createElement("span",null),Ha=e=>{const{values:t,setValues:n,errors:l,touched:i,setFieldTouched:o}=e.form,r=s.useMemo((()=>{var e;return null!==(e=t.actions)&&void 0!==e?e:[]}),[t]),c=s.useMemo((()=>{var e;return null!==(e=null==i?void 0:i.actions)&&void 0!==e?e:[]}),[i]),u=s.useMemo((()=>{var e;return null!==(e=null==l?void 0:l.actions)&&void 0!==e?e:[]}),[l]),d=s.useMemo((()=>new Array(...new Set(r.filter((e=>e)).map((e=>e.type))))),[r]),m=s.useCallback((e=>{n((0,Ce.ZP)((t=>{const n=t;n.actions=e instanceof Function?(0,Ce.cA)(e(n.actions)):(0,Ce.cA)(e)})),!1)}),[n]),p=s.useCallback((()=>{(0,e.push)(void 0)}),[e.push]);s.useEffect((()=>{0===r.length&&p()}),[r,p]);const E=(g=m,{handleActionSelected:(0,s.useCallback)((e=>t=>{g((0,Ce.ZP)((n=>{n[e]||(n[e]={});const a=n[e];a.type=t.notificationType,t.integrationType?a.integration={type:t.integrationType}:a.recipient=[]})))}),[g]),handleIntegrationSelected:(0,s.useCallback)((e=>t=>{g((0,Ce.ZP)((n=>{t.recipient instanceof xn.YO&&(n[e].integration=t.recipient.integration)})))}),[g]),handleRecipientSelected:(0,s.useCallback)((e=>t=>{g((0,Ce.ZP)((n=>{const a=n[e];if(a.type!==at.k$.INTEGRATION){const e=a,n=(0,Ce.Js)(e.recipient);if(n){const a=n.findIndex((e=>t.recipient.equals(e)));-1===a?e.recipient.push((0,Ce.cA)(t.recipient)):e.recipient.splice(a,1)}}})))}),[g]),handleRecipientOnClear:(0,s.useCallback)((e=>()=>{g((0,Ce.ZP)((t=>{const n=t[e];n.type!==at.k$.INTEGRATION&&(n.recipient=[])})))}),[g])});var g;const v=s.useMemo((()=>((e,t,n,a,l,i)=>e.map(((e,o)=>{var r,c;let u,d,m=!1;return d=(null==e?void 0:e.type)===at.k$.INTEGRATION?`actions.${o}.integration`:`actions.${o}.recipient`,(null==e?void 0:e.type)===at.k$.INTEGRATION&&((null===(r=n[o])||void 0===r?void 0:r.integration)&&(m=!0),m&&(null===(c=t[o])||void 0===c?void 0:c.integration)&&(u="Select a recipient for this integration.")),!u&&m&&i(d,!1,!1),{id:o,key:o,cells:[{title:s.createElement(Ma,{selectedNotifications:a,action:e,onSelected:l.handleActionSelected(o)})},{title:s.createElement(Ra,{action:e,integrationSelected:l.handleIntegrationSelected(o),recipientSelected:l.handleRecipientSelected(o),recipientOnClear:l.handleRecipientOnClear(o),error:u,onOpenChange:e=>{e||i(d,!0,!1)}})}]}})))(r,u,c,d,E,o)),[r,u,c,d,E,o]),h=s.useCallback((t=>{const n=e.handleRemove;return v.length>1?[{key:"delete",title:s.createElement(a.Button,{"aria-label":"delete-action",variant:a.ButtonVariant.plain},s.createElement(R.MinusCircleIcon,null)),isOutsideDropdown:!0,onClick:n(t.id)}]:[]}),[v,e.handleRemove]);return s.createElement(s.Fragment,null,s.createElement(Le.Table,{"aria-label":"behavior-group-actions-form",rows:v,cells:Za,actionResolver:h,actionsToggle:$a,borders:!1,variant:Le.TableVariant.compact,isStickyHeader:!0},s.createElement(Le.TableHeader,{className:Ua}),s.createElement(Le.TableBody,{className:Va})),s.createElement(a.GridItem,{span:12},s.createElement(a.Button,{className:_a,variant:a.ButtonVariant.link,icon:s.createElement(R.PlusCircleIcon,null),onClick:p},"Add action")))},za=e=>s.createElement("div",{...(0,lt.k)("Notifications/BehaviorGroupForm",e)},s.createElement(a.Grid,{hasGutter:!0},s.createElement(oa.FieldArray,{name:"actions"},(e=>s.createElement(s.Fragment,null,s.createElement(Ha,{...e})))))),qa=_.Ry({type:_.nK().oneOf([at.k$.INTEGRATION]).required(),integration:_.Ry({id:_.Z_().required()}).required(),integrationId:_.Z_().min(1)}),Wa=_.Ry({type:_.nK().oneOf([at.k$.EMAIL_SUBSCRIPTION,at.k$.DRAWER]).required(),recipient:_.IX(_.Ry()).min(1),integrationId:_.Z_().min(0)}),Qa=_.IX(_.Vo((e=>e&&e.hasOwnProperty("type")&&e.type===at.k$.INTEGRATION?qa:Wa))).test("no-repeated","${path} can't contain repeated actions",((e,t)=>{const n=[];let a=!1;const l=[];if(!e)return!0;for(let i=0;i<e.length;++i){const o=e[i],r=o.integrationId;o.type===at.k$.EMAIL_SUBSCRIPTION?(a&&n.push(t.createError({message:"Only 1 send email action is allowed",path:`actions.${i}`})),a=!0):r&&(l.includes(r)?n.push(t.createError({message:"Integration already used in the group, please select other",path:`actions.${i}`})):l.push(r))}return 0===n.length||{...t.createError(),inner:n}})),Ya=(_.Ry({actions:Qa}),_.Ry({displayName:_.Z_().required("You must specify a name for the behavior group"),actions:Qa}),"Actions and recipients"),ja=(0,u.style)({paddingTop:me.S.value}),Ka=()=>{const{values:e}=(0,oa.useFormikContext)();return s.createElement(o.Form,null,s.createElement("div",null,s.createElement(a.Title,{headingLevel:"h4",size:"xl"},Ya),s.createElement(a.TextContent,{className:ja},s.createElement(a.Text,null,"Select action and recipient pairs to assign to your notification events.")),s.createElement(za,{behaviorGroup:e})))},Ja=_.Ry({actions:Qa}),Xa=e=>s.createElement(Le.TableComposable,{variant:Le.TableVariant.compact},s.createElement(Le.Thead,null,s.createElement(Le.Tr,null,s.createElement(Le.Th,null),s.createElement(Le.Th,null,"Event type"),s.createElement(Le.Th,null,"Application"))),s.createElement(Le.Tbody,null,e.children)),el=()=>s.createElement(Xa,null,[...Array(10)].map(((e,t)=>s.createElement(Le.Tr,{key:t},s.createElement(Le.Td,{select:{isSelected:!1,rowIndex:t,disable:!0}}),s.createElement(Le.Td,null,s.createElement(a.Skeleton,{width:"80%"})),s.createElement(Le.Td,null,s.createElement(a.Skeleton,{width:"80%"})))))),tl=e=>s.createElement(Xa,null,e.events.map(((t,n)=>s.createElement(Le.Tr,{key:t.id},s.createElement(Le.Td,{modifier:e.selectionLoading?"fitContent":void 0,noPadding:e.selectionLoading,select:e.selectionLoading?void 0:{rowIndex:n,onSelect:(n,a)=>e.onSelect&&e.onSelect(a,t),isSelected:t.isSelected,disable:e.selectionLoading}},e.selectionLoading&&s.createElement(a.Spinner,{size:"sm"})),s.createElement(Le.Td,null,t.eventTypeDisplayName),s.createElement(Le.Td,null,t.applicationDisplayName))))),nl=e=>e.events?s.createElement(tl,{...e,events:e.events}):s.createElement(el,null),al="Associate event types",ll=(0,u.style)({paddingTop:me.S.value}),il=e=>{const{setValues:t,values:n}=(0,oa.useFormikContext)(),[l,i]=s.useState((()=>{const e={};return n.events.forEach((t=>{e[t.id]=t})),e})),r=bn(e.bundle,e.applications,!1),c=q(r.pageController.page),u=(0,o.useTransformQueryResponse)((0,b.useParameterizedQuery)(H),z);(0,s.useEffect)((()=>{t((0,Ce.ZP)((e=>{e.events=Object.values(l)})))}),[t,l]);const d=s.useMemo((()=>{const e=c.payload;return 200===(null==e?void 0:e.status)?e.value.meta.count:0}),[c.payload]),m=s.useMemo((()=>{var e;return"eventTypesArray"===(null===(e=c.payload)||void 0===e?void 0:e.type)?c.payload.value.data.map((e=>({...e,isSelected:Object.keys(l).includes(e.id)}))):[]}),[c.payload,l]),p=s.useCallback(((e,t)=>{i((0,Ce.ZP)((n=>{e?n[t.id]=t:delete n[t.id]})))}),[i]),E=s.useCallback((e=>{const t=r.pageController.page;switch(e){case gn.ALL:if(d===m.length)return i((0,Ce.ZP)((e=>{m.forEach((t=>{e[t.id]=t}))})));(async()=>{var e;let n=1;const a={},l=o.Page.lastPageForElements(d,t.size);for(;;){const i=t.withPage(n);if(i.index>l.index)break;if(t.index===i.index)m.forEach((e=>{a[e.id]=e}));else{const l=await u.query(t.withPage(n));if("eventTypesArray"!==(null===(e=l.payload)||void 0===e?void 0:e.type))break;l.payload.value.data.forEach((e=>{a[e.id]=e}))}n++}i((0,Ce.ZP)((e=>{for(const t of Object.values(a))e[t.id]=t})))})();break;case gn.PAGE:i((0,Ce.ZP)((e=>{m.forEach((t=>{e[t.id]=t}))})));break;case gn.NONE:i({})}}),[i,m,u,r.pageController.page,d]);return s.createElement(o.Form,null,s.createElement("div",null,s.createElement(a.Title,{headingLevel:"h4",size:"xl"},al),s.createElement(a.TextContent,{className:ll},s.createElement(a.Text,null,"Select event types you would like to assign this behavior group to."))),s.createElement(yn,{filters:r.filters,setFilters:r.setFilters,clearFilter:r.clearFilters,appFilterOptions:e.applications,pageAdapter:r.pageController,count:d,pageCount:m.length,onSelectionChanged:E,selectedCount:Object.keys(l).length,bulkSelectionDisabled:u.loading},s.createElement(nl,{onSelect:p,events:c.loading?void 0:m,selectionLoading:u.loading})))},ol="Name",rl=()=>s.createElement(o.Form,{ouiaId:"basic-information-step"},s.createElement(a.Title,{headingLevel:"h4",size:"xl"},ol),s.createElement(o.FormTextInput,{ouiaId:"name",id:"name",name:"displayName",label:"Behavior group name",isRequired:!0})),sl=_.Ry({displayName:_.Z_().min(1).max(150,"Must be 150 characters or less").required("Behavior group name is required")}),cl="Review",ul=(0,u.style)({fontSize:Sn.U.value}),dl=e=>s.createElement(a.Grid,null,s.createElement(a.GridItem,{span:6},s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h6,className:ul},"Event type"))),s.createElement(a.GridItem,{span:6},s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h6,className:ul},"Application"))),e.events.map((e=>s.createElement(s.Fragment,{key:e.id},s.createElement(a.GridItem,{span:6},e.eventTypeDisplayName),s.createElement(a.GridItem,{span:6},e.applicationDisplayName))))),ml=()=>{const{values:e}=(0,oa.useFormikContext)();return s.createElement(o.Form,{ouiaId:"review-step"},s.createElement(a.Title,{headingLevel:"h2",size:"xl"},cl),s.createElement(a.DescriptionList,{isHorizontal:!0},s.createElement(a.DescriptionListGroup,null,s.createElement(a.DescriptionListTerm,null,"Name"),s.createElement(a.DescriptionListDescription,null," ",e.displayName)),s.createElement(a.DescriptionListGroup,null,s.createElement(a.DescriptionListTerm,null," Actions and recipients"),s.createElement(a.DescriptionListDescription,null,s.createElement(zn,{actions:e.actions}))),s.createElement(a.DescriptionListGroup,null,s.createElement(a.DescriptionListTerm,null,"Associate event types"),s.createElement(a.DescriptionListDescription,null,s.createElement(dl,{events:e.events})))))},pl=()=>{},El=e=>{const[t,n]=s.useState(0),{isValid:a,validateForm:l}=(0,oa.useFormikContext)(),i=(e=>{const t=J(),{query:n}=(0,s.useContext)(b.ClientContext),[a,l]=(0,s.useState)(!1);return{save:(0,s.useCallback)((async a=>{var i,o,r,s;const c=t.mutate;let u=!1,d=!1,m=!1;void 0===a.id&&(u=!0,d=!0),a.displayName!==(null==e?void 0:e.displayName)&&(u=!0);const p=[...null!==(i=null==e?void 0:e.events)&&void 0!==i?i:[]].sort(),E=[...null!==(o=a.events)&&void 0!==o?o:[]].sort();p.length===E.length&&p.every(((e,t)=>e===E[t]))||(m=!0),(0,at.VL)(null!==(r=null==e?void 0:e.actions)&&void 0!==r?r:[],null!==(s=a.actions)&&void 0!==s?s:[])||(d=!0);const g=(0,ha.uniqWith)([].concat(...a.actions.filter(at.Yh).map((e=>(0,Ce.ZP)(e,(e=>{e.recipient=e.recipient.filter((e=>!e.integrationId))})))).map((e=>(0,$.OO)(e)))),ha.isEqual);if(g.find((e=>![at.k$.EMAIL_SUBSCRIPTION,at.k$.DRAWER].includes(e.type))))throw new Error("Only email and drawer subscriptions are created when assigning behavior groups");g.length>0&&l(!0);const v=await Promise.all(g.map((e=>{return n((t=e,(0,at.K4)(t)?Nt.B.EndpointResourceGetOrCreateEmailSubscriptionEndpoint.actionCreator({body:{only_admins:t.props.onlyAdmins,group_id:t.props.groupId}}):(0,at.L6)(t)?Nt.B.EndpointResourceGetOrCreateDrawerSubscriptionEndpoint.actionCreator({body:{only_admins:t.props.onlyAdmins,group_id:t.props.groupId}}):void(0,ce.ZP)(t))).then((e=>{var t;return"Endpoint"===(null===(t=e.payload)||void 0===t?void 0:t.type)?e.payload.value.id:void 0}));var t}))).then((e=>{if(e.includes(void 0))throw new Error("Unexpected ids were returned when querying for system endpoints");const t=[...e];return((e,t)=>{const n=t?[...t]:void 0;return e.reduce(((a,l)=>{if((0,at.Yh)(l))l.recipient.forEach((l=>{if(l.integrationId)a.push(l.integrationId);else if(void 0===n)a.push(void 0);else{if(!(n.length>0))throw new Error(`No more ids remaining to assign: actions ${e} newIds: ${t}`);a.push(n.shift())}}));else{if(!(0,at._f)(l))throw new Error(`Unknown action type: ${l}`);a.push(l.integration.id)}return a}),[])})(a.actions,t)})),h={...a,displayName:u?a.displayName:void 0,endpointIds:d?v:void 0,eventTypesIds:m?a.events.map((e=>e.id)):void 0};return u||d||m?c(h).then((e=>{var t;return{operation:void 0===a.id?Ea.CREATE:Ea.UPDATE,status:200===(null===(t=e.payload)||void 0===t?void 0:t.status)}})).catch((()=>({operation:void 0===a.id?Ea.CREATE:Ea.UPDATE,status:!1}))):{operation:void 0===a.id?Ea.CREATE:Ea.UPDATE,status:!0}}),[t.mutate,n,e]),isSaving:(0,s.useMemo)((()=>t.loading||a),[t.loading,a])}})(e.behaviorGroup),{values:o}=(0,oa.useFormikContext)(),{addDangerNotification:r,addSuccessNotification:c}=(0,Zt.l)(),u=((e,t,n,a)=>{const l=s.useMemo((()=>({name:ol,component:s.createElement(rl,null),schema:sl})),[]),i=(({applications:e,bundle:t})=>s.useMemo((()=>({name:al,component:s.createElement(il,{applications:e,bundle:t})})),[e,t]))(e),o=s.useMemo((()=>({name:Ya,component:s.createElement(Ka,null),schema:Ja})),[]),[r,c]=(0,s.useState)(0),[u,d]=(0,s.useState)((()=>new Set));(0,s.useEffect)((()=>{c((e=>Math.max(t,e)))}),[t]),(0,s.useEffect)((()=>{d((0,Ce.ZP)((e=>{n?e.delete(t):e.add(t)})))}),[t,n]);const m=0===u.size?r:Math.min(...Array.from(u));return(0,s.useMemo)((()=>[l,o,i,{name:cl,component:s.createElement(ml,null),nextButtonText:"Finish"}].map(((e,t)=>({...e,id:t,canJumpTo:!a&&t<=m,hideCancelButton:!1,enableNext:n})))),[l,o,n,m,a,i])})({bundle:e.bundle,applications:e.applications},t,a,i.isSaving),d=u[t],m=null==d?void 0:d.schema;s.useEffect((()=>{e.setValidationSchema(m)}),[t]),s.useEffect((()=>{l()}),[e.validationSchema,l]);const p=s.useCallback((async()=>{const t=e.onClose,n=i.save,a={...o,bundleId:e.bundle.id},l=await n(a);l.status?(l.operation===Ea.CREATE?c("New behavior group created",s.createElement(s.Fragment,null,"Group ",s.createElement("b",null," ",a.displayName," ")," created successfully.")):c("Behavior group saved",s.createElement(s.Fragment,null,"Group ",s.createElement("b",null," ",a.displayName," ")," was saved successfully.")),t(!0)):l.operation===Ea.CREATE?r("Behavior group failed to be created",s.createElement(s.Fragment,null,"Failed to create group ",s.createElement("b",null," ",a.displayName),".",s.createElement("br",null),"Please try again.")):r("Behavior group failed to save",s.createElement(s.Fragment,null,"Failed to save group ",s.createElement("b",null," ",a.displayName),".",s.createElement("br",null),"Please try again."))}),[o,i.save,e.bundle,e.onClose,r,c]);return s.createElement(ua,{steps:u,onNext:async e=>{let t=!0;(null==d?void 0:d.isValid)&&(t=await d.isValid()),t&&(n((e=>Math.min(e+1,u.length))),e())},onBack:async e=>{n((e=>e-1)),e()},onGoToStep:n,loading:i.isSaving,onClose:()=>{e.onClose(!1)},onSave:p})},gl=e=>{var t;const n=(()=>{const e=(0,va.P)();return(0,s.useCallback)((async()=>e.groups.map((e=>new xn.nc(void 0,e.id,e.name)))),[e])})(),a=(()=>{const{query:e}=(0,s.useContext)(b.ClientContext);return s.useCallback((async(t,n)=>e((0,ga.Kr)(o.Page.of(1,20,(new o.Filter).and("type",o.Operator.EQUAL,[t]).and("name",o.Operator.EQUAL,null!=n?n:"")))).then((e=>{let t=[];const n=e.payload?(0,ga.us)(e.payload):void 0;return"IntegrationPage"===(null==n?void 0:n.type)&&(t=n.value.data),t}))),[e])})(),l=s.useMemo((()=>({getIntegrations:a,getNotificationRecipients:n})),[a,n]),[i,r]=s.useState();return s.createElement(pa,{value:l},s.createElement(oa.Formik,{validateOnMount:!0,onSubmit:pl,initialValues:null!==(t=e.behaviorGroup)&&void 0!==t?t:{actions:[],events:[],displayName:void 0},validationSchema:i,validateOnBlur:!0,validateOnChange:!0},s.createElement(El,{...e,validationSchema:i,setValidationSchema:r})))},vl=e=>{const t=((e,t)=>(0,s.useCallback)((()=>e(t)),[e,t]))(e.onDelete,e.behaviorGroup),n=s.useMemo((()=>0===e.conflictingNotifications.length?"Cancel":"Close"),[e.conflictingNotifications]),l=s.useMemo((()=>0===e.conflictingNotifications.length?a.ButtonVariant.link:a.ButtonVariant.secondary),[e.conflictingNotifications]),[i,r]=s.useState(!1),c=s.useMemo((()=>{if(0===e.conflictingNotifications.length)return s.createElement(a.Stack,{hasGutter:!0},s.createElement(a.StackItem,null,"Action and recipient pairings assigned in ",s.createElement("b",null,e.behaviorGroup.displayName)," will lost. You will no longer be able to assign this behavior group to events."),s.createElement(a.StackItem,null,s.createElement(a.Checkbox,{id:"checkbox-delete-i-acknowledge",label:"I acknowledge that this action cannot be undone",onChange:r,isChecked:i})));{const t=e.conflictingNotifications;return s.createElement(a.Stack,{hasGutter:!0},s.createElement(a.StackItem,null,"You will no longer be able to assign ",s.createElement("b",null,e.behaviorGroup.displayName)," to events, and existing associations to events listed below will be removed."),s.createElement(a.StackItem,null,s.createElement(a.ExpandableSection,{toggleText:`View ${t.length} event${0===t.length?"":"s"}`},s.createElement(a.List,null,t.map((e=>s.createElement(a.ListItem,{key:e.id},`${e.applicationDisplayName} - ${e.eventTypeDisplayName}`)))))),s.createElement(a.StackItem,null,s.createElement(a.Checkbox,{id:"checkbox-delete-i-acknowledge",label:"I acknowledge that this action cannot be undone",onChange:r,isChecked:i})))}}),[e.conflictingNotifications,e.behaviorGroup,i,r]);return s.createElement(o.DeleteModal,{isOpen:!0,isDeleting:e.isDeleting,title:"Delete behavior group",content:c,onClose:e.onClose,onDelete:t,error:e.error,titleIconVariant:"warning",actionButtonDisabled:!i,cancelButtonTitle:n,cancelButtonVariant:l})},hl=()=>!1,fl=e=>s.createElement(o.DeleteModal,{isOpen:!0,title:"Delete behavior group",actionButtonDisabled:!0,titleIconVariant:"warning",content:s.createElement(a.Stack,{hasGutter:!0},s.createElement(a.StackItem,null,s.createElement(a.Skeleton,{width:"500px"})),s.createElement(a.StackItem,null,s.createElement(a.Skeleton,{width:"500px"}))),onClose:e.onClose,isDeleting:!1,onDelete:hl}),yl=e=>C.B.NotificationResourceDeleteBehaviorGroup.actionCreator({id:e}),bl=(0,Z.validationResponseTransformer)((e=>200===e.status?(0,Z.validatedResponse)("Notifications",200,(0,$.Jc)(e.value),e.errors):e)),Cl=e=>{var t;const n=(0,b.useMutation)(yl),a=(c=e.behaviorGroup.id,(0,o.useTransformQueryResponse)((0,b.useQuery)((e=>C.B.NotificationResourceGetEventTypesAffectedByRemovalOfBehaviorGroup.actionCreator({behaviorGroupId:e}))(c)),bl)),{addDangerNotification:l,addSuccessNotification:i}=(0,Zt.l)(),r=s.useCallback((async e=>{var t;const a=n.mutate;return 200===(null===(t=(await a(e.id)).payload)||void 0===t?void 0:t.status)?(i("Behavior group deleted",s.createElement(s.Fragment,null,"Group ",s.createElement("b",null,e.displayName)," deleted successfully.")),!0):(l("Behavior group failed to be deleted",s.createElement(s.Fragment,null,"Failed to delete group ",s.createElement("b",null," ",e.displayName),".",s.createElement("br",null),"Please try again.")),!1)}),[n.mutate,l,i]);var c;return(0,s.useEffect)((()=>{const t=a.payload,n=e.onClose;t&&200!==t.status&&(l("Associated events failed to load ",s.createElement(s.Fragment,null,"Failed to load associated events for group ",s.createElement("b",null," ",e.behaviorGroup.displayName),".",s.createElement("br",null),"Please try again.")),n(!1))}),[l,a.payload,e.behaviorGroup,e.onClose]),a.loading?s.createElement(fl,{onClose:e.onClose}):200!==(null===(t=a.payload)||void 0===t?void 0:t.status)?null:s.createElement(vl,{onDelete:r,isDeleting:n.loading,onClose:e.onClose,behaviorGroup:e.behaviorGroup,conflictingNotifications:a.payload.value})},Tl={backgroundColor:Ft.C.var,paddingLeft:Rt.J.var,paddingRight:Rt.J.var},Sl=(0,u.style)(Tl,{paddingBottom:Rt.J.var}),kl=(0,u.style)(Tl,{paddingTop:Rt.J.var}),Il=(0,u.style)({marginTop:"-0.15em",color:Cn.U.var}),Nl=(0,u.style)({marginTop:"2px",marginLeft:"-16px"}),wl=(0,u.style)({marginTop:"10px",marginLeft:"-16px"}),Al=(0,u.style)({marginTop:"-0.2em"}),Ll=e=>{const{isDisabled:t,...n}=e,{isOrgAdmin:l}=(0,g.b)(),i=s.createElement(a.Button,{...n,isAriaDisabled:t,variant:a.ButtonVariant.primary},"Create new group");if(t){const e=l?"You need the Notifications administrator role to perform this action":"You do not have permissions to perform this action. Contact your org admin for more information";return s.createElement(a.Tooltip,{content:e},i)}return i},Dl=e=>{const[t,n]=s.useState(!0),[l,i]=s.useState(""),{rbac:o}=(0,g.b)(),r=s.useMemo((()=>{if(!e.behaviorGroupContent.isLoading&&!e.behaviorGroupContent.hasError){const t=l.toLowerCase();return e.behaviorGroupContent.content.filter((e=>e.displayName.toLowerCase().includes(t)))}return Yt}),[l,e.behaviorGroupContent]),[c,u]=(0,ia.A)(),[d,m]=(0,la.S)(),p=s.useCallback((e=>{e.stopPropagation(),u.create({events:[],actions:[],displayName:""})}),[u]),E=s.useCallback((t=>{const n=e.behaviorGroupContent.reload;t&&n(),u.reset()}),[u,e.behaviorGroupContent.reload]),v=s.useCallback((e=>{u.edit({id:e.id,events:e.events,actions:e.actions,displayName:e.displayName})}),[u]),h=s.useCallback((e=>{m.delete(e)}),[m]),f=s.useCallback((t=>{const n=e.behaviorGroupContent.reload;t&&n(),m.reset()}),[m,e.behaviorGroupContent.reload]),y=s.useCallback((()=>{i("")}),[i]),b="behavior-group-section-content";return s.createElement(s.Fragment,null,s.createElement("div",{className:kl},s.createElement(a.Split,{hasGutter:!0},s.createElement(a.ExpandableSectionToggle,{isExpanded:t,onToggle:n,contentId:b,direction:"down"},s.createElement(a.SplitItem,null,s.createElement(a.Title,{className:Il,headingLevel:"h2"},"Behavior groups"))),s.createElement(a.SplitItem,null,!e.behaviorGroupContent.isLoading&&!e.behaviorGroupContent.hasError&&(e.behaviorGroupContent.content.length>0?s.createElement(a.Badge,{className:wl,isRead:!0},e.behaviorGroupContent.content.length):s.createElement(Ll,{className:Al,component:"a",onClick:p,isDisabled:!o.canWriteNotifications}))),s.createElement(a.SplitItem,null,s.createElement(a.Popover,{position:"right",hideOnOutsideClick:!0,appendTo:()=>document.body,headerContent:s.createElement("div",{className:"pf-u-color-100"},"Behavior groups"),bodyContent:s.createElement("div",{className:"pf-u-font-size-sm pf-u-color-100"},"Behavior groups are made up of action/recipient pairings that allow you to configure which notification actions different users will be able to receive. Once you've created a behavior group, you can assign it to an event using the Events table below. "),footerContent:s.createElement("div",{className:"pf-u-font-size-sm pf-u-color-100"}," You may also prevent users from changing assigned actions by locking action/recipient pairings when creating or editing behavior groups.")},s.createElement(a.Button,{className:Nl,variant:"plain","aria-label":"Help"},s.createElement(R.OutlinedQuestionCircleIcon,null)))))),s.createElement(a.ExpandableSection,{className:Sl,contentId:b,isExpanded:t,onToggle:n,isDetached:!0},s.createElement(a.Stack,{hasGutter:!0},(e.behaviorGroupContent.isLoading||e.behaviorGroupContent.hasError||e.behaviorGroupContent.content.length>0)&&s.createElement(s.Fragment,null,s.createElement(a.StackItem,null,s.createElement(a.Split,{hasGutter:!0},s.createElement(a.SplitItem,null,s.createElement(a.SearchInput,{value:l,onChange:i,onClear:y,type:"text","aria-label":"Search by name",placeholder:"Search by name",isDisabled:e.behaviorGroupContent.isLoading})),s.createElement(a.SplitItem,null,s.createElement(Ll,{isDisabled:e.behaviorGroupContent.isLoading||!o.canWriteNotifications,onClick:p})))),s.createElement(a.StackItem,null,e.behaviorGroupContent.isLoading?s.createElement(aa,null):e.behaviorGroupContent.hasError?s.createElement("div",null,"Error loading behavior groups"):s.createElement(aa,{onEdit:o.canWriteNotifications?v:void 0,onDelete:o.canWriteNotifications?h:void 0,behaviorGroups:r})))),c.isOpen&&s.createElement(gl,{bundle:e.bundle,applications:e.applications,behaviorGroup:c.template,onClose:E}),d.isOpen&&s.createElement(Cl,{behaviorGroup:d.data,onClose:f})))};var Pl=n(96702);const Ol=(0,Z.validationResponseTransformer)((e=>200===e.status?(0,Z.validatedResponse)("BehaviorGroups",200,e.value.map(Pl.V),e.errors):e));class xl extends Error{}const Fl=(e,t)=>{const n=e.find(en(t));if(!n)throw new xl("Notification not found in rows");return n},Rl=(0,u.style)({marginBottom:Wt.K.var}),Gl=[],Bl=e=>{var t;const n=(e=>{const t=(e=>(0,o.useTransformQueryResponse)((0,b.useQuery)(C.B.NotificationResourceFindBehaviorGroupsByBundleId.actionCreator({bundleId:e})),Ol))(e),{groups:n,isLoading:a}=(0,va.P)(),l=s.useMemo((()=>{const e=t.payload,n=t.errorObject,a=t.loading,l=t.query;return a?{isLoading:!0,reload:l}:200===(null==e?void 0:e.status)?{isLoading:!1,hasError:!1,content:e.value,reload:l}:{isLoading:!1,hasError:!0,error:n.toString(),reload:l}}),[t.payload,t.loading,t.errorObject,t.query]);return(0,s.useMemo)((()=>l.isLoading||l.hasError?l:(0,Ce.ZP)(l,(e=>{const t=(0,Ce.Js)(e);t&&t.content.forEach(((t,l)=>t.actions.forEach(((t,i)=>{(0,at.Yh)(t)&&t.recipient.forEach(((t,o)=>{var r;if(t instanceof xn.nc&&t.isLoading){const t=e.content[l].actions[i].recipient,s=t[o];t[o]=new xn.nc(s.integrationId,s.groupId,(null===(r=n.find((e=>e.id===s.groupId)))||void 0===r?void 0:r.name)||a)}}))}))))}))),[l,n,a])})(e.bundle.id),{rbac:a}=(0,g.b)(),i=s.useCallback((e=>{console.log("Export to",e)}),[]),r=bn(e.bundle,e.applications,!0),c=q(r.pageController.page),u=s.useMemo((()=>{const e=c.payload;return 200===(null==e?void 0:e.status)?e.value.meta.count:0}),[c.payload]),d=n.isLoading||n.hasError?void 0:n.content,{rows:m,updateBehaviorGroupLink:p,startEditMode:E,finishEditMode:v,cancelEditMode:h,updateBehaviorGroups:f}=((e,t)=>{const[n,a]=s.useState([]),l=(0,fa.Z)(e),{query:i}=s.useContext(b.ClientContext),r=s.useCallback(((e,t)=>{a((0,Ce.ZP)((n=>{const a=Fl(n,e),l=a.behaviors.findIndex(en(t));if(-1===l)throw new Error("Behavior group not found in rows");a.behaviors.splice(l,1)})))}),[a]),c=s.useCallback((e=>{a((0,Ce.ZP)((t=>{for(const n of t)n.behaviors=[],e.forEach((e=>{e.events.find((e=>e.id===n.id))&&n.behaviors.push((0,Ce.cA)(e))}))})))}),[a]),u=s.useCallback(((e,t,n)=>{n?a((0,Ce.ZP)((n=>{Fl(n,e).behaviors.push({...(0,Ce.cA)(t)})}))):r(e,t.id)}),[r,a]),d=s.useCallback((async(e,t)=>{var l;if("finish"===t){const t=Fl(n,e);t.isEditMode&&(a((0,Ce.ZP)((t=>{Fl(t,e).loadingActionStatus="loading"}))),200===(null===(l=(await i(Y(e,t.behaviors.map((e=>e.id))))).payload)||void 0===l?void 0:l.status)?a((0,Ce.ZP)((t=>{const n=Fl(t,e);n.isEditMode=!1,n.loadingActionStatus="done"}))):((0,o.addDangerNotification)("Saving behavior",s.createElement(s.Fragment,null,"There was an error saving the behavior of ",s.createElement("b",null,t.applicationDisplayName," - ",t.eventTypeDisplayName),".")),a((0,Ce.ZP)((t=>{const n=Fl(t,e);n.isEditMode=!0,n.loadingActionStatus="done"})))))}else a((0,Ce.ZP)((n=>{const a=Fl(n,e);a.isEditMode&&"cancel"===t&&(a.behaviors=a.oldBehaviors),a.isEditMode="edit"===t,a.isEditMode&&(a.oldBehaviors=a.behaviors)})))}),[a,n,i]),m=s.useCallback((e=>{d(e,"edit")}),[d]),p=s.useCallback((e=>{d(e,"finish")}),[d]),E=s.useCallback((e=>{d(e,"cancel")}),[d]);return s.useEffect((()=>{e!==l&&(a((t=>e.map((e=>({...e,loadingActionStatus:"done",behaviors:[],isEditMode:!1}))))),t&&c(t))}),[t,e,l,a,c]),{rows:n,updateBehaviorGroupLink:u,updateBehaviorGroups:c,startEditMode:m,finishEditMode:p,cancelEditMode:E}})(c.loading||"eventTypesArray"!==(null===(t=c.payload)||void 0===t?void 0:t.type)?Gl:c.payload.value.data,d);s.useEffect((()=>{d&&f(d)}),[d,f]);const y=s.useCallback(((e,t,n)=>{t&&p(e.id,t,n)}),[p]),T=s.useCallback((e=>{E(e)}),[E]),S=s.useCallback((e=>{v(e)}),[v]),k=s.useCallback((e=>{h(e)}),[h]);return s.createElement(l.Section,null,s.createElement("div",{className:Rl},s.createElement(Dl,{bundle:e.bundle,applications:e.applications,behaviorGroupContent:n})),s.createElement(yn,{filters:r.filters,setFilters:r.setFilters,clearFilter:r.clearFilters,appFilterOptions:e.applications,onExport:i,count:u,pageAdapter:r.pageController},s.createElement(pn,{notifications:m,behaviorGroupContent:n,onBehaviorGroupLinkUpdated:y,onStartEditing:a.canWriteNotifications?T:void 0,onFinishEditing:a.canWriteNotifications?S:void 0,onCancelEditing:a.canWriteNotifications?k:void 0,onSort:r.onSort,sortBy:r.sortBy,sortDirection:r.sortDirection})))},Ml=e=>{const{updateDocumentTitle:t}=(0,i.Z)();null==t||t(`${e.bundle.displayName} - Notifications`);const n=(0,m.useFlag)("platform.notifications.overhaul"),{rbac:r}=(0,g.b)(),s=c().useMemo((()=>Hl.eventLog(e.bundle.name)),[e.bundle.name]),u=c().createElement(l.Main,null,c().createElement(Bl,{applications:e.applications,bundle:e.bundle})),d=c().createElement(l.Main,null,c().createElement(zt,null));return c().createElement(c().Fragment,null,c().createElement(ht,{title:`${P.V.pages.notifications.list.title} | ${e.bundle.displayName}`,subtitle:c().createElement("span",null,"This service allows you to configure which notifications different users within your organization will be entitled to receiving. To do this, create behavior groups and apply them to different events. Users will be able to opt-in or out of receiving authorized event notifications in their",c().createElement("a",{href:(0,o.localUrl)(`/user-preferences/notifications/${e.bundle.name}`,(0,o.getInsights)().chrome.isBeta())}," User Preferences"),"."),action:n?null:c().createElement(ue,{isDisabled:!r.canReadEvents,to:s,variant:a.ButtonVariant.secondary},P.V.pages.notifications.list.viewHistory)}),c().createElement(Mt,{configuration:e.children,settings:e.children},c().createElement(a.Tab,{eventKey:0,title:c().createElement(a.TabTitleText,null,"Configuration")},u),c().createElement(a.Tab,{eventKey:1,title:c().createElement(a.TabTitleText,null,"Settings")},d)))};var Ul;!function(e){e[e.LOADING=0]="LOADING",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.FAILED_TO_LOAD=2]="FAILED_TO_LOAD"}(Ul||(Ul={}));const Vl=()=>{const e=(0,E.useParams)(),t=(0,m.useFlag)("platform.notifications.overhaul"),n=(0,s.useMemo)((()=>t?A:e.bundleName),[t,e.bundleName]),a=T(),l=(0,b.useParameterizedQuery)(xt),i=(0,s.useMemo)((()=>{var e,t;return 200===(null===(e=a.payload)||void 0===e?void 0:e.status)?null!==(t=a.payload.value.find((e=>e.name===n)))&&void 0!==t?t:Ul.NOT_FOUND:a.payload?Ul.FAILED_TO_LOAD:Ul.LOADING}),[a.payload,n]);s.useEffect((()=>{const e=l.query;(e=>"number"==typeof e)(i)||e(i.name)}),[i,l.query]);const o=(0,s.useMemo)((()=>{if(l.payload)return 200===l.payload.status?l.payload.value:null}),[l.payload]);if(i===Ul.NOT_FOUND){if(n===A)throw new Error("Default bundle information not found");return s.createElement(L,null)}if(i===Ul.FAILED_TO_LOAD)throw new Error("Unable to load bundle information");if(null===o)throw new Error("Unable to load application facets");return i!==Ul.LOADING&&o?s.createElement(Ml,{bundle:i,applications:o}):s.createElement(Ot,null)},_l=n.p+"fonts/notifications-product-icon.svg";var Zl;!function(e){e.USER="user",e.RUNNING="running",e.INTEGRATION="integration",e.USERS="users",e.BELL="bell"}(Zl||(Zl={}));const $l=({icon:e,heading:t,linkTitle:n,linkTarget:l,expandableContent:i})=>{let o=null;const[r,s]=c().useState(!1);switch(e){case Zl.USER:o=c().createElement(R.UserIcon,{className:"pf-u-primary-color-100"});break;case Zl.RUNNING:o=c().createElement(R.RunningIcon,{className:"pf-u-primary-color-100"});break;case Zl.INTEGRATION:o=c().createElement(R.IntegrationIcon,{className:"pf-u-primary-color-100"});break;case Zl.USERS:o=c().createElement(R.UsersIcon,{className:"pf-u-primary-color-100"});break;case Zl.BELL:o=c().createElement(R.BellIcon,{className:"pf-u-primary-color-100"})}return c().createElement(c().Fragment,null,c().createElement(a.DataListItem,{"aria-labelledby":"item1",isExpanded:r},c().createElement(a.DataListItemRow,{className:"pf-u-align-items-center"},c().createElement(a.DataListToggle,{isExpanded:r,id:"toggle1","aria-controls":"expand1",onClick:()=>s(!r)}),c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"cell-"+e.toString().toLowerCase()},c().createElement("div",null,c().createElement(a.Flex,{className:"pf-u-flex-nowrap"},c().createElement(a.FlexItem,{className:"pf-u-align-self-center"},c().createElement(a.Icon,{size:"lg"},o)),c().createElement(a.Divider,{orientation:{default:"vertical"}}),c().createElement(a.FlexItem,{className:"pf-u-align-self-center"},c().createElement(a.Title,{headingLevel:"h4"},t)))))]}),n&&l&&c().createElement(a.DataListAction,{"aria-labelledby":"item1 action1",id:"action1","aria-label":"Actions",isPlainButtonAction:!0},c().createElement(a.Button,{component:"a",href:l,variant:"link"},n))),c().createElement(a.DataListContent,{"aria-label":t+" - Detailed Explanation",id:"expand1",isHidden:!r},c().createElement("p",null,i))))},Hl={overview:()=>"/notifications",configureEvents:()=>"/notifications/configure-events",integrations:()=>"/integrations",notifications:e=>`/notifications/${e}`,eventLog:e=>"/notifications/eventlog"+(e?`?bundle=${e}`:""),splunk:()=>"/integrations/splunk-setup"},zl=[{path:"/",component:()=>null},{path:Hl.integrations(),component:F},{path:Hl.eventLog(),component:Pt},{path:Hl.notifications(":bundleName"),component:Vl},{path:Hl.splunk(),component:()=>{const[e,t]=(0,s.useState)(2),[n,i]=(0,s.useState)(!1),[o,r]=(0,s.useState)("info"),[u,d]=(0,s.useState)(""),[m,p]=(0,s.useState)(""),[E,g]=(0,s.useState)(["Logs from the automation would appear here\n"]),[v,h]=(0,s.useState)();return c().createElement(c().Fragment,null,c().createElement(l.PageHeader,null,c().createElement(se,null)),c().createElement(I,null,c().createElement(a.Card,null,c().createElement(a.CardBody,null,c().createElement(a.Split,{hasGutter:!0},c().createElement(a.SplitItem,null,c().createElement(a.ProgressStepper,{isVertical:!0},c().createElement(a.ProgressStep,{isCurrent:1===e,variant:"success",description:"Create Index and HEC",id:"step1-splunk-app-step",titleId:"step1-splunk-app-step","aria-label":"completed Splunk app step (step 1)"},"Step 1"),c().createElement(a.ProgressStep,{isCurrent:2===e,icon:2===e&&n?c().createElement(R.InProgressIcon,null):void 0,variant:e<2?"info":o,description:"Configure Splunk integration in Insights",id:"step2-setup-step",titleId:"step2-setup-step","aria-label":"setup step (step 2)"},"Step 2"),c().createElement(a.ProgressStep,{isCurrent:3===e,variant:e<3?"pending":o,description:"Review",id:"step3-review-step",titleId:"step3-review-step","aria-label":"review step (step 3)"},"Step 3"))),c().createElement(a.Divider,{isVertical:!0}),c().createElement(a.SplitItem,{isFilled:!0},2===e&&c().createElement(ie,{setStep:t,stepIsInProgress:n,setStepIsInProgress:i,stepVariant:o,setStepVariant:r,hecToken:u,setHecToken:d,splunkServerHostName:m,setHostName:p,automationLogs:E,setAutomationLogs:g,setError:h}),3===e&&c().createElement(M,{isSuccess:"success"===o,error:v})))))))}}],ql=[{path:Hl.overview(),component:()=>{const[e,t]=c().useState(null),{auth:n}=(0,i.Z)(),o=(0,m.useFlag)("platform.notifications.overhaul");return c().useEffect((()=>{n&&(async()=>{const{identity:{user:e}}=await n.getUser();t(e.is_org_admin)})()}),[n]),c().createElement(c().Fragment,null,c().createElement(l.PageHeader,null,c().createElement(a.Flex,{className:"pf-u-flex-nowrap"},c().createElement(a.FlexItem,null,c().createElement("img",{src:_l})),c().createElement(a.Divider,{orientation:{default:"vertical"}}),c().createElement(a.FlexItem,{className:"pf-u-align-self-flex-start"},c().createElement(l.PageHeaderTitle,{title:"Notifications",className:"pf-u-mb-sm"}),c().createElement("p",{className:"pf-u-mb-sm"},"A standardized way of notifying users of events for supported services on the Hybrid Cloud Console."),e&&c().createElement("a",{href:"#"},"Learn more ",c().createElement(R.ExternalLinkAltIcon,null))))),c().createElement(l.Main,null,e?c().createElement(c().Fragment,null,c().createElement(a.Card,{className:"pf-u-mb-lg"},c().createElement(a.Grid,{hasGutter:!0},c().createElement(a.GridItem,{sm:12,md:6,lg:8},c().createElement(a.CardTitle,null,c().createElement(a.Title,{headingLevel:"h2"},"Manage events for your organization")),c().createElement(a.CardBody,null,c().createElement("p",null,"This service allows you to configure which notifications different users within your organization will be entitled to receiving. To do this, create behavior groups and apply them to different events. Users will be able to opt-in or out of receiving authorized event notifications in their ",c().createElement("a",{href:"#"},"User Preferences"),".")),c().createElement(a.CardFooter,null,c().createElement(a.Button,{variant:"primary",isLarge:!0},"Configure events"))),c().createElement(a.GridItem,{md:6,lg:4,className:"pf-u-display-none pf-u-display-block-on-md pf-c-card__cover-image"})))):c().createElement(c().Fragment,null,c().createElement(a.Title,{headingLevel:"h2",className:"pf-u-mb-md"},"Get started with Notifications on the Hybrid Cloud Console"),c().createElement(a.Grid,{hasGutter:!0,className:"pf-u-mb-lg"},c().createElement(a.GridItem,{sm:12,md:6},c().createElement(a.Card,{className:"pf-u-h-100"},c().createElement(a.CardTitle,null,c().createElement(a.Flex,{className:"pf-u-flex-nowrap"},c().createElement(a.FlexItem,null,c().createElement(a.Icon,{size:"lg"},c().createElement(R.UserIcon,{className:"pf-u-primary-color-100"}))),c().createElement(a.FlexItem,null,c().createElement(a.Title,{headingLevel:"h2"},"Manage your own notifications with My User Preferences")))),c().createElement(a.CardBody,null,c().createElement("p",null,"This service allows you to opt-in and out of receiving notifications. Your Organization Administrator has configured which notifications you can or can not receive in their Settings.")),c().createElement(a.CardFooter,null,c().createElement(a.Button,{variant:"primary",isLarge:!0},"Go to My User Preferences")))),c().createElement(a.GridItem,{sm:12,md:6},c().createElement(a.Card,{className:"pf-u-h-100"},c().createElement(a.CardTitle,null,c().createElement(a.Flex,{className:"pf-u-flex-nowrap"},c().createElement(a.FlexItem,null,c().createElement(a.Icon,{size:"lg"},c().createElement(R.RunningIcon,{className:"pf-u-primary-color-100"}))),c().createElement(a.FlexItem,null,c().createElement(a.Title,{headingLevel:"h2"},"Monitor all fired events with the Event log")))),c().createElement(a.CardBody,null,c().createElement("p",null,"See all the events affecting your organization and view details around the events fired.")),c().createElement(a.CardFooter,null,!o&&c().createElement(a.Button,{variant:"secondary",isLarge:!0},"View Event log")))))),e?c().createElement(c().Fragment,null,c().createElement(a.Title,{headingLevel:"h2",className:"pf-u-mb-md"},"Supporting features"),c().createElement(a.DataList,{"aria-label":"Supporting features list",className:"pf-u-mb-lg"},c().createElement($l,{icon:Zl.USER,heading:"Manage your own notifications with My User Preferences",linkTitle:"Go to My User Preferences",linkTarget:"#",expandableContent:"This service allows you to opt-in and out of receiving notifications. Your Organization\n                            Administrator has configured which notifications you can or can not receive in their Settings."}),c().createElement($l,{icon:Zl.RUNNING,heading:"Monitor all fired events with the Event log",linkTitle:"View Event log",linkTarget:"#",expandableContent:"See all the events affecting your organization and view details around the events fired."}),c().createElement($l,{icon:Zl.INTEGRATION,heading:"Set up Integrations to customize your notifications",linkTitle:"Set up Integrations",linkTarget:"#",expandableContent:"Notifications and integrations services work together to transmit messages to third-party application\n                    endpoints, such as instant messaging platforms and external ticketing systems, when triggering events occur. Integrations\n                    include Splunk, Slack, ServiceNow, and more."}),c().createElement($l,{icon:Zl.USERS,heading:"Create behavior groups to easily notify the right users",linkTitle:"Create new behavior group",linkTarget:"#",expandableContent:"Behavior groups are made up of action/recipient pairings that allow you to configure which notification\n                    actions different users will be able to receive. Once you've created a behavior group, you can assign it to an event. You\n                    may also prevent users from changing assigned actions by locking action/recipient pairings when creating or editing behavior\n                    groups."}))):c().createElement(c().Fragment,null,c().createElement(a.DataList,{"aria-label":"Supporting features list",className:"pf-u-mb-lg"},c().createElement($l,{icon:Zl.BELL,heading:"About Notifications",expandableContent:"Notifications are a way for users to be alerted of important events that occur in the Hybrid Cloud\n                            Console. You can receive notifications within the console via the notifications drawer as well as through email and\n                            third-party integrations, such as Slack or ServiceNow."}))),c().createElement(a.Title,{headingLevel:"h2",className:"pf-u-mb-md"},"Recommended content"),e?c().createElement(c().Fragment,null,c().createElement(a.DataList,{"aria-label":"Recommended content list",className:"pf-u-mb-lg"},c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row1-col1"},c().createElement("span",null,"Configuring notifications and integrations")),c().createElement(a.DataListCell,{key:"row1-col2"},c().createElement(a.Label,{color:"orange"},"Documentation")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row1-col3"},c().createElement("a",{href:"#"},"View documentation ",c().createElement(R.ExternalLinkAltIcon,null)))]}))),c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row2-col1"},c().createElement("span",null,"Configuring integrations and events")),c().createElement(a.DataListCell,{key:"row2-col2"},c().createElement(a.Label,{color:"orange"},"Documentation")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row2-col3"},c().createElement("a",{href:"#"},"View documentation ",c().createElement(R.ExternalLinkAltIcon,null)))]}))),c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row3-col1"},c().createElement("span",null,"Restricting access to a service to a team")),c().createElement(a.DataListCell,{key:"row3-col2"},c().createElement(a.Label,{color:"green"},"Quick start")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row3-col3"},c().createElement("a",{href:"#"},"Begin Quick start ",c().createElement(R.ArrowRightIcon,null)))]}))))):c().createElement(c().Fragment,null,c().createElement(a.DataList,{"aria-label":"Recommended content list",className:"pf-u-mb-lg"},c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row1-col1"},c().createElement("span",null,"Configuring notifications and integrations")),c().createElement(a.DataListCell,{key:"row1-col2"},c().createElement(a.Label,{color:"orange"},"Documentation")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row1-col3"},c().createElement("a",{href:"#"},"View documentation ",c().createElement(R.ExternalLinkAltIcon,null)))]}))),c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row2-col1"},c().createElement("span",null,"Configuring sources for Red Hat services")),c().createElement(a.DataListCell,{key:"row2-col2"},c().createElement(a.Label,{color:"orange"},"Documentation")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row2-col3"},c().createElement("a",{href:"#"},"View documentation ",c().createElement(R.ExternalLinkAltIcon,null)))]}))))),c().createElement("a",{href:"#",className:"pf-u-mb-lg"},"View all Settings Learning Resources")))}},{path:Hl.integrations(),component:F},{path:Hl.configureEvents(),component:Vl},{path:Hl.eventLog(),component:Pt}],Wl=e=>{const{component:t,...n}=e;return s.createElement(O,null,s.createElement(p.AW,{...n},s.createElement(w,null,s.createElement(e.component,null))))},Ql=()=>{const e=(0,i.Z)(),t=(0,E.useHistory)(),n=(0,m.useFlag)("platform.notifications.overhaul"),a=s.useMemo((()=>n?ql:zl),[n]);return s.useEffect((()=>{const n=e.on;if(n)return n("APP_NAVIGATION",(e=>{const n=e.domEvent.href,l=n.substr(n.indexOf("/notifications"));a.some((({path:e})=>{if((0,E.matchPath)(l,{path:e,exact:!0}))return t.replace(l),!0}))}))}),[e.on,t,a]),s.createElement(p.rs,null,a.map((e=>s.createElement(Wl,{key:e.path,component:e.component,path:e.path,exact:!0}))),!n&&s.createElement(L,null))};var Yl=n(54926),jl=n(56335),Kl=n(3121);const Jl="HH:mm",Xl="hh:mma",ei=(0,u.style)({padding:8}),ti=()=>{const{updateDocumentTitle:e}=(0,i.Z)();null==e||e("Notifications");const{rbac:t,server:n,isOrgAdmin:c}=(0,Kl.q)(),u=(0,o.getInsights)(),[m,p]=s.useState(!1),E=s.useCallback((e=>{e?(u.chrome.getEnvironmentOriginal=u.chrome.getEnvironment,u.chrome.getEnvironment=()=>"ci"):u.chrome.getEnvironment=u.chrome.getEnvironmentOriginal,p(e)}),[u]);if(!t||!n)return s.createElement(Ot,null);if(n.status===Yl.U.MAINTENANCE){const e=(0,r.Z)((0,o.toUtc)(n.from),Jl),t=(0,r.Z)((0,o.toUtc)(n.to),Jl),a=(0,r.Z)(n.from,Xl),i=(0,r.Z)(n.to,Xl),c=(0,r.Z)(n.to,"O");return s.createElement(l.Maintenance,{utcStartTime:e,utcEndTime:t,startTime:a,endTime:i,timeZone:c})}return s.createElement(g.I.Provider,{value:{rbac:t,server:n,isOrgAdmin:!!c}},s.createElement(jl.d,null,s.createElement(d.q,null),s.createElement(o.InsightsEnvDetector,{insights:u,onEnvironment:hn.ok},s.createElement(o.RenderIfTrue,null,s.createElement(a.Switch,{className:ei,isChecked:m,onChange:E,labelOff:"Enable experimental features",label:"Disable experimental features"}))),s.createElement(Ql,null)))}}}]);
//# sourceMappingURL=../sourcemaps/9692.b14242fffd42a8995b4832c0fd48bf96.js.map