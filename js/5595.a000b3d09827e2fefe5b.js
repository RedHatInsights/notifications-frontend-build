"use strict";(self.webpackChunknotifications_frontend=self.webpackChunknotifications_frontend||[]).push([[5595],{26436:(e,t,n)=>{n.d(t,{Z:()=>Yl});var a=n(21242),l=n(68199),i=n(55140),o=n(55128),r=n(21472),s=n(93264),c=n.n(s),u=n(8813),d=n(42150),m=n(89063),p=n(62012),E=n(84456),g=n(79153),v=n(86896),h=n(77365),f=n(94782),y=n(16721);const b=(e,t=!0)=>(0,f.useQuery)((e=>y.B.NotificationResourceGetBundleFacets.actionCreator({includeApplications:e}))(!!e),t);var C=n(28216);const T=l.Main,S=e=>{const t=(0,C.useStore)();return s.createElement(T,{store:t,...e})},k=()=>{var e,t;const n=(0,i.Z)(),{bundleName:r}=(0,p.useParams)(),u=b(),d=(0,s.useMemo)((()=>{var e;if(200===(null===(e=u.payload)||void 0===e?void 0:e.status))return u.payload.value.find((e=>e.name===r))}),[r,null===(e=u.payload)||void 0===e?void 0:e.status,null===(t=u.payload)||void 0===t?void 0:t.value]),m=(0,p.useLocation)(),E=(0,v.Z)(),f=c().createElement("a",{href:(0,o.localUrl)("/user-preferences/notifications/",n.isBeta())}," User Preferences"),y=c().createElement("a",{href:(0,o.localUrl)("/settings/my-user-access?bundle=rhel }",n.isBeta())}," My User Access "),C=c().useMemo((()=>{switch(n.getApp()){case g.ZP.integrations.subAppId:return E.formatMessage(h.Z.integrations);case g.ZP.notifications.subAppId:return m.pathname===Ul.eventLog()?"Event Log":E.formatMessage(h.Z.notifications);default:return""}}),[E,m.pathname,n]),T=c().useMemo((()=>"Notifications"===C?`${C} | ${d?d.displayName:c().createElement(a.Skeleton,null)}`:`${C}`),[d,C]),k=c().useMemo((()=>"Notifications"===C?c().createElement("span",null,"This service allows you to configure which notifications different users within your organization will be entitled to receiving. To do this, create behavior groups and apply them to different events. Users will be able to opt-in or out of receiving authorized event notifications in their",c().createElement("a",{href:(0,o.localUrl)("/user-preferences/notifications/",n.isBeta())}," User Preferences"),"."):c().createElement("span",null)),[C,n]);return c().createElement(c().Fragment,null,c().createElement(l.PageHeader,null,c().createElement(a.Split,null,c().createElement(a.SplitItem,{isFilled:!0},c().createElement(l.PageHeaderTitle,{title:T,paddingBottom:"8px"}," "),c().createElement(a.StackItem,null,k)))),c().createElement(S,null,c().createElement(l.NotAuthorized,{description:c().createElement(c().Fragment,null," Contact your organization administrator for more information or visit",y," to learn more about your permissions. To manage your notifications, go to your ",f,"."),serviceName:C})))},I=e=>{const t=(0,i.Z)(),{rbac:n}=(0,E.b)(),a=(0,p.useLocation)(),l=c().useMemo((()=>{switch(t.getApp()){case g.ZP.integrations.subAppId:return null==n?void 0:n.canReadIntegrationsEndpoints;case g.ZP.notifications.subAppId:return a.pathname===Ul.eventLog()?null==n?void 0:n.canReadEvents:null==n?void 0:n.canReadNotifications}return!1}),[n,a,t]);return c().createElement(c().Fragment,null,l?e.children:c().createElement(k,null))};var N=n(18115),w=n(98673);const A=()=>{const{updateDocumentTitle:e,getBundle:t}=(0,i.Z)();null==e||e("Integrations");const n=(0,m.useFlag)("platform.notifications.overhaul");return s.createElement(l.Section,{className:"pf-c-page__main-section pf-m-light"},s.createElement(l.PageHeader,null,s.createElement(a.Split,null,s.createElement(a.SplitItem,{isFilled:!0},s.createElement(l.PageHeaderTitle,{title:N.V.pages.integrations.list.title})),!n&&s.createElement(a.SplitItem,null,s.createElement(a.Button,{variant:"secondary",component:()=>s.createElement(p.Link,{to:`/${t()}/notifications${Ul.eventLog()}`})}," View event log ")))),s.createElement(S,null,s.createElement(w.Z,null)))};var L=n(43551);const D=N.V.pages.splunk.page.helpUrl,P="https://access.redhat.com/support/cases/#/case/new/open-case/describe-issue?intcmp=hp|a|a3|case&caseCreate=true&product=Red%20Hat%20Insights&version=Red%20Hat%20Insights",O=({isSuccess:e,error:t})=>e?c().createElement(F,null):c().createElement(x,{error:t}),F=()=>c().createElement(a.EmptyState,null,c().createElement(a.EmptyStateIcon,{icon:L.CheckCircleIcon,color:"var(--pf-global--success-color--100)"}),c().createElement(a.Title,{headingLevel:"h4",size:"lg"},"Splunk integration in Insights completed"),c().createElement(a.EmptyStateBody,null,"Splunk integration in Insights was completed. To confirm these changes, ",c().createElement("strong",null,"go back to Splunk application"),".")),x=({error:e})=>c().createElement(a.EmptyState,null,c().createElement(a.EmptyStateIcon,{icon:L.ExclamationCircleIcon,color:"var(--pf-global--danger-color--100)"}),c().createElement(a.Title,{headingLevel:"h4",size:"lg"},"Configuration failed"),c().createElement(a.EmptyStateBody,null,c().createElement("p",{className:"pf-u-mb-md"},"There was a problem processing the request. Please try again. If the problem persists, contact Red Hat support by opening the ticket."),e&&c().createElement("p",null,`${e}`)),c().createElement(a.Button,{variant:"primary",component:"a",href:P,target:"_blank",rel:"noopener noreferrer"},"Open a Red Hat Support ticket"),c().createElement(a.EmptyStateSecondaryActions,null,c().createElement(a.Button,{variant:"link",component:"a",href:D,target:"_blank",rel:"noopener noreferrer"},"Go to documentation")));var R=n(63055),G=n(70070),B=n(10406);const M=e=>{const t=(null!=e?e:o.Page.defaultPage()).toQuery();return y.B.NotificationResourceGetEventTypes.actionCreator({limit:+t.limit,offset:+t.offset,applicationIds:t.filterApplicationId,eventTypeName:t.filterEventFilterName,bundleId:t.filterBundleId,sortBy:`${t.sortColumn}:${t.sortDirection}`})},U=(0,G.validationResponseTransformer)((e=>200===e.status?(0,G.validatedResponse)("eventTypesArray",200,{...e.value,data:(0,B.Jc)(e.value.data)},e.errors):e)),V=e=>(0,o.useTransformQueryResponse)((0,f.useQuery)(M(e)),U),_=(0,G.validationResponseTransformer)((e=>200===e.status?(0,G.validatedResponse)("BehaviorGroupId",200,e.value.map((e=>e.id)),e.errors):e));var $=y.B.NotificationResourceUpdateEventTypeBehaviors;const Z=(e,t)=>$.actionCreator({body:t,eventTypeId:e}),H=(0,G.validationResponseTransformer)((e=>{if("CreateBehaviorGroupResponse"===e.type){const t={id:e.value.id,displayName:e.value.display_name,bundleId:e.value.bundle_id,isDefault:!1,bundleName:void 0,actions:[],events:[]};return(0,G.validatedResponse)("BehaviorGroup",e.status,t,e.errors)}return e})),z=e=>"id"in e?y.B.NotificationResourceUpdateBehaviorGroup.actionCreator({id:e.id,body:{display_name:e.displayName,endpoint_ids:e.endpointIds,event_type_ids:e.eventTypesIds}}):y.B.NotificationResourceCreateBehaviorGroup.actionCreator({body:{bundle_id:e.bundleId,display_name:e.displayName,endpoint_ids:e.endpointIds,event_type_ids:e.eventTypesIds}}),q=()=>(0,o.useTransformQueryResponse)((0,f.useMutation)(z),H),W=e=>y.B.NotificationResourceUpdateBehaviorGroupActions.actionCreator({behaviorGroupId:e.behaviorGroupId,body:e.endpointIds});var Q=n(5543),Y=n(73091);const K={advisor:"*",policies:"*",drift:"*",compliance:"*","malware-detection":"*",patch:"*",vulnerability:"*"},j=()=>{const e=(()=>{const{query:e}=(0,f.useClient)(),t=async n=>{var a;n||(n=o.Page.defaultPage().withSort(o.Sort.by("application",o.Direction.ASCENDING)));const{errorObject:l,payload:i}=await e(M(n));if(l)throw l;if("PageEventType"===(null==i?void 0:i.type)){const e=null===(a=null==i?void 0:i.value)||void 0===a?void 0:a.data;return 0===e.length?[]:[...e,...await t(n.nextPage())]}throw new Error(`Unknow payload type for eventTypes ${null==i?void 0:i.type}`)};return t})(),t=(0,f.useClient)(),n=(()=>{const e=(0,f.useClient)();return async t=>{const{errorObject:n,payload:a}=await e.query((e=>y.B.NotificationResourceGetLinkedBehaviorGroups.actionCreator({eventTypeId:e}))(t));if(n)throw n;return _(a)}})(),a=async(e,a)=>{const l=[...(await n(e.id)).value,a.id],{payload:i,errorObject:o,error:r}=await t.query(Z(e.id,l));if(o)throw o;if(r)throw new Error(`Unsuccessful linking of event type ${e.id}`);return i};return async(t,n,l)=>{var i;const o=(await e()).filter((e=>{if(!(null==e?void 0:e.application))return!1;if(e.application.bundle_id!==t.bundleId)return!1;const a=n[e.application.name];return!(!a||"*"!==a&&!a.includes(e.name))}));for(const e of o){l(`  ${null===(i=e.application)||void 0===i?void 0:i.display_name} - ${e.display_name}...`);try{await a(e,t),l(" ASSOCIATED\n","pf-u-success-color-200")}catch(e){l(" ERROR!\n","pf-u-danger-color-200"),console.log(e)}}}},J=(0,R.Z_)().url().test("has-no-path","URL contains path or parameters",(e=>{let t;try{t=new URL(e)}catch{return!1}return("/"===t.pathname||""===t.pathname)&&""===t.search})),X=({setStep:e,stepIsInProgress:t,setStepIsInProgress:n,stepVariant:l,setStepVariant:i,hecToken:r,setHecToken:u,splunkServerHostName:d,setHostName:m,automationLogs:p,setAutomationLogs:E,setError:g})=>{const v=(()=>{const e=(()=>{const{mutate:e}=(0,Q.TK)();return async({integrationName:t,splunkServerHostName:n,hecToken:a})=>{const l={type:Y.WN.SPLUNK,name:t,url:n,secretToken:a,isEnabled:!0,sslVerificationEnabled:!0},{payload:i,error:o,errorObject:r}=await e(l);if(r)throw r;if(o)throw new Error(`Error when creating integration ${t}`);return null==i?void 0:i.value}})(),t=(()=>{const{mutate:e}=q(),t=(()=>{const{query:e}=b(!1,!1);return async t=>{const n=await e(),a=n.payload;if(n.errorObject)throw n.errorObject;if(n.error||!a)throw new Error(`Unable to retrieve bundles, status ${a.status}`);return a.value.find((e=>e.name===t))}})();return async({behaviorGroupName:n,bundleName:a})=>{const l=await t(a);if(!l)throw new Error(`Unable to find bundle ${a}`);const i={bundleId:l.id,displayName:n,actions:[],events:[]},{payload:o,error:r,errorObject:s}=await e(i);if(s)throw s;if(r)throw new Error(`Error when creating behavior group ${n}`);return null==o?void 0:o.value}})(),n=(()=>{const{mutate:e}=(0,f.useMutation)(W);return async(t,n)=>{const a=t.actions||[];a.push(n.id);const l={behaviorGroupId:t.id,endpointIds:a},{payload:i,error:o,errorObject:r}=await e(l);if(r)throw r;if(o)throw new Error(`Error when linking behavior group ${t.id} with integration ${n.id}`);return null==i?void 0:i.value}})(),a=j();return async({hecToken:l,splunkServerHostName:i},o)=>{const r="SPLUNK_AUTOMATION",s="SPLUNK_AUTOMATION_GROUP",c=K;o(`Creating Integration ${r}...`);const u=await e({integrationName:r,hecToken:l,splunkServerHostName:i});o(" OK","pf-u-success-color-200"),o(`\nCreating Behavior Group ${s}...`);const d=await t({behaviorGroupName:s,bundleName:"rhel"});o(" OK","pf-u-success-color-200"),o("\nAssociating integration as an action for the behavior group..."),await n(d,u),o(" OK","pf-u-success-color-200"),o("\n\nAssociating events to the behavior group:\n"),await a(d,c,o)}})(),[h,y]=(0,s.useState)(!0),[C,T]=(0,s.useState)(a.ValidatedOptions.default),[S,k]=(0,s.useState)(a.ValidatedOptions.default);(0,s.useEffect)((()=>{[C,S].every((e=>e===a.ValidatedOptions.success))?y(!1):y(!0)}),[C,S]);const I=(e,t)=>{let n=e;t&&(n=c().createElement("span",{className:t},e)),E((e=>[...e,n]))};return c().createElement(a.Grid,null,c().createElement(a.GridItem,{span:6},c().createElement(a.Form,{className:"pf-u-mr-md"},c().createElement(a.FormGroup,{label:"Splunk HEC URL",labelIcon:c().createElement(a.Popover,{headerContent:c().createElement("div",null,"The server ",c().createElement("b",null,"hostname/IP Address")," and ",c().createElement("b",null,"port")," of your splunk HTTP Event Collector"),bodyContent:c().createElement("div",null,"For Splunk Enterprise the port is by default 8088.",c().createElement("br",null),"For Splunk Cloud Platform see"," ",c().createElement("a",{target:"_blank",rel:"noreferrer",href:"https://docs.splunk.com/Documentation/SplunkCloud/latest/Data/UsetheHTTPEventCollector#Send_data_to_HTTP_Event_Collector"},"documentation"),".")},c().createElement("button",{type:"button","aria-label":"More info for name field",onClick:e=>e.preventDefault(),"aria-describedby":"splunk-server-hostname",className:"pf-c-form__group-label-help"},c().createElement(L.HelpIcon,{noVerticalAlign:!0}))),isRequired:!0,fieldId:"splunk-server-hostname",helperTextInvalid:"Invalid URL. Example: https://hostname:8088",validated:C},c().createElement(a.TextInput,{isRequired:!0,type:"text",id:"splunk-server-hostname",name:"splunk-server-hostname","aria-describedby":"splunk-server-hostname-helper",value:d,validated:C,onChange:async e=>{if(m(e),""===e)T(a.ValidatedOptions.default);else{const t=await J.isValid(e);T(t?a.ValidatedOptions.success:a.ValidatedOptions.error)}}})),c().createElement(a.FormGroup,{label:"Splunk HEC Token",fieldId:"splunk-hec-token",isRequired:!0,helperTextInvalid:"Invalid HEC token. Example: 123e4567-e89b-12d3-a456-426614174000",validated:S},c().createElement(a.TextInput,{isRequired:!0,type:"text",id:"splunk-hec-token",name:"splunk-hec-token","aria-describedby":"splunk-hec-token-helper",validated:S,value:r,onChange:async e=>{if(u(e),""===e)k(a.ValidatedOptions.default);else{const t=await(0,R.Z_)().uuid().isValid(e);k(t?a.ValidatedOptions.success:a.ValidatedOptions.error)}}})),c().createElement(a.ActionGroup,null,c().createElement(ee,{onStart:async()=>{n(!0),E([]);try{await v({hecToken:r,splunkServerHostName:d},I)}catch(e){return I(`\n${e}`,"pf-u-danger-color-200"),n(!1),i("danger"),(0,o.addDangerNotification)("Configuration failed",c().createElement(te,null),!0),void g(e)}y(!1),n(!1),i("success"),I("\nDONE!","pf-u-success-color-200")},onFinish:()=>{e((e=>e+1))},stepIsInProgress:t,stepVariant:l,isDisabled:h})))),c().createElement(a.GridItem,{span:6},c().createElement(a.CodeBlock,null,c().createElement(a.CodeBlockCode,null,p))))},ee=({onStart:e,onFinish:t,stepIsInProgress:n,stepVariant:l,isDisabled:i})=>n?c().createElement(a.Button,{variant:"primary",isLoading:!0},"Configuration in progress"):"success"===l||"danger"===l?c().createElement(a.Button,{variant:"primary",onClick:t},"success"===l?c().createElement(L.CheckCircleIcon,null):c().createElement(L.ExclamationCircleIcon,null)," ","Next: Review"):c().createElement(a.Button,{variant:"primary",isDisabled:i,onClick:e},"Run Configuration"),te=()=>c().createElement(c().Fragment,null,c().createElement("p",{className:"pf-u-mb-md"},"There was a problem processing the request. Please try again. If the problem persists, contact Red Hat support by opening the ticket."),c().createElement(a.List,{variant:a.ListVariant.inline},c().createElement(a.ListItem,null,c().createElement("a",{target:"_blank",rel:"noopener noreferrer",href:P},"Open a Red Hat Support ticket")),c().createElement(a.ListItem,null,c().createElement("a",{target:"_blank",rel:"noopener noreferrer",href:D},"Go to documentation")))),ne=()=>c().createElement(c().Fragment,null,c().createElement(l.PageHeaderTitle,{title:c().createElement(c().Fragment,null,N.V.pages.splunk.page.title,c().createElement(a.Popover,{bodyContent:N.V.pages.splunk.page.help,footerContent:c().createElement("a",{target:"_blank",rel:"noopener noreferrer",href:D},"Learn more ",c().createElement(L.ExternalLinkSquareAltIcon,null))},c().createElement(a.Button,{variant:"plain","aria-label":"Help description",className:"title-help-label"},c().createElement(L.HelpIcon,{noVerticalAlign:!0}))))}),N.V.pages.splunk.page.description);var ae=n(46242);const le=({to:e,...t})=>{const{getBundle:n}=(0,i.Z)();return s.createElement(p.Link,{to:`/${n()}/notifications${e}`},s.createElement(a.Button,{...t},t.children))};var ie,oe=n(64258),re=n(3276),se=n(29987),ce=n(47435),ue=n(29422),de=n(313),me=n(42699),pe=n(23855),Ee=n(37950),ge=n(18172);!function(e){e.TODAY="today",e.YESTERDAY="yesterday",e.LAST_7="last_7",e.LAST_14="last_14",e.CUSTOM="custom"}(ie||(ie={}));const ve={[ie.TODAY]:"Today",[ie.YESTERDAY]:"Yesterday",[ie.LAST_7]:"Last 7 days",[ie.LAST_14]:"Last 14 days",[ie.CUSTOM]:"Custom"},he=(0,u.style)({paddingLeft:oe.S.value,paddingRight:oe.S.value,color:re.p.value}),fe=(0,u.style)({backgroundColor:(0,ce.important)("white"),cursor:"pointer",$nest:{"&::placeholder":{color:(0,ce.important)("black")},"&:hover":{borderBottomColor:se.h.value}}});class ye{constructor(e){this.value=e}toString(){return ve[this.value]}compareTo(e){return e instanceof ye&&e.value===this.value}}const be={isReadOnly:!0,className:fe},Ce=e=>{const t=s.useMemo((()=>new Date),[]),n=s.useMemo((()=>(0,ue.Z)(t,{days:-14})),[t]),l=s.useMemo((()=>[a=>(0,de.Z)(a,n)?"Date is before the retention policy":(0,me.Z)(a,t)?"Date is after today":e.period[1]&&(0,me.Z)(a,e.period[1])?"Start date must be before end date":""]),[n,t,e.period]),i=s.useMemo((()=>[a=>(0,de.Z)(a,n)?"Date is before the retention policy":(0,me.Z)(a,t)?"Date is after today":e.period[0]&&(0,de.Z)(a,e.period[0])?"End date must be after start date":""]),[n,t,e.period]),o=s.useCallback((n=>{const a=e.setPeriod,l=(0,pe.Z)(n);a((0,ge.ZP)((e=>{e[0]=l,e[1]||(e[1]=(0,Ee.Z)([(0,ue.Z)(l,{days:1}),t]))})))}),[e.setPeriod,t]),c=s.useCallback((t=>{(0,e.setPeriod)((0,ge.ZP)((e=>{e[1]=(0,pe.Z)(t)})))}),[e.setPeriod]),u=s.useMemo((()=>e.period[0]?(0,r.Z)(e.period[0],"yyyy-MM-dd"):void 0),[e.period]),d=s.useMemo((()=>e.period[1]?(0,r.Z)(e.period[1],"yyyy-MM-dd"):void 0),[e.period]),m=(0,s.useRef)(null),p=(0,s.useRef)(null),E=s.useCallback((()=>{var e;null===(e=m.current)||void 0===e||e.setCalendarOpen(!0)}),[m]),g=s.useCallback((()=>{var e;null===(e=p.current)||void 0===e||e.setCalendarOpen(!0)}),[p]),v=s.useMemo((()=>({...be,onClick:E})),[E]),h=s.useMemo((()=>({...be,onClick:g})),[g]);return s.createElement(a.Split,null,s.createElement(a.SplitItem,null,s.createElement(a.DatePicker,{placeholder:"Start",inputProps:v,validators:l,onChange:o,value:u,ref:m})),s.createElement(a.SplitItem,null,s.createElement(a.Bullseye,null,s.createElement("span",{className:he},"to"))),s.createElement(a.SplitItem,null,s.createElement(a.DatePicker,{placeholder:"End",inputProps:h,validators:i,onChange:c,value:d,ref:p})))},Te=e=>{const t=s.useMemo((()=>Object.values(ie).map((e=>s.createElement(a.SelectOption,{key:e,value:new ye(e)})))),[]),[n,l]=s.useState(!1),i=s.useCallback((()=>l((e=>!e))),[l]),o=s.useMemo((()=>new ye(e.value)),[e.value]),r=s.useCallback(((t,n)=>{const a=e.setValue;n instanceof ye&&(a(n.value),l(!1))}),[e.setValue]);return s.createElement(a.Split,null,s.createElement(a.SplitItem,null,s.createElement(a.Select,{isOpen:n,variant:a.SelectVariant.single,onToggle:i,selections:o,onSelect:r},t)),e.value===ie.CUSTOM&&s.createElement(a.SplitItem,null,s.createElement(Ce,{period:e.period,setPeriod:e.setPeriod,retentionDays:e.retentionDays})))};var Se=n(76871),ke=n(71652),Ie=n(89887),Ne=n(12990),we=n(4088),Ae=n(32564),Le=n(54971);const De=()=>s.createElement(Le.q,{text:"Failure"},s.createElement(L.ExclamationCircleIcon,{"data-testid":"fail-icon",color:Ne.Q.value})),Pe=()=>s.createElement(Le.q,{text:"Unknown"},s.createElement(L.UnknownIcon,{"data-testid":"unknown-icon"})),Oe=()=>s.createElement(Le.q,{text:"Processing"},s.createElement(L.InProgressIcon,{"data-testid":"in-progress-icon"})),Fe=()=>s.createElement(Le.q,{text:"Sent"},s.createElement(L.CheckCircleIcon,{"data-testid":"success-icon",color:we.g.value})),xe=()=>s.createElement(Le.q,{text:"Success"},s.createElement(L.CheckCircleIcon,{"data-testid":"success-icon",color:we.g.value})),Re=()=>s.createElement(Le.q,{text:"Warning"},s.createElement(L.ExclamationTriangleIcon,{color:Ae.k.value})),Ge=[[s.createElement(xe,{key:"status-success"}),"The notification was executed successfully"],[s.createElement(Fe,{key:"status-sent"}),"The notification was sent for processing - but there is no way to assert if it was executed successfully"],[s.createElement(Re,{key:"status-warning"}),"The notification was executed successfully after some retries"],[s.createElement(Oe,{key:"status-processing"}),"The notification was sent for processing and is awaiting an outcome result"],[s.createElement(De,{key:"status-failed-externally"}),"An unexpected error occurred while processing the notification"]],Be=e=>s.createElement(Ie.d,{title:"Action status meaning",tableBody:Ge},s.createElement(s.Fragment,null,e.children));var Me=n(36441),Ue=n(21095);const Ve=(0,u.style)({minWidth:(0,ce.important)("90px")}),_e=(0,u.style)({color:Me.D.value}),$e=e=>{const{action:{id:t},getIntegrationRecipient:n}=e,l=(0,Ue.Z)((async()=>t&&n(t)),[t,n]);return s.createElement(Se.TableComposable,{borders:!1,variant:Se.TableVariant.compact,isStickyHeader:!0},s.createElement(Se.Thead,null,s.createElement(Se.Tr,null,s.createElement(Se.Th,{className:Ve},"Action"),s.createElement(Se.Th,{className:Ve},"Recipient"),s.createElement(Se.Th,{className:Ve},"Status"))),s.createElement(Se.Tbody,null,s.createElement(Se.Tr,null,s.createElement(Se.Td,null,g.ZP.integrations.types[e.action.endpointType].action),s.createElement(Se.Td,null,t?l.loading?s.createElement(a.Skeleton,{width:"150px"}):l.value:s.createElement(a.Tooltip,{content:"The integration no longer exists, it could have been deleted."},s.createElement("span",null,"Unknown integration"))),s.createElement(Se.Td,null,s.createElement("div",null,(e=>{switch(e.last){case"SUCCESS":return e.isDegraded?s.createElement(Re,null):s.createElement(xe,null);case"SENT":return s.createElement(Fe,null);case"PROCESSING":return s.createElement(Oe,null);case"FAILED":return s.createElement(De,null);case"UNKNOWN":return s.createElement(Pe,null);default:(0,ae.ZP)(e.last)}})(e.action.status)),e.action.successCount>1&&s.createElement("div",{className:_e},e.action.successCount," ",e.action.endpointType===Y.WN.EMAIL_SUBSCRIPTION?"emails sent":"succeeded"," "),e.action.errorCount>1&&s.createElement("div",{className:_e},e.action.errorCount," ",e.action.endpointType===Y.WN.EMAIL_SUBSCRIPTION?"emails failed":"failed"," ")))))};var Ze;!function(e){e[e.EVENT=0]="EVENT",e[e.SERVICE=1]="SERVICE",e[e.DATE=2]="DATE"}(Ze||(Ze={}));const He=(0,u.style)({cursor:"pointer"}),ze=e=>{switch(e.last){case"FAILED":return{color:"red",icon:s.createElement(L.ExclamationCircleIcon,null)};case"SENT":case"SUCCESS":return e.isDegraded?{color:"orange",icon:s.createElement(L.ExclamationTriangleIcon,null)}:{color:"green",icon:s.createElement(L.CheckCircleIcon,null)};case"PROCESSING":return{color:"grey",icon:s.createElement(L.InProgressIcon,null)};case"UNKNOWN":return{color:"grey",icon:s.createElement(L.UnknownIcon,null)};default:(0,ae.ZP)(e.last)}},qe=e=>{const t=s.useCallback(((t,n,a,l)=>{(0,e.onSort)(n,a)}),[e.onSort]),n=s.useMemo((()=>({[Ze.EVENT]:void 0,[Ze.SERVICE]:void 0,[Ze.DATE]:{sortBy:{direction:e.sortDirection,index:e.sortColumn},columnIndex:Ze.DATE,onSort:t}})),[e.sortColumn,e.sortDirection,t]),i=s.useMemo((()=>{const t=e.events;return e.loading?[...Array(10)].map(((e,t)=>s.createElement(Se.Tr,{key:`loading-row-${t}`},s.createElement(Se.Td,null,s.createElement(a.Skeleton,null)),s.createElement(Se.Td,null,s.createElement(a.Skeleton,null)),s.createElement(Se.Td,null,s.createElement(a.Skeleton,null)),s.createElement(Se.Td,null,s.createElement(a.Skeleton,null))))):t.map((t=>s.createElement(Se.Tr,{key:t.id},s.createElement(Se.Td,null,t.event),s.createElement(Se.Td,null,t.application," - ",t.bundle),s.createElement(Se.Td,null,t.actions.length>0?s.createElement(a.LabelGroup,null,t.actions.map((t=>s.createElement(a.Popover,{key:t.id,hasAutoWidth:!0,bodyContent:s.createElement($e,{action:t,getIntegrationRecipient:e.getIntegrationRecipient})},s.createElement(a.Label,{className:He,...ze(t.status)},g.ZP.integrations.types[t.endpointType].action))))):"No actions"),s.createElement(Se.Td,null,s.createElement(l.DateFormat,{type:"exact",date:t.date})))))}),[e.loading,e.events,e.getIntegrationRecipient]);return 0===i.length?s.createElement(ke.G,{variant:a.EmptyStateVariant.full,title:N.V.components.eventLog.table.notFound.title,description:N.V.components.eventLog.table.notFound.description}):s.createElement(Se.TableComposable,{isStickyHeader:!0},s.createElement(Se.Thead,null,s.createElement(Se.Tr,null,s.createElement(Se.Th,{sort:n[Ze.EVENT]},"Event type"),s.createElement(Se.Th,{sort:n[Ze.SERVICE]},"Service"),s.createElement(Se.Th,null,"Action taken ",s.createElement(Be,null,s.createElement(a.Button,{variant:a.ButtonVariant.plain},s.createElement(L.HelpIcon,null)))),s.createElement(Se.Th,{sort:n[Ze.DATE]},"Date and time"))),s.createElement(Se.Tbody,null,i))};var We=n(37655),Qe=n(69930);const Ye=()=>{const e=(0,o.getInsights)(),t=(0,o.getInsightsEnvironment)(e);return(0,g.Lk)(t)};var Ke,je=n(56437),Je=n(37869);!function(e){e.EVENT="event",e.BUNDLE="bundle",e.APPLICATION="application",e.ACTION_TYPE="endpointTypes",e.ACTION_STATUS="invocationResults"}(Ke||(Ke={}));const Xe=(e,t,n)=>!(!e||!t)&&(e===t||e.length===t.length&&e.every(((a,l)=>!!(n&&t.includes(a)||!n&&e[l]===t[l])))),et=e=>!!e.checkProps.checked,tt=e=>e.children?e.children.some((e=>tt(e))):et(e),nt=e=>e.children?e.children.every((e=>nt(e))):et(e),at=e=>{const{groups:t,placeholder:n,filters:l,updateFilters:i}=e,o=c().useMemo((()=>((e,t)=>{const n={};return e.forEach((e=>{var a;const l=t.find((t=>t.bundleId===e.name)),i=null===(a=null==l?void 0:l.chips)||void 0===a?void 0:a.map((e=>e.value)),o=e.children,r=0!==o.length&&o.every((e=>null==i?void 0:i.includes(e.name)));n[e.name]={id:e.name,name:e.displayName,checkProps:{checked:r||!!l&&null},children:0!==o.length?o.map((e=>({id:e.name,name:e.displayName,checkProps:{checked:r||(null==i?void 0:i.includes(e.name))}}))):void 0}})),n})(t,l)),[t,l]),[r,s]=c().useState(o),[u,d]=c().useState(!1),m=c().useMemo((()=>Object.values(r)),[r]),[p,E]=c().useMemo((()=>{const e=[];return[m.filter((e=>e.checkProps.checked||null===e.checkProps.checked)).map((t=>{var n,a;return e.push(t.id),{bundleId:t.id,category:t.name,chips:null!==(a=null===(n=t.children)||void 0===n?void 0:n.filter((e=>e.checkProps.checked)).map((e=>({name:e.name,value:e.id,isRead:!0}))))&&void 0!==a?a:[{name:t.name,value:t.id,isRead:!0}]}})),e]}),[m]);return c().useEffect((()=>{0!==t.length&&s((0,ge.ZP)((e=>0===Object.keys(e).length||0===l.length?o:void l.forEach((t=>{var n;const a=e[t.bundleId],l=t.chips.map((e=>e.value));null===(n=a.children)||void 0===n||n.forEach((e=>{e.checkProps.checked=l.includes(e.id)})),nt(a)?a.checkProps.checked=!0:tt(a)?a.checkProps.checked=null:a.checkProps.checked=!1})))))}),[t,l,o]),c().useEffect((()=>{i((0,ge.ZP)((e=>{if(0===e.length&&0===p.length)return e;if(0!==e.length&&0===p.length)return[];{const t=e.map((e=>e.bundleId));return Xe(t,E)&&p.every(((t,n)=>{if(e[n]&&t.bundleId===e[n].bundleId){const a=e[n].chips.map((e=>e.value)),l=t.chips.map((e=>e.value));return Xe(a,l,!0)}return!1}))?e:p}})))}),[p,E,i]),c().createElement(a.Dropdown,{toggle:c().createElement(a.DropdownToggle,{onToggle:()=>d(!u),toggleIndicator:L.AngleDownIcon},n),isOpen:u},c().createElement(a.TreeView,{data:m,hasChecks:!0,onCheck:(e,t,n)=>{((e,t,n)=>{const a=e.target.checked;s((0,ge.ZP)((e=>{var l;if(n){const l=e[n.id].children;null==l||l.some((e=>e.id===t.id&&(e.checkProps.checked=a,!0))),nt(e[n.id])?e[n.id].checkProps.checked=!0:tt(e[n.id])?e[n.id].checkProps.checked=null:e[n.id].checkProps.checked=a}else e[t.id].checkProps.checked=a,null===(l=e[t.id].children)||void 0===l||l.forEach((e=>e.checkProps.checked=a))})))})(e,t,n)}}))},lt={[je.k$.EMAIL_SUBSCRIPTION]:{name:"Email"},[je.k$.DRAWER]:{name:"Drawer"},[je.k$.INTEGRATION]:{name:"Integration"}},it=(0,u.style)({color:We.F.value}),ot=[{value:"true",chipValue:"Success",label:s.createElement("span",null,s.createElement(L.CheckCircleIcon,{color:"green"})," Success")},{value:"false",chipValue:"Sent",label:s.createElement("span",null,s.createElement(L.CheckCircleIcon,{color:"green"})," Sent")},{value:"false",chipValue:"Warning",label:s.createElement("span",null,s.createElement(L.ExclamationTriangleIcon,{className:it})," Warning ")},{value:"false",chipValue:"Processing",label:s.createElement("span",null,s.createElement(L.InProgressIcon,null)," Processing ")},{value:"false",chipValue:"Failure",label:s.createElement("span",null,s.createElement(L.ExclamationCircleIcon,{color:"red"})," Failure")}],rt=e=>{const t=Ye(),n=(0,Qe.N)(),i=s.useMemo((()=>t.map((e=>({value:e.toUpperCase(),chipValue:lt[e].name,label:lt[e].name}))).concat(n.map((e=>({value:e.toUpperCase(),chipValue:g.ZP.integrations.types[e].name,label:g.ZP.integrations.types[e].name}))))),[t,n]),r=s.useMemo((()=>({[Ke.EVENT]:{label:"Event",placeholder:"Filter by event"},[Ke.APPLICATION]:{label:"Application",placeholder:"Filter by application"},[Ke.ACTION_TYPE]:{label:"Action Type",placeholder:"Filter by action type",options:{exclusive:!1,items:i}},[Ke.ACTION_STATUS]:{label:"Action Status",placeholder:"Filter by action status",options:{exclusive:!1,items:ot}}})),[i]),u=((e,t,n,a,l)=>{const[i,r]=c().useState([]),s=(0,o.usePrimaryToolbarFilterConfig)(Ke,t,n,a,l),u=c().useMemo((()=>s.activeFiltersConfig.onDelete),[s.activeFiltersConfig.onDelete]),d=c().useCallback(((e,t)=>{const n=[],a=[];t.forEach((e=>{e.bundleId?a.push(e):n.push(e)})),u(e,n),0!==a.length&&r((0,ge.ZP)((e=>{const t=[];e.forEach(((e,n)=>{a.some((a=>{if(e.bundleId===a.bundleId){const l=a.chips.map((e=>e.value));return e.chips=e.chips.filter((e=>!l.includes(e.value))),0===e.chips.length&&t.push(n),!0}return!1}))})),t.forEach(((t,n)=>{e.splice(t-n,1)}))})))}),[u,r]),m=c().useCallback(((e,t)=>{var n,a;const l=(e,t,n)=>({bundleId:e,category:(null==t?void 0:t.displayName)||`${e} Loading...`,chips:(null==t?void 0:t.children)?0!==(null==n?void 0:n.length)?null==n?void 0:n.map((e=>({name:e.displayName,value:e.name,isRead:!0}))):[{name:t.displayName,value:t.name,isRead:!0}]:[{name:"Loading",value:e,isRead:!0}]}),i={};null===(n=e.application)||void 0===n||n.forEach((e=>{const t=e.split("."),n=t[0],a=t[1];i[n]?i[n].push(a):i[n]=[a]}));const o=Object.keys(i).map((e=>{var n;const a=null==t?void 0:t.find((t=>t.name===e)),o=null===(n=null==a?void 0:a.children)||void 0===n?void 0:n.filter((t=>i[e].includes(t.name)));return l(e,a,o)}));return((null===(a=e.bundle)||void 0===a?void 0:a.map((e=>{const n=null==t?void 0:t.find((t=>t.name===e));return l(e,n,null==n?void 0:n.children)})))||[]).concat(o)}),[]);c().useEffect((()=>{r(m(t,0!==e.length?e:void 0))}),[e,m]);const p=c().useMemo((()=>({label:"Application",type:"custom",filterValues:{children:c().createElement(at,{groups:e,placeholder:"Filter by Application",filters:i,updateFilters:r})}})),[e,i]),E=c().useMemo((()=>s.activeFiltersConfig.filters.filter((e=>e&&!e.bundleId)).concat(i)),[i,s.activeFiltersConfig.filters]),g=c().useMemo((()=>(0,ge.ZP)(t.bundle,(t=>{if(0===e.length)return;const n=[];return e.forEach((e=>{i.some((t=>{var n,a;return t.bundleId===e.name&&(0===(null===(n=e.children)||void 0===n?void 0:n.length)&&1===t.chips.length||(null===(a=e.children)||void 0===a?void 0:a.length)===t.chips.length)}))&&n.push(e.name)})),Xe(t,n,!0)?t:n}))),[e,t.bundle,i]),v=c().useMemo((()=>(0,ge.ZP)(t.application,(t=>{if(0===e.length)return;const n=[];return i.forEach((t=>{var a,l;const i=e.find((e=>e.name===t.bundleId)),o=null===(a=t.chips)||void 0===a?void 0:a.map((e=>e.value));o&&(null===(l=i.children)||void 0===l?void 0:l.some((e=>!o.includes(e.name))))&&o.forEach((e=>{const t=`${i.name}.${e}`;n.push(t)}))})),Xe(t,n,!0)?t:n}))),[e,t.application,i]);return n.bundle(g),n.application(v),(0,ge.ZP)(s,(e=>{e.filterConfig.items[1]=p,e.activeFiltersConfig.filters=E,e.activeFiltersConfig.onDelete=d}))})(e.bundleOptions,e.filters,e.setFilters,e.clearFilter,r),d=s.useCallback(((t,n)=>{(0,e.pageChanged)(n)}),[e.pageChanged]),m=s.useCallback(((t,n)=>{(0,e.perPageChanged)(n)}),[e.perPageChanged]),p=s.useMemo((()=>({itemCount:e.count,page:e.page,perPage:e.perPage,isCompact:!0,variant:a.PaginationVariant.top,onSetPage:d,onFirstClick:d,onPreviousClick:d,onNextClick:d,onLastClick:d,onPageInput:d,onPerPageSelect:m})),[e.count,e.page,e.perPage,d,m]),E=s.useMemo((()=>({...p,isCompact:!1,variant:a.PaginationVariant.bottom})),[p]);return s.createElement("div",{...(0,Je.k)("Notifications/EventLog/DualToolbar",e)},s.createElement(l.PrimaryToolbar,{...u,filterConfig:u.filterConfig,activeFiltersConfig:u.activeFiltersConfig,dedicatedAction:s.createElement(Te,{value:e.dateFilter,setValue:e.setDateFilter,retentionDays:e.retentionDays,setPeriod:e.setPeriod,period:e.period}),pagination:p}),e.children,s.createElement(l.PrimaryToolbar,{pagination:E}))};var st=n(43542);const ct=(0,u.style)({paddingTop:oe.S.value}),ut=(0,u.style)({marginLeft:st.p.value}),dt=e=>s.createElement(l.PageHeader,{className:"pf-u-pb-md"},s.createElement(a.Split,null,s.createElement(a.SplitItem,{isFilled:!0},s.createElement(l.PageHeaderTitle,{title:e.title}),s.createElement(a.TextContent,{className:ct},s.createElement(a.Text,null,e.subtitle))),e.action&&s.createElement(a.SplitItem,{className:ut},e.action)));var mt=n(2028),pt=n(77836);const Et=e=>({id:e.id,bundle:e.bundle,application:e.application,event:e.event_type,date:(0,o.fromUtc)(new Date(e.created)),actions:gt(vt(e.actions))}),gt=e=>e.sort(((e,t)=>e.endpointType.localeCompare(t.endpointType))),vt=e=>{const t={},n=[];return e.forEach((e=>{if(e.endpoint_id)if(t[e.endpoint_id]){const n=ht(e),a=t[e.endpoint_id];ft(n.status.last)?a.status.isDegraded=!0:a.status.last=n.status.last,a.errorCount+=n.errorCount,a.successCount+=n.successCount}else t[e.endpoint_id]=ht(e);else n.push(ht(e))})),[...Object.values(t),...n]},ht=e=>{var t;return{id:null!==(t=e.endpoint_id)&&void 0!==t?t:void 0,endpointType:(0,pt.LW)({type:e.endpoint_type,sub_type:e.endpoint_sub_type}),status:{last:e.status,isDegraded:ft(e.status)},successCount:ft(e.status)?0:1,errorCount:ft(e.status)?1:0}},ft=e=>"FAILED"===e,yt=(0,G.validationResponseTransformer)((e=>200===e.status?(0,G.validatedResponse)("Events",200,{...e.value,data:e.value.data.map(Et)},e.errors):e));var bt=n(45295);const Ct=e=>bt.B.EndpointResourceGetEndpoint.actionCreator({id:e});var Tt=n(33479),St=n(19013);const kt="yyyy-MM-dd",It=()=>{const e=(0,m.useFlag)("platform.notifications.overhaul"),t=(0,f.useParameterizedQuery)(Ct),{rbac:n}=(0,E.b)(),l=b(!0),i=s.useMemo((()=>{const e=l.payload;return 200===(null==e?void 0:e.status)?e.value:[]}),[l.payload]),[c,u]=s.useState(ie.LAST_14),d=((e=250)=>{const t=(0,s.useMemo)((()=>{const e=()=>(0,o.useUrlStateMultipleOptions)("application"),t=()=>(0,o.useUrlStateMultipleOptions)("bundle"),n=()=>(0,o.useUrlStateMultipleOptions)("endpointTypes"),a=()=>(0,o.useUrlStateMultipleOptions)("invocationResults"),l=()=>(0,o.useUrlStateString)("event");return i=>{switch(i){case Ke.APPLICATION:return e;case Ke.BUNDLE:return t;case Ke.EVENT:return l;case Ke.ACTION_TYPE:return n;case Ke.ACTION_STATUS:return a;default:(0,ae.ZP)(i)}}}),[]);return(0,o.useFilters)(Ke,e,t)})(),[p,v]=s.useState([void 0,void 0]),[h,C]=s.useState("desc"),[T,k]=s.useState(Ze.DATE),I=s.useCallback(((e,t)=>{C(t),k(e)}),[C,k]),w=((e,t,n)=>(0,s.useCallback)((a=>{const l=new o.Filter;if(null==a?void 0:a.bundle){const t=null==a?void 0:a.bundle,n=e.filter((e=>t.includes(e.name))).map((e=>e.id));l.and("bundleIds",o.Operator.EQUAL,n)}if(null==a?void 0:a.application){const t=a.application,n=[];t.forEach((t=>{var a;const l=t.split("."),i=l[0],o=l[1],r=e.find((e=>e.name===i));if(r){const e=null===(a=r.children)||void 0===a?void 0:a.find((e=>e.name===o));e&&n.push(e.id)}})),l.and("appIds",o.Operator.EQUAL,n)}(null==a?void 0:a.event)&&l.and("event",o.Operator.EQUAL,a.event),(null==a?void 0:a.invocationResults)&&l.and("invocationResults",o.Operator.EQUAL,a.invocationResults),(null==a?void 0:a.endpointTypes)&&l.and("endpointTypes",o.Operator.EQUAL,a.endpointTypes);let i=[void 0,void 0];const s=(0,o.toUtc)(new Date);switch(t){case ie.LAST_14:i=[(0,Tt.Z)((0,St.Z)(s),{days:14}),s];break;case ie.LAST_7:i=[(0,Tt.Z)((0,St.Z)(s),{days:7}),s];break;case ie.TODAY:i=[s,s];break;case ie.YESTERDAY:const e=(0,Tt.Z)((0,St.Z)(s),{days:1});i=[e,e];break;case ie.CUSTOM:i=n}return i[0]&&i[1]&&(l.and("start",o.Operator.EQUAL,(0,r.Z)(i[0],kt)),l.and("end",o.Operator.EQUAL,(0,r.Z)(i[1],kt))),l}),[e,t,n]))(i,c,p),A=s.useMemo((()=>{const e=h.toUpperCase();let t;if(T!==Ze.DATE)throw new Error(`Invalid sorting index: ${T}`);return t="created",o.Sort.by("created",e)}),[T,h]),L=(0,mt.q)(g.ZP.paging.defaultPerPage,w,d.filters,A),D=(e=>{const t=(null!=e?e:o.Page.defaultPage()).toQuery();return(0,o.useTransformQueryResponse)((0,f.useQuery)(y.B.EventResourceGetEvents.actionCreator({limit:+t.limit,offset:+t.offset,bundleIds:t.filterBundleIds,appIds:t.filterAppIds,invocationResults:t.filterInvocationResults,endpointTypes:t.filterEndpointTypes,startDate:t.filterStart,endDate:t.filterEnd,eventTypeDisplayName:t.filterEvent,sortBy:`${t.sortColumn}:${t.sortDirection}`,includeActions:!0})),yt)})(L.page),P=s.useMemo((()=>{var e;return 200===(null===(e=D.payload)||void 0===e?void 0:e.status)?{data:D.payload.value.data,count:D.payload.value.meta.count}:{data:[],count:0}}),[D]),O=s.useMemo((()=>{const e=d.filters.bundle;return e&&e.length>0?Ul.notifications(e[0]):Ul.notifications("")}),[d.filters]),F=s.useCallback((async e=>{var n;const a=t.query,l=await a(e);if("Endpoint"===(null===(n=l.payload)||void 0===n?void 0:n.type)){const e=l.payload.value.type;switch(e){case"camel":case"webhook":case"ansible":return l.payload.value.name;case"email_subscription":case"drawer":return l.payload.value.properties.only_admins?"Users: Admin":"Users: All";default:(0,ae.ZP)(e)}}return"Error while loading"}),[t.query]);return s.createElement(s.Fragment,null,s.createElement(dt,{title:N.V.pages.notifications.eventLog.title,subtitle:N.V.pages.notifications.eventLog.subtitle,action:!e&&s.createElement(le,{isDisabled:!n.canReadEvents,to:O,variant:a.ButtonVariant.secondary},N.V.pages.notifications.eventLog.viewNotifications)}),s.createElement(S,null,s.createElement(rt,{...d,bundleOptions:i,dateFilter:c,setDateFilter:u,count:P.count,perPageChanged:L.changeItemsPerPage,pageChanged:L.changePage,perPage:L.page.size,page:L.page.index,pageCount:P.data.length,retentionDays:14,period:p,setPeriod:v},s.createElement(qe,{events:P.data,loading:D.loading,onSort:I,sortColumn:T,sortDirection:h,getIntegrationRecipient:F}))))},Nt=()=>{const e=(0,l.useOuia)({type:"AppSkeleton"});return s.createElement("div",{...e},s.createElement(l.PageHeader,null,s.createElement("div",{className:"pf-c-content"},s.createElement(l.PageHeaderTitle,{title:s.createElement(l.Skeleton,{size:"sm"})}))),s.createElement(S,null,s.createElement(l.Section,null,s.createElement(a.Bullseye,null,s.createElement(l.Spinner,{centered:!0})))))},wt=e=>y.B.NotificationResourceGetApplicationsFacets.actionCreator({bundleName:e}),At=()=>(0,f.useParameterizedQuery)(wt);var Lt=n(28551),Dt=n(64799);const Pt=(0,u.style)({backgroundColor:Dt.C.var}),Ot=(0,u.style)({paddingLeft:Lt.J.value}),Ft=e=>{const[t,n]=c().useState(0),l=c().useCallback((e=>{n(e)}),[]);return c().createElement("div",{className:Pt},c().createElement(a.Tabs,{className:Ot,defaultActiveKey:t,role:"region",onClick:l},e.children))};var xt=n(78343),Rt=n(65326);const Gt=e=>y.B.OrgConfigResourceSaveDailyDigestTimePreference.actionCreator({body:e.body});var Bt=n(21503);const Mt=(0,u.style)({width:"280px"}),Ut=(0,u.style)({paddingLeft:Lt.J.value}),Vt=()=>{var e,t;const[n,l]=c().useState(!1),[i,o]=c().useState(),r=(0,f.useQuery)(y.B.OrgConfigResourceGetDailyDigestTimePreference.actionCreator()),u=(0,f.useMutation)(Gt),{addSuccessNotification:d,addDangerNotification:m}=(0,Bt.l)(),p=(0,s.useMemo)((()=>{var e;if(200===r.status)return null===(e=r.payload)||void 0===e?void 0:e.value}),[null===(e=r.payload)||void 0===e?void 0:e.value,r.status]);(0,s.useEffect)((()=>{p&&(o({baseCustomTime:p,utcTime:p,timezoneText:void 0}),l("00:00:00"!==p))}),[p]);const E=c().useCallback((()=>{l(!1),o({utcTime:"00:00",baseCustomTime:"00:00",timezoneText:void 0})}),[]),[g,v]=c().useState(!1),h=Rt.map((e=>c().createElement(a.DropdownItem,{key:e.text},e.text))),b=c().useCallback((()=>{l(!0)}),[]),C=c().useCallback((e=>{o({baseCustomTime:e,utcTime:e,timezoneText:void 0})}),[]),T=c().useCallback((e=>{if(null==e?void 0:e.target){const t=e.target.textContent,n=Rt.find((e=>e.text===t));n&&o((e=>{if(null==e?void 0:e.baseCustomTime){const t=e.baseCustomTime.split(":").map((e=>parseInt(e))),a=new Date;a.setUTCHours(t[0],t[1]);const l=(0,xt.Z)(a,-n.offset),i=l.getUTCHours().toString().padStart(2,"0"),o=l.getUTCMinutes().toString().padStart(2,"0");return{...e,utcTime:`${i}:${o}`,timezoneText:n.text}}return e}))}v(!1)}),[]),S=c().useCallback((()=>{i&&(0,u.mutate)({body:i.utcTime}).then((e=>{204===e.status?d("Action settings saved",""):m("Failed to save action settings","")}))}),[m,d,u.mutate,i]),k=u.loading||r.loading;return c().createElement(c().Fragment,null,c().createElement(c().Fragment,null,c().createElement(a.Card,null,c().createElement(a.CardBody,null,c().createElement(a.Stack,{hasGutter:!0},c().createElement(a.StackItem,null,c().createElement(a.Title,{headingLevel:"h2"},"Action settings")),c().createElement(a.StackItem,null,c().createElement(a.Text,{component:a.TextVariants.p},"Daily digest email receipt"),c().createElement(a.HelperText,null,c().createElement(a.HelperTextItem,{variant:"indeterminate"},"Schedule the time at which to send your account's daily digest email. All times will be converted to UTC after saving.")))),c().createElement("br",null),c().createElement(a.Split,null,c().createElement(a.SplitItem,{isFilled:!0},c().createElement(a.Stack,{hasGutter:!0},c().createElement(a.StackItem,null,r.loading?c().createElement(a.Skeleton,null):c().createElement(a.Radio,{isChecked:!n,onChange:E,id:"settings-time-config",label:"Default time",value:"Default",description:"00:00 UTC",name:"radio-select"})),c().createElement(a.StackItem,null,r.loading?c().createElement(a.Skeleton,null):c().createElement(a.Radio,{isChecked:n,onChange:b,id:"settings-time-config-custom",label:"Custom time",name:"radio-select"})),n&&c().createElement(c().Fragment,null,c().createElement(a.StackItem,{className:Ut},c().createElement(a.Text,{component:a.TextVariants.h6},"Time"),c().createElement(a.TimePicker,{onChange:C,time:null==i?void 0:i.baseCustomTime,width:"263px",stepMinutes:15,placeholder:"00:00",is24Hour:!0})),c().createElement(a.StackItem,{className:Ut},c().createElement(a.Text,{component:a.TextVariants.h6},"Time zone"),c().createElement(a.Dropdown,{className:Mt,toggle:c().createElement(a.DropdownToggle,{isOpen:g,id:"timezone",onToggle:()=>v(!g)},null!==(t=null==i?void 0:i.timezoneText)&&void 0!==t?t:"(UTC-00:00) Universal Time"),isOpen:g,onSelect:T,menuAppendTo:()=>document.body,dropdownItems:h}))))))),c().createElement(a.CardFooter,null,c().createElement(a.Button,{variant:"primary",type:"submit",isLoading:k,isDisabled:k,onClick:S},k?"Loading":"Save")))))};var _t,$t=n(77125),Zt=n(96191);!function(e){e.ASC="asc",e.DESC="desc"}(_t||(_t={}));const Ht=Object.freeze([]),zt=Object.freeze({}),qt=()=>c().createElement(a.EmptyState,{variant:"full"},c().createElement(a.EmptyStateIcon,{className:"pf-u-mb-xl",icon:L.SearchIcon}),c().createElement(a.Title,{headingLevel:"h2",size:"lg"},"No results found"),c().createElement(a.EmptyStateBody,null,c().createElement(a.TextContent,null,c().createElement(a.Text,null,"No notifications match your filter choices above. Try removing or changing the filters to see results."))));var Wt=n(98133),Qt=n(53426);const Yt=e=>{return t=e,"id",e=>e.id===t;var t},Kt=(0,u.style)({color:Me.D.value}),jt=(0,u.style)({textAlign:"left"}),Jt=(0,u.style)({marginRight:oe.S.value}),Xt=(0,u.style)({marginRight:Wt.Q.value}),en=()=>s.createElement("span",null,", "),tn=e=>{const t=s.useCallback((()=>{const t=e.onSelect;t&&t(e.notification,e.behaviorGroup,!1)}),[e.onSelect,e.behaviorGroup,e.notification]);return s.createElement(a.Chip,{onClick:t,isReadOnly:e.behaviorGroup.isDefault},e.behaviorGroup.displayName)},nn=e=>{const[t,n]=s.useState(!1),l=s.useCallback((t=>{var n,a,l;const i=null!==(l=null===(a=null===(n=null==t?void 0:t.currentTarget)||void 0===n?void 0:n.firstChild)||void 0===a?void 0:a.dataset)&&void 0!==l?l:zt,o=e.onSelect;if(!e.behaviorGroupContent.isLoading&&!e.behaviorGroupContent.hasError&&o&&i.behaviorGroupId){const t=e.behaviorGroupContent.content.find(Yt(i.behaviorGroupId));if(t){const n=!!e.selected.find(Yt(t.id));o(e.notification,t,!n)}}}),[e.onSelect,e.behaviorGroupContent,e.notification,e.selected]),i=s.useMemo((()=>e.behaviorGroupContent.isLoading||e.behaviorGroupContent.hasError?[s.createElement(a.OptionsMenuItem,{key:"is-loading",isDisabled:!0},"Loading")]:0===e.behaviorGroupContent.content.length?[s.createElement(a.OptionsMenuItem,{key:"empty",isDisabled:!0},s.createElement("span",{className:jt},"You have no behavior groups. ",s.createElement("br",null),"Create a new group by clicking on the ",s.createElement("br",null),"'Create new group' button above."))]:[...e.selected.filter((e=>e.isDefault)),...e.behaviorGroupContent.content.filter((e=>!e.isDefault))].map((t=>{const n=!!e.selected.find(Yt(t.id));return s.createElement(a.OptionsMenuItem,{key:t.id,onSelect:l,"data-behavior-group-id":t.id,isSelected:n,isDisabled:t.isDefault},t.isDefault&&s.createElement(L.LockIcon,{className:Jt})," ",t.displayName)}))),[e.behaviorGroupContent,e.selected,l]),r=s.useMemo((()=>[...e.selected.filter((e=>e.isDefault)),...e.selected.filter((e=>!e.isDefault))]),[e.selected]),c=s.useMemo((()=>s.createElement(a.OptionsMenuToggle,{onToggle:n,toggleTemplate:0===r.length?s.createElement("span",{className:Kt},"Select behavior group"):s.createElement(a.ChipGroup,null,r.map((t=>s.createElement(tn,{key:t.id,behaviorGroup:t,notification:e.notification,onSelect:e.onSelect}))))})),[r,e.notification,e.onSelect]),u=s.useMemo((()=>0===r.length?s.createElement(a.Split,null,s.createElement(a.SplitItem,{className:Jt},s.createElement(L.BellSlashIcon,{color:Qt.O.value})),s.createElement(a.SplitItem,null,"Mute")):(0,o.join)(r.map((e=>s.createElement(s.Fragment,{key:e.id},e.isDefault&&s.createElement(a.Tooltip,{content:`${e.displayName} behavior is attached to this event and cannot be changed.\n                Add additional behavior groups to assign different actions or recipients.`},s.createElement(L.LockIcon,{color:Qt.O.value,className:Xt}))," ",e.displayName))),en)),[r]);return e.isEditMode?s.createElement(a.OptionsMenu,{id:e.id,direction:"down",menuItems:i,toggle:c,isOpen:t,menuAppendTo:document.body}):s.createElement(Se.TableText,{wrapModifier:"truncate"}," ",u," ")};var an;!function(e){e[e.EVENT=0]="EVENT",e[e.APPLICATION=1]="APPLICATION",e[e.BEHAVIOR=2]="BEHAVIOR"}(an||(an={}));const ln=(0,u.style)({float:"right"}),on=()=>s.createElement(s.Fragment,null),rn=(e,t)=>{const n="done"!==e.loadingActionStatus;return e.isEditMode?{actionsToggle:on,items:[{key:"done",className:ln,title:s.createElement(a.Button,{"aria-label":"done",variant:a.ButtonVariant.plain,isDisabled:n},s.createElement(L.CheckIcon,{color:n?Zt.J.value:se.h.value})),isOutsideDropdown:!0,onClick:()=>null==t?void 0:t.onFinishEditing(e.id),isDisabled:n||!t},{key:"cancel",className:ln,title:s.createElement(a.Button,{"aria-label":"cancel",variant:a.ButtonVariant.plain,isDisabled:n},s.createElement(L.CloseIcon,{color:n?Zt.J.value:re.p.value})),isOutsideDropdown:!0,onClick:()=>null==t?void 0:t.onCancelEditing(e.id),isDisabled:n||!t}]}:{actionsToggle:on,items:[{key:"edit",className:ln,title:s.createElement(a.Button,{"aria-label":"edit",variant:a.ButtonVariant.plain,isDisabled:n},s.createElement(L.PencilAltIcon,null)),isOutsideDropdown:!0,onClick:()=>null==t?void 0:t.onStartEditing(e.id),isDisabled:n||!t}]}},sn=((e,t)=>{var n;const a=t=>s.createElement("div",{...(0,Je.k)("Notifications/Table",t)},s.createElement(e,{...t}));return a.displayName=`Ouia(${null!==(n=e.displayName)&&void 0!==n?n:e.name})`,a})((e=>{const t=s.useMemo((()=>{if(e.onStartEditing&&e.onFinishEditing&&e.onCancelEditing)return{onStartEditing:e.onStartEditing,onFinishEditing:e.onFinishEditing,onCancelEditing:e.onCancelEditing,onBehaviorGroupLinkUpdated:e.onBehaviorGroupLinkUpdated}}),[e.onStartEditing,e.onFinishEditing,e.onCancelEditing,e.onBehaviorGroupLinkUpdated]),n=s.useCallback(((t,n,a,l)=>{(0,e.onSort)(n,(e=>{switch(e.toLowerCase()){case _t.ASC:return _t.ASC;case _t.DESC:return _t.DESC;default:throw new Error(`Invalid sort direction ${e}`)}})(a))}),[e.onSort]),l=s.useMemo((()=>{const t={direction:e.sortDirection,index:e.sortBy};return{[an.EVENT]:{sortBy:t,columnIndex:an.EVENT,onSort:n},[an.APPLICATION]:{sortBy:t,columnIndex:an.APPLICATION,onSort:n},[an.BEHAVIOR]:void 0}}),[e.sortDirection,e.sortBy,n]),i=s.useMemo((()=>{const n=e.notifications,l=e.behaviorGroupContent;return n.map((e=>{var n;return s.createElement(Se.Tr,{key:e.id},s.createElement(Se.Td,null,e.eventTypeDisplayName),s.createElement(Se.Td,null,e.applicationDisplayName),s.createElement(Se.Td,null,"loading"===e.loadingActionStatus?s.createElement(a.Skeleton,{width:"90%"}):s.createElement(nn,{id:`behavior-group-cell-${e.id}`,notification:e,behaviorGroupContent:l,selected:null!==(n=e.behaviors)&&void 0!==n?n:Ht,onSelect:null==t?void 0:t.onBehaviorGroupLinkUpdated,isEditMode:e.isEditMode})),s.createElement(Se.Td,{actions:rn(e,t)}))}))}),[e.notifications,e.behaviorGroupContent,t]);return s.createElement(Se.TableComposable,{"aria-label":"Notifications",isStickyHeader:!0,variant:Se.TableVariant.compact,id:"configure-events-table"},s.createElement(Se.Thead,null,s.createElement(Se.Tr,null,s.createElement(Se.Th,{sort:l[an.EVENT]},"Event"),s.createElement(Se.Th,{sort:l[an.APPLICATION]},"Application"),s.createElement(Se.Th,{sort:l[an.BEHAVIOR],width:35},"Behavior"),s.createElement(Se.Th,null))),s.createElement(Se.Tbody,null,0===e.notifications.length?s.createElement(qt,null):i))}));var cn,un,dn=n(55490),mn=n(58399);!function(e){e.NAME="name",e.APPLICATION="application",e.ACTION="action"}(cn||(cn={})),function(e){e[e.NONE=0]="NONE",e[e.PAGE=1]="PAGE",e[e.ALL=2]="ALL"}(un||(un={}));const pn=[cn.NAME,cn.APPLICATION,cn.ACTION],En=e=>{var t;const n=(0,o.getInsights)(),i=null!==(t=e.filterColumns)&&void 0!==t?t:pn,r=(0,s.useMemo)((()=>{const t=e.appFilterOptions.map((e=>({value:e.displayName,label:s.createElement(s.Fragment,null," ",e.displayName)})));return{[cn.NAME]:i.includes(cn.NAME)?{label:"Event type",placeholder:"Filter by event type"}:void 0,[cn.APPLICATION]:i.includes(cn.APPLICATION)?{label:"Application",placeholder:"Filter by application",options:{exclusive:!1,default:[],items:t}}:void 0,[cn.ACTION]:i.includes(cn.ACTION)&&(0,mn.Zg)(n)?{label:"Action",placeholder:"Filter by action"}:void 0}}),[e.appFilterOptions,n,i]),c=s.useMemo((()=>{var t;const n=e.onSelectionChanged,a=e.count,l=e.pageAdapter,i=e.selectedCount,o=l.page.size;if(!n)return;const r=()=>n(un.ALL),s=()=>n(un.NONE);return{count:null!=i?i:0,items:[{title:"Select none (0)",onClick:s},{title:`Select page (${null!==(t=e.pageCount)&&void 0!==t?t:o})`,onClick:()=>n(un.PAGE)},{title:`Select all (${a})`,onClick:r}],checked:0!==i&&i===a,onSelect:e=>e?r():s(),isDisabled:e.bulkSelectionDisabled}}),[e.onSelectionChanged,e.selectedCount,e.pageAdapter,e.count,e.bulkSelectionDisabled,e.pageCount]),u=(0,o.usePrimaryToolbarFilterConfig)(cn,e.filters,e.setFilters,e.clearFilter,r),d=(0,dn.B)(e.onExport),m=u.filterConfig,p=u.activeFiltersConfig,E=(0,o.useInsightsEnvironmentFlag)((0,o.getInsights)(),mn._n,void 0,(0,s.useCallback)((()=>d),[d])),g=s.useCallback(((t,n)=>{(0,e.pageAdapter.changePage)(n)}),[e.pageAdapter]),v=s.useCallback(((t,n)=>{(0,e.pageAdapter.changeItemsPerPage)(n)}),[e.pageAdapter]),h=s.useMemo((()=>({itemCount:e.count,page:e.pageAdapter.page.index,perPage:e.pageAdapter.page.size,isCompact:!0,variant:a.PaginationVariant.top,onSetPage:g,onFirstClick:g,onPreviousClick:g,onNextClick:g,onLastClick:g,onPageInput:g,onPerPageSelect:v})),[e.count,e.pageAdapter,g,v]),f=s.useMemo((()=>({...h,isCompact:!1,variant:a.PaginationVariant.bottom})),[h]);return s.createElement("div",{...(0,Je.k)("Notifications/DualToolbar",e)},s.createElement(l.PrimaryToolbar,{bulkSelect:c,filterConfig:m,activeFiltersConfig:p,exportConfig:E,pagination:h}),e.children,s.createElement(l.PrimaryToolbar,{pagination:f}))},gn=(e,t,n)=>{const a=((e,t,n=250)=>{const a=(0,s.useMemo)((()=>{const n=e=>(0,o.useUrlStateString)("name",e),a=t=>(0,o.useUrlStateMultipleOptions)("app",e,t),l=e=>(0,o.useUrlStateString)("action",e);return e=>{switch(e){case cn.NAME:return t?n:s.useState;case cn.ACTION:return t?l:s.useState;case cn.APPLICATION:return t?a:s.useState;default:(0,ae.vE)(e)}}}),[]);return(0,o.useFilters)(cn,n,a)})(t.map((e=>e.displayName.toString())),n),l=((e,t)=>(0,s.useCallback)((n=>{const a=new o.Filter,l=n&&n[cn.APPLICATION];if(l){const e=[];for(const n of(0,o.arrayValue)(l)){const a=t.find((e=>e.displayName===n));a&&e.push(a.id)}a.and("applicationId",o.Operator.EQUAL,e)}a.and("bundleId",o.Operator.EQUAL,e.id);const i=n&&n[cn.NAME];if(i){const e=(0,o.stringValue)(i);a.and("eventFilterName",o.Operator.EQUAL,e)}return a}),[e,t]))(e,t),[i,r]=s.useState({sortDirection:_t.ASC,sortBy:an.APPLICATION}),c=s.useCallback(((e,t)=>{r({sortBy:e,sortDirection:t})}),[r]),u=s.useMemo((()=>{const e=i.sortDirection.toUpperCase();let t;switch(i.sortBy){case an.APPLICATION:t="application";break;case an.EVENT:t="display_name";break;default:throw new Error(`Invalid sorting index: ${i.sortBy}`)}return o.Sort.by(t,e)}),[i]);return{pageController:(0,mt.q)(g.ZP.paging.defaultPerPage,l,a.filters,u),onSort:c,sortBy:i.sortBy,sortDirection:i.sortDirection,filters:a.filters,setFilters:a.setFilters,clearFilters:a.clearFilter}};var vn=n(36219),hn=n(49836),fn=n(15173),yn=n(36853);const bn=n.p+"fonts/WebhookIcon.svg",Cn=(0,u.style)({verticalAlign:"-0.125em",width:"1em",height:"1em"}),Tn=()=>s.createElement("img",{alt:"Webhook",className:Cn,src:bn}),Sn=(0,u.style)({marginLeft:oe.S.var}),kn=(0,u.style)({color:"#888"}),In=e=>{switch(e.actionType){case je.k$.DRAWER:return s.createElement(yn.ZP,null);case je.k$.EMAIL_SUBSCRIPTION:return s.createElement(L.EnvelopeIcon,null);case je.k$.INTEGRATION:return s.createElement(Tn,null);default:(0,ae.vE)(e.actionType)}},Nn=e=>s.createElement("div",{...(0,Je.k)("Notifications/ActionComponent",e)},e.children),wn=e=>e.loading?s.createElement(Nn,{...e},s.createElement(a.Spinner,{size:"md"})):e.hasError?s.createElement(Nn,{...e},s.createElement("span",null,"Error loading actions")):e.action?s.createElement(Nn,{...e},s.createElement(In,{actionType:e.action.type}),s.createElement("span",{className:Sn},g.ZP.notifications.types[e.action.type].name),e.action.type===je.k$.INTEGRATION&&s.createElement("span",null,": ",g.ZP.integrations.types[e.action.integration.type].name)):s.createElement(Nn,{...e},s.createElement("span",{className:kn},s.createElement("div",null,"No actions."),s.createElement("div",null,"Users will not be notified.")));var An=n(69696),Ln=n(13986);const Dn=(0,u.style)({color:Ln.C.value}),Pn=e=>{const t="User Access group (Not found)";return s.createElement(a.Tooltip,{content:"This User Access group was not found, and may have been deleted. Remove it from your behavior group to stop seeing it."},e.onClose?s.createElement(a.Label,{variant:"outline",color:"red",onClose:e.onClose},t):s.createElement("span",{className:Dn}," ",t," "))},On=(0,u.style)({marginLeft:oe.S.var,color:Zt.J.value}),Fn=(0,u.style)({color:Zt.J.value}),xn=()=>s.createElement("span",null,", "),Rn=e=>{if(e.action.type===je.k$.INTEGRATION)return s.createElement(s.Fragment,null,e.action.integration.isEnabled?e.action.integration.name:s.createElement("span",{className:Fn}," ",e.action.integration.name,s.createElement(a.Tooltip,{content:"This integration has been disabled. This action wil not fire until it is enabled.",position:"bottom"},s.createElement(L.BanIcon,{className:On}))));const t=e.action.recipient.filter((e=>e instanceof An.dt)),n=e.action.recipient.filter((e=>e instanceof An.nc));return s.createElement("span",null,t.length>0&&s.createElement("div",null,"Users: ",(0,o.join)(t.map((e=>s.createElement(s.Fragment,null,e.displayName,e.ignorePreferences&&s.createElement("span",null,s.createElement(a.Tooltip,{content:"You may still receive forced notifications for this service",position:"bottom"},s.createElement(L.LockIcon,{className:On})))," "))),xn)),n.length>0&&s.createElement("div",null,"User Access Groups: ",(0,o.join)(n.map((e=>e.hasError?s.createElement(Pn,null):e.isLoading?s.createElement(a.Skeleton,{width:"40px"}):e.displayName)),xn)))},Gn=(0,u.style)({fontSize:fn.U.value}),Bn=e=>s.createElement(a.Grid,null,s.createElement(a.GridItem,{span:6},s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h6,className:Gn},"Action"))),s.createElement(a.GridItem,{span:6},s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h6,className:Gn},"Recipient"))),e.children),Mn=e=>s.createElement(Bn,null,e.actions.map(((e,t)=>s.createElement(s.Fragment,{key:`${t}-${e.type}`},s.createElement(a.GridItem,{span:6},s.createElement(wn,{action:e})),s.createElement(a.GridItem,{className:"pf-u-text-break-word",span:6},s.createElement(Rn,{action:e})))))),Un=()=>{const e="150px";return s.createElement(Bn,null,[...Array(3).values()].map(((t,n)=>s.createElement(s.Fragment,{key:`skeleton-${n}`},s.createElement(a.GridItem,{span:6},s.createElement(a.Skeleton,{width:e})),s.createElement(a.GridItem,{span:6},s.createElement(a.Skeleton,{width:e}))))))},Vn=e=>e.actions?s.createElement(Mn,{actions:e.actions}):s.createElement(Un,null),_n=(0,u.style)({width:450,height:"100%"}),$n=(0,u.style)({marginRight:oe.S.value}),Zn=e=>{const[t,n]=s.useState(!1),l=s.useCallback((()=>n((e=>!e))),[n]);return s.createElement(a.Card,{isFlat:!0,className:_n},s.createElement(a.CardHeader,null,s.createElement(a.CardHeaderMain,null,s.createElement(a.Split,null,s.createElement(a.SplitItem,null,e.isDefaultBehavior&&s.createElement(a.Tooltip,{position:"top",appendTo:()=>document.body,content:s.createElement("div",null,"System required behavior group",s.createElement("br",null),s.createElement("br",null),"This group is system generated and can not be edited, deleted, or removed from being applied to an event")},s.createElement(L.LockIcon,{className:$n}))),s.createElement(a.SplitItem,null,s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h4}," ",e.title," "))))),s.createElement(a.CardActions,null,!e.isDefaultBehavior&&s.createElement(a.Dropdown,{onSelect:l,toggle:s.createElement(a.KebabToggle,{onToggle:n,isDisabled:!e.dropdownItems}),isOpen:t,isPlain:!0,dropdownItems:e.dropdownItems,position:a.DropdownPosition.right,menuAppendTo:()=>document.body}))),s.createElement(a.CardBody,null,e.children))},Hn=e=>{const t=s.useCallback((()=>{const t=e.onEdit;t&&t(e.behaviorGroup)}),[e.behaviorGroup,e.onEdit]),n=s.useCallback((()=>{const t=e.onDelete;t&&t(e.behaviorGroup)}),[e.behaviorGroup,e.onDelete]),l=s.useMemo((()=>[s.createElement(a.DropdownItem,{key:"on-edit",onClick:t,isDisabled:!t}," Edit "),s.createElement(a.DropdownItem,{key:"on-delete",onClick:n,isDisabled:!n}," Delete ")]),[t,n]);return s.createElement(Zn,{title:e.behaviorGroup.displayName,dropdownItems:l,isDefaultBehavior:e.behaviorGroup.isDefault},s.createElement(Vn,{actions:e.behaviorGroup.actions}))},zn=()=>s.createElement(Zn,{title:s.createElement(a.Skeleton,{width:"300px"})},s.createElement(Vn,null)),qn=e=>e.behaviorGroup?s.createElement(Hn,{...e,behaviorGroup:e.behaviorGroup}):s.createElement(zn,null),Wn=(0,u.style)({overflow:"auto"}),Qn=(0,u.style)({paddingBottom:hn._.var}),Yn=e=>s.createElement("div",{"data-testid":"ref-card-list-container"},s.createElement(a.Flex,{alignItems:{default:"alignItemsStretch"},alignContent:{default:"alignContentSpaceBetween"},flexWrap:{default:"nowrap"},className:Wn,"data-testid":"card-list-container"},e.children)),Kn=e=>s.createElement(Yn,null,e.behaviorGroups.map((t=>s.createElement(a.FlexItem,{key:t.id,className:Qn},s.createElement(qn,{behaviorGroup:t,onEdit:e.onEdit,onDelete:e.onDelete}))))),jn=()=>s.createElement(Yn,null,[...Array(3).values()].map(((e,t)=>s.createElement(a.FlexItem,{key:`behavior-group-card-skeleton-${t}`,className:Qn},s.createElement(qn,null))))),Jn=e=>e.behaviorGroups?s.createElement(Kn,{...e,behaviorGroups:e.behaviorGroups}):s.createElement(jn,null);var Xn=n(52857),ea=n(45871),ta=n(92534);const na=(0,u.style)({marginTop:"auto",marginBottom:14}),aa=(0,u.style)({marginRight:5}),la=e=>{var t;const n=s.useContext(a.WizardContext);return s.createElement(a.WizardFooter,null,s.createElement(a.Button,{variant:a.ButtonVariant.primary,type:"submit",onClick:()=>{e.onNext(n.onNext)},isDisabled:e.isLoading||!n.activeStep.enableNext},null!==(t=n.activeStep.nextButtonText)&&void 0!==t?t:"Next"),!n.activeStep.hideBackButton&&s.createElement(a.Button,{variant:a.ButtonVariant.secondary,onClick:()=>{e.onBack(n.onBack)},isDisabled:0===n.activeStep.id||e.isLoading},"Back"),!n.activeStep.hideCancelButton&&s.createElement(a.Button,{variant:a.ButtonVariant.link,onClick:n.onClose,isDisabled:e.isLoading},"Cancel"),e.isLoading?s.createElement("div",{className:na},s.createElement(a.Spinner,{size:"md"})):e.error&&s.createElement(a.Split,null,s.createElement(a.SplitItem,null,s.createElement(L.ExclamationCircleIcon,{className:aa,color:Ne.Q.value})),s.createElement(a.SplitItem,null,e.error)))},ia=e=>{const{values:t}=(0,ta.useFormikContext)(),n=(t.id?"Edit":"Create")+" behavior group";return s.createElement(ta.Form,null,s.createElement(a.Wizard,{title:n,steps:e.steps,footer:s.createElement(la,{isLoading:e.loading,onNext:e.onNext,onBack:e.onBack}),isOpen:!0,startAtStep:1,onGoToStep:t=>{var n;return e.onGoToStep(null!==(n=t.id)&&void 0!==n?n:1)},onClose:e.onClose,onSave:e.onSave}))},oa=(0,s.createContext)({getIntegrations:async()=>{throw new Error("No IntegrationContext found")},getNotificationRecipients:async()=>{throw new Error("No RecipientContext found")}}),ra=()=>(0,s.useContext)(oa),sa=oa.Provider;var ca,ua=n(45093),da=n(81952),ma=n(21551);!function(e){e[e.CREATE=0]="CREATE",e[e.UPDATE=1]="UPDATE"}(ca||(ca={}));var pa=n(37176);class Ea{constructor(e){this.recipient=e}compareTo(e){return e instanceof Ea&&this.recipient.equals(e.recipient)}toString(){return this.recipient.displayName}}const ga=(e,t,n,l)=>n?l?l():[s.createElement(a.SelectOption,{key:"loading-option",isNoResultsOption:!0},s.createElement(a.Skeleton,{width:"100%"}))]:t(e),va=(e,t,n)=>s.useMemo((()=>"default"===e.show?ga(e.defaultValues,t,e.loadingDefault,n):"filter"===e.show?ga(e.filterValues,t,e.loadingFilter,n):void(0,ae.ZP)(e.show)),[e,t,n]);var ha,fa=n(62554);!function(e){e[e.LOAD_FILTER_VALUE=0]="LOAD_FILTER_VALUE",e[e.SET_FILTER_VALUE=1]="SET_FILTER_VALUE",e[e.USE_DEFAULTS=2]="USE_DEFAULTS",e[e.SET_DEFAULTS=3]="SET_DEFAULTS"}(ha||(ha={}));const ya=(e,t)=>(0,ge.ZP)(e,(n=>{switch(t.type){case ha.SET_FILTER_VALUE:t.search===e.lastSearch&&t.values!==n.filterValues&&(n.loadingFilter=!1,n.filterValues=(0,ge.cA)(t.values));break;case ha.LOAD_FILTER_VALUE:t.search===n.lastSearch&&"filter"===n.show||(n.loadingFilter=!0,n.filterValues=[],n.lastSearch=t.search,n.show="filter");break;case ha.USE_DEFAULTS:"default"!==n.show&&(n.show="default");break;case ha.SET_DEFAULTS:n.defaultValues=(0,ge.cA)(t.values),n.loadingDefault=!1;break;default:(0,ae.ZP)(t)}})),ba=()=>{const[e,t]=(0,s.useReducer)(ya,{filterValues:[],defaultValues:[],show:"default",loadingFilter:!1,loadingDefault:!0,lastSearch:""}),[n,a]=(0,s.useState)(e);(0,fa.Z)((()=>{a(e)}),400,[e]);const l=(0,s.useCallback)(((e,n)=>t({type:ha.SET_FILTER_VALUE,values:n,search:e})),[t]),i=(0,s.useCallback)((e=>t({type:ha.LOAD_FILTER_VALUE,search:e})),[t]),o=(0,s.useCallback)((e=>t({type:ha.SET_DEFAULTS,values:e})),[t]),r=(0,s.useCallback)((()=>t({type:ha.USE_DEFAULTS})),[t]);return[n,(0,s.useMemo)((()=>({setFilterValue:l,loadFilterValue:i,setDefaults:o,useDefaults:r})),[l,i,o,r])]},Ca=e=>{const[t,n]=s.useState(!1),l=(0,pa.Z)(t),{getIntegrations:i}=ra(),{values:o}=(0,ta.useFormikContext)(),[r,c]=ba(),u=s.useCallback((e=>{n(e)}),[n]);s.useEffect((()=>{const n=e.onOpenChange;void 0!==l&&l!==t&&n&&n(t)}),[l,t,e.onOpenChange]),s.useEffect((()=>{i(e.integrationType,"").then((e=>{const t=e.map((e=>new An.YO(e)));c.setDefaults(t)}))}),[i,e.integrationType,c]),s.useEffect((()=>{r.loadingFilter&&i(e.integrationType,r.lastSearch).then((e=>c.setFilterValue(r.lastSearch,e.map((e=>new An.YO(e))))))}),[i,e.integrationType,r.loadingFilter,r.lastSearch,c]);const d=s.useMemo((()=>{var e;const t=(null!==(e=o.actions)&&void 0!==e?e:[]).filter((e=>(null==e?void 0:e.type)===je.k$.INTEGRATION)).map((e=>{var t;return null===(t=e)||void 0===t?void 0:t.integration.id}));return new Set(t)}),[o]),m=s.useCallback((e=>e.map((e=>{const t=null==d?void 0:d.has(e.integration.id);return s.createElement(a.SelectOption,{key:e.getKey(),value:new Ea(e),description:t?"This integration has already been added":void 0,isDisabled:t})}))),[d]),p=va(r,m),E=s.useCallback((e=>{var t;if(null===e)return p;const n=null===(t=e.target.value)||void 0===t?void 0:t.trim();return""===n?c.useDefaults():c.loadFilterValue(n),p}),[c,p]),v=s.useMemo((()=>{const t=e.selected;if(void 0!==t&&void 0!==t.name&&void 0!==t.id&&void 0!==t.type)return new Ea(new An.YO(t))}),[e.selected]),h=s.useCallback(((t,a)=>{const l=e.onSelected;a instanceof Ea&&(l(a),n(!1))}),[e.onSelected]),f=`Choose ${g.ZP.integrations.types[e.integrationType].name.toLowerCase()}`;return s.createElement("div",{...(0,Je.k)("IntegrationRecipientTypeahead",e)},s.createElement(a.Select,{maxHeight:400,variant:a.SelectVariant.typeahead,typeAheadAriaLabel:f,placeholderText:f,selections:v,onSelect:h,onToggle:u,isOpen:t,onFilter:E,menuAppendTo:document.body,isDisabled:e.isDisabled,validated:e.error?"error":void 0},p))},Ta="groups",Sa="User Access Groups",ka=(e,t,n)=>n.length>0?s.createElement(a.SelectGroup,{key:e,label:t},n.map((e=>e instanceof An.nc&&e.isLoading?s.createElement(a.SelectOption,{key:e.getKey(),isNoResultsOption:!0},s.createElement(a.Skeleton,{width:"100%"})):s.createElement(a.SelectOption,{key:e.getKey(),value:new Ea(e),description:e.description})))):s.createElement(s.Fragment,{key:e}),Ia=e=>[ka(Ta,Sa,e)],Na=()=>[s.createElement(a.SelectGroup,{key:Ta,label:Sa},s.createElement(a.SelectOption,{key:"loading-group",isNoResultsOption:!0},s.createElement(a.Skeleton,{width:"100%"})))],wa=[ka("users","Users",[new An.dt(void 0,!1,!1),new An.dt(void 0,!0,!1)])],Aa=e=>{const[t,n]=s.useState(!1),[l,i]=ba(),o=(0,pa.Z)(t),{getNotificationRecipients:r}=ra();s.useEffect((()=>{r().then((e=>i.setDefaults(e)))}),[r,i]),s.useEffect((()=>{l.loadingFilter&&r().then((e=>i.setFilterValue(l.lastSearch,e)))}),[r,l.loadingFilter,l.lastSearch,i]);const c=s.useCallback((e=>{n(e)}),[n]);s.useEffect((()=>{const n=e.onOpenChange;void 0!==o&&o!==t&&n&&n(t)}),[o,t,e.onOpenChange]);const u=va(l,Ia,Na),d=s.useMemo((()=>[...wa,...u]),[u]),m=s.useMemo((()=>{const t=e.selected;if(void 0!==t)return t.map((e=>new Ea(e)))}),[e.selected]),p=s.useCallback(((t,n)=>{const a=e.onSelected;n instanceof Ea&&a(n)}),[e.onSelected]),E=s.useMemo((()=>null==m?void 0:m.map((e=>{const t=e=>t=>{t.stopPropagation(),p(t,e)},n=e.recipient.getKey();if(e.recipient instanceof An.nc){if(e.recipient.isLoading)return s.createElement(a.Chip,{key:n,onClick:t(e)},s.createElement(a.Skeleton,{"data-testid":"loading-group",width:"40px"}));if(e.recipient.hasError)return s.createElement(Pn,{key:n,onClose:t(e)})}return s.createElement(a.Chip,{onClick:t(e),key:n},e.recipient.displayName)}))),[m,p]);return s.createElement("div",{...(0,Je.k)("RecipientTypeahead",e)},s.createElement(a.Select,{maxHeight:400,variant:a.SelectVariant.checkbox,selections:m,onSelect:p,onToggle:c,isOpen:t,menuAppendTo:document.body,isDisabled:e.isDisabled,onClear:e.onClear,validated:e.error?"error":void 0,isGrouped:!0,isCheckboxSelectionBadgeHidden:!0,isInputValuePersisted:!0,placeholderText:s.createElement(a.ChipGroup,null,E)},d))},La=()=>!1,Da=e=>{var t,n;let l;return l=e.action?e.action.type===je.k$.INTEGRATION?s.createElement(Ca,{onSelected:e.integrationSelected,integrationType:null!==(n=null===(t=e.action.integration)||void 0===t?void 0:t.type)&&void 0!==n?n:Y.WN.WEBHOOK,selected:e.action.integration,onOpenChange:e.onOpenChange,error:!!e.error}):s.createElement(Aa,{onSelected:e.recipientSelected,selected:e.action.recipient,onClear:e.recipientOnClear,onOpenChange:e.onOpenChange,error:!!e.error}):s.createElement("div",null,s.createElement(a.Select,{variant:a.SelectVariant.typeahead,isDisabled:!0,onToggle:La,isOpen:!1})),s.createElement(s.Fragment,null," ",l,e.error&&s.createElement(a.FormHelperText,{isError:!0,isHidden:!e.error},e.error))};class Pa{constructor(e){"integration"===e.kind?(this.notificationType=je.k$.INTEGRATION,this.integrationType=e.type):(this.notificationType=e.type,this.integrationType=void 0)}compareTo(e){return e instanceof Pa&&e.notificationType===this.notificationType&&e.integrationType===this.integrationType}toString(){const e=g.ZP.notifications.types[this.notificationType].name;return this.integrationType?`${e}: ${g.ZP.integrations.types[this.integrationType].name}`:e}}const Oa=e=>s.createElement(s.Fragment,null,s.createElement("div",null,"You have no integration configured."),s.createElement("div",null,"Go to Settings ",">"," ",s.createElement(p.Link,{style:{pointerEvents:"all"},rel:e.testNoIntegrationRenderWithoutRelAndTarget?void 0:"noopener noreferrer",target:e.testNoIntegrationRenderWithoutRelAndTarget?void 0:"_blank",to:Ul.integrations()},"Integrations")," to configure.")),Fa=e=>{const[t,n]=s.useState(!1),{getIntegrations:l}=ra(),[i,o]=s.useState(Object.values(Y.j3).reduce(((e,t)=>(e[t]=!0,e)),{}));s.useEffect((()=>{Object.values(Y.j3).forEach((async e=>{const t=await l(e);o((0,ge.ZP)((n=>{n[e]=t.length>0})))}))}),[l]);const r=s.useCallback((e=>{n(e)}),[n]),c=s.useCallback(((t,a)=>{const l=e.onSelected;a instanceof Pa&&(l(a),n(!1))}),[e.onSelected,n]),u=s.useMemo((()=>{if(e.action)return e.action.type===je.k$.INTEGRATION?new Pa({kind:"integration",type:e.action.integration.type}):new Pa({kind:"notification",type:e.action.type})}),[e.action]),d=(0,Qe.N)(),m=Ye(),p=s.useMemo((()=>{return(t=m,n=d,l=e.selectedNotifications,[...t.filter((e=>!l.includes(e))).map((e=>new Pa({kind:"notification",type:e}))),...n.map((e=>new Pa({kind:"integration",type:e})))]).map((t=>{const n=(0,Y.F8)(t.integrationType)&&!i[t.integrationType];return s.createElement(a.SelectOption,{isDisabled:n,key:t.toString(),value:t,description:n&&s.createElement(Oa,{testNoIntegrationRenderWithoutRelAndTarget:e.testNoIntegrationRenderWithoutRelAndTarget})})}));var t,n,l}),[m,d,e.selectedNotifications,i,e.testNoIntegrationRenderWithoutRelAndTarget]);return s.createElement("div",{...(0,Je.k)("ActionTypeahead",e)},s.createElement(a.Select,{maxHeight:400,variant:a.SelectVariant.single,"aria-label":"Select action",placeholderText:"Select action",selections:u,onToggle:r,isOpen:t,onSelect:c,menuAppendTo:document.body,isDisabled:e.isDisabled},p))};(0,u.cssRaw)("\n    @media only screen and (max-width: 768px) {\n        .pf-c-select .pf-c-select__toggle-typeahead {\n            --pf-c-select__toggle-typeahead--FlexBasis: 0;\n        }\n    }\n");const xa=(0,u.style)({$nest:{"& tr":{borderBottom:(0,ce.important)(0)},"& th:first-child":{paddingLeft:(0,ce.important)(0)},"& th:last-child, & td:last-child":{paddingRight:(0,ce.important)(0)}}}),Ra=(0,u.style)({$nest:{"& td:first-child":{paddingLeft:(0,ce.important)(0)},"& td:last-child":{paddingRight:(0,ce.important)(0)},"& td":{verticalAlign:(0,ce.important)("top")}}}),Ga=(0,u.style)({textAlign:"left",paddingLeft:0}),Ba=[{title:"Actions",transforms:[(0,Se.cellWidth)(50)]},{title:"Recipient"}],Ma=()=>s.createElement("span",null),Ua=e=>{const{values:t,setValues:n,errors:l,touched:i,setFieldTouched:o}=e.form,r=s.useMemo((()=>{var e;return null!==(e=t.actions)&&void 0!==e?e:[]}),[t]),c=s.useMemo((()=>{var e;return null!==(e=null==i?void 0:i.actions)&&void 0!==e?e:[]}),[i]),u=s.useMemo((()=>{var e;return null!==(e=null==l?void 0:l.actions)&&void 0!==e?e:[]}),[l]),d=s.useMemo((()=>new Array(...new Set(r.filter((e=>e)).map((e=>e.type))))),[r]),m=s.useCallback((e=>{n((0,ge.ZP)((t=>{const n=t;n.actions=e instanceof Function?(0,ge.cA)(e(n.actions)):(0,ge.cA)(e)})),!1)}),[n]),p=s.useCallback((()=>{(0,e.push)(void 0)}),[e.push]);s.useEffect((()=>{0===r.length&&p()}),[r,p]);const E=(g=m,{handleActionSelected:(0,s.useCallback)((e=>t=>{g((0,ge.ZP)((n=>{n[e]||(n[e]={});const a=n[e];a.type=t.notificationType,t.integrationType?a.integration={type:t.integrationType}:a.recipient=[]})))}),[g]),handleIntegrationSelected:(0,s.useCallback)((e=>t=>{g((0,ge.ZP)((n=>{t.recipient instanceof An.YO&&(n[e].integration=t.recipient.integration)})))}),[g]),handleRecipientSelected:(0,s.useCallback)((e=>t=>{g((0,ge.ZP)((n=>{const a=n[e];if(a.type!==je.k$.INTEGRATION){const e=a,n=(0,ge.Js)(e.recipient);if(n){const a=n.findIndex((e=>t.recipient.equals(e)));-1===a?e.recipient.push((0,ge.cA)(t.recipient)):e.recipient.splice(a,1)}}})))}),[g]),handleRecipientOnClear:(0,s.useCallback)((e=>()=>{g((0,ge.ZP)((t=>{const n=t[e];n.type!==je.k$.INTEGRATION&&(n.recipient=[])})))}),[g])});var g;const v=s.useMemo((()=>((e,t,n,a,l,i)=>e.map(((e,o)=>{var r,c;let u,d,m=!1;return d=(null==e?void 0:e.type)===je.k$.INTEGRATION?`actions.${o}.integration`:`actions.${o}.recipient`,(null==e?void 0:e.type)===je.k$.INTEGRATION&&((null===(r=n[o])||void 0===r?void 0:r.integration)&&(m=!0),m&&(null===(c=t[o])||void 0===c?void 0:c.integration)&&(u="Select a recipient for this integration.")),!u&&m&&i(d,!1,!1),{id:o,key:o,cells:[{title:s.createElement(Fa,{selectedNotifications:a,action:e,onSelected:l.handleActionSelected(o)})},{title:s.createElement(Da,{action:e,integrationSelected:l.handleIntegrationSelected(o),recipientSelected:l.handleRecipientSelected(o),recipientOnClear:l.handleRecipientOnClear(o),error:u,onOpenChange:e=>{e||i(d,!0,!1)}})}]}})))(r,u,c,d,E,o)),[r,u,c,d,E,o]),h=s.useCallback((t=>{const n=e.handleRemove;return v.length>1?[{key:"delete",title:s.createElement(a.Button,{"aria-label":"delete-action",variant:a.ButtonVariant.plain},s.createElement(L.MinusCircleIcon,null)),isOutsideDropdown:!0,onClick:n(t.id)}]:[]}),[v,e.handleRemove]);return s.createElement(s.Fragment,null,s.createElement(Se.Table,{"aria-label":"behavior-group-actions-form",rows:v,cells:Ba,actionResolver:h,actionsToggle:Ma,borders:!1,variant:Se.TableVariant.compact,isStickyHeader:!0},s.createElement(Se.TableHeader,{className:xa}),s.createElement(Se.TableBody,{className:Ra})),s.createElement(a.GridItem,{span:12},s.createElement(a.Button,{className:Ga,variant:a.ButtonVariant.link,icon:s.createElement(L.PlusCircleIcon,null),onClick:p},"Add action")))},Va=e=>s.createElement("div",{...(0,Je.k)("Notifications/BehaviorGroupForm",e)},s.createElement(a.Grid,{hasGutter:!0},s.createElement(ta.FieldArray,{name:"actions"},(e=>s.createElement(s.Fragment,null,s.createElement(Ua,{...e})))))),_a=R.Ry({type:R.nK().oneOf([je.k$.INTEGRATION]).required(),integration:R.Ry({id:R.Z_().required()}).required(),integrationId:R.Z_().min(1)}),$a=R.Ry({type:R.nK().oneOf([je.k$.EMAIL_SUBSCRIPTION,je.k$.DRAWER]).required(),recipient:R.IX(R.Ry()).min(1),integrationId:R.Z_().min(0)}),Za=R.IX(R.Vo((e=>e&&e.hasOwnProperty("type")&&e.type===je.k$.INTEGRATION?_a:$a))).test("no-repeated","${path} can't contain repeated actions",((e,t)=>{const n=[];let a=!1;const l=[];if(!e)return!0;for(let i=0;i<e.length;++i){const o=e[i],r=o.integrationId;o.type===je.k$.EMAIL_SUBSCRIPTION?(a&&n.push(t.createError({message:"Only 1 send email action is allowed",path:`actions.${i}`})),a=!0):r&&(l.includes(r)?n.push(t.createError({message:"Integration already used in the group, please select other",path:`actions.${i}`})):l.push(r))}return 0===n.length||{...t.createError(),inner:n}})),Ha=(R.Ry({actions:Za}),R.Ry({displayName:R.Z_().required("You must specify a name for the behavior group"),actions:Za}),"Actions and recipients"),za=(0,u.style)({paddingTop:oe.S.value}),qa=()=>{const{values:e}=(0,ta.useFormikContext)();return s.createElement(o.Form,null,s.createElement("div",null,s.createElement(a.Title,{headingLevel:"h4",size:"xl"},Ha),s.createElement(a.TextContent,{className:za},s.createElement(a.Text,null,"Select action and recipient pairs to assign to your notification events.")),s.createElement(Va,{behaviorGroup:e})))},Wa=R.Ry({actions:Za}),Qa=e=>s.createElement(Se.TableComposable,{variant:Se.TableVariant.compact},s.createElement(Se.Thead,null,s.createElement(Se.Tr,null,s.createElement(Se.Th,null),s.createElement(Se.Th,null,"Event type"),s.createElement(Se.Th,null,"Application"))),s.createElement(Se.Tbody,null,e.children)),Ya=()=>s.createElement(Qa,null,[...Array(10)].map(((e,t)=>s.createElement(Se.Tr,{key:t},s.createElement(Se.Td,{select:{isSelected:!1,rowIndex:t,disable:!0}}),s.createElement(Se.Td,null,s.createElement(a.Skeleton,{width:"80%"})),s.createElement(Se.Td,null,s.createElement(a.Skeleton,{width:"80%"})))))),Ka=e=>s.createElement(Qa,null,e.events.map(((t,n)=>s.createElement(Se.Tr,{key:t.id},s.createElement(Se.Td,{modifier:e.selectionLoading?"fitContent":void 0,noPadding:e.selectionLoading,select:e.selectionLoading?void 0:{rowIndex:n,onSelect:(n,a)=>e.onSelect&&e.onSelect(a,t),isSelected:t.isSelected,disable:e.selectionLoading}},e.selectionLoading&&s.createElement(a.Spinner,{size:"sm"})),s.createElement(Se.Td,null,t.eventTypeDisplayName),s.createElement(Se.Td,null,t.applicationDisplayName))))),ja=e=>e.events?s.createElement(Ka,{...e,events:e.events}):s.createElement(Ya,null),Ja="Associate event types",Xa=(0,u.style)({paddingTop:oe.S.value}),el=e=>{const{setValues:t,values:n}=(0,ta.useFormikContext)(),[l,i]=s.useState((()=>{const e={};return n.events.forEach((t=>{e[t.id]=t})),e})),r=gn(e.bundle,e.applications,!1),c=V(r.pageController.page),u=(0,o.useTransformQueryResponse)((0,f.useParameterizedQuery)(M),U);(0,s.useEffect)((()=>{t((0,ge.ZP)((e=>{e.events=Object.values(l)})))}),[t,l]);const d=s.useMemo((()=>{const e=c.payload;return 200===(null==e?void 0:e.status)?e.value.meta.count:0}),[c.payload]),m=s.useMemo((()=>{var e;return"eventTypesArray"===(null===(e=c.payload)||void 0===e?void 0:e.type)?c.payload.value.data.map((e=>({...e,isSelected:Object.keys(l).includes(e.id)}))):[]}),[c.payload,l]),p=s.useCallback(((e,t)=>{i((0,ge.ZP)((n=>{e?n[t.id]=t:delete n[t.id]})))}),[i]),E=s.useCallback((e=>{const t=r.pageController.page;switch(e){case un.ALL:if(d===m.length)return i((0,ge.ZP)((e=>{m.forEach((t=>{e[t.id]=t}))})));(async()=>{var e;let n=1;const a={},l=o.Page.lastPageForElements(d,t.size);for(;;){const i=t.withPage(n);if(i.index>l.index)break;if(t.index===i.index)m.forEach((e=>{a[e.id]=e}));else{const l=await u.query(t.withPage(n));if("eventTypesArray"!==(null===(e=l.payload)||void 0===e?void 0:e.type))break;l.payload.value.data.forEach((e=>{a[e.id]=e}))}n++}i((0,ge.ZP)((e=>{for(const t of Object.values(a))e[t.id]=t})))})();break;case un.PAGE:i((0,ge.ZP)((e=>{m.forEach((t=>{e[t.id]=t}))})));break;case un.NONE:i({})}}),[i,m,u,r.pageController.page,d]);return s.createElement(o.Form,null,s.createElement("div",null,s.createElement(a.Title,{headingLevel:"h4",size:"xl"},Ja),s.createElement(a.TextContent,{className:Xa},s.createElement(a.Text,null,"Select event types you would like to assign this behavior group to."))),s.createElement(En,{filters:r.filters,setFilters:r.setFilters,clearFilter:r.clearFilters,appFilterOptions:e.applications,pageAdapter:r.pageController,count:d,pageCount:m.length,onSelectionChanged:E,selectedCount:Object.keys(l).length,bulkSelectionDisabled:u.loading},s.createElement(ja,{onSelect:p,events:c.loading?void 0:m,selectionLoading:u.loading})))},tl="Name",nl=()=>s.createElement(o.Form,{ouiaId:"basic-information-step"},s.createElement(a.Title,{headingLevel:"h4",size:"xl"},tl),s.createElement(o.FormTextInput,{ouiaId:"name",id:"name",name:"displayName",label:"Behavior group name",isRequired:!0})),al=R.Ry({displayName:R.Z_().min(1).max(150,"Must be 150 characters or less").required("Behavior group name is required")}),ll="Review",il=(0,u.style)({fontSize:fn.U.value}),ol=e=>s.createElement(a.Grid,null,s.createElement(a.GridItem,{span:6},s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h6,className:il},"Event type"))),s.createElement(a.GridItem,{span:6},s.createElement(a.TextContent,null,s.createElement(a.Text,{component:a.TextVariants.h6,className:il},"Application"))),e.events.map((e=>s.createElement(s.Fragment,{key:e.id},s.createElement(a.GridItem,{span:6},e.eventTypeDisplayName),s.createElement(a.GridItem,{span:6},e.applicationDisplayName))))),rl=()=>{const{values:e}=(0,ta.useFormikContext)();return s.createElement(o.Form,{ouiaId:"review-step"},s.createElement(a.Title,{headingLevel:"h2",size:"xl"},ll),s.createElement(a.DescriptionList,{isHorizontal:!0},s.createElement(a.DescriptionListGroup,null,s.createElement(a.DescriptionListTerm,null,"Name"),s.createElement(a.DescriptionListDescription,null," ",e.displayName)),s.createElement(a.DescriptionListGroup,null,s.createElement(a.DescriptionListTerm,null," Actions and recipients"),s.createElement(a.DescriptionListDescription,null,s.createElement(Vn,{actions:e.actions}))),s.createElement(a.DescriptionListGroup,null,s.createElement(a.DescriptionListTerm,null,"Associate event types"),s.createElement(a.DescriptionListDescription,null,s.createElement(ol,{events:e.events})))))},sl=()=>{},cl=e=>{const[t,n]=s.useState(0),{isValid:a,validateForm:l}=(0,ta.useFormikContext)(),i=(e=>{const t=q(),{query:n}=(0,s.useContext)(f.ClientContext),[a,l]=(0,s.useState)(!1);return{save:(0,s.useCallback)((async a=>{var i,o,r,s;const c=t.mutate;let u=!1,d=!1,m=!1;void 0===a.id&&(u=!0,d=!0),a.displayName!==(null==e?void 0:e.displayName)&&(u=!0);const p=[...null!==(i=null==e?void 0:e.events)&&void 0!==i?i:[]].sort(),E=[...null!==(o=a.events)&&void 0!==o?o:[]].sort();p.length===E.length&&p.every(((e,t)=>e===E[t]))||(m=!0),(0,je.VL)(null!==(r=null==e?void 0:e.actions)&&void 0!==r?r:[],null!==(s=a.actions)&&void 0!==s?s:[])||(d=!0);const g=(0,ma.uniqWith)([].concat(...a.actions.filter(je.Yh).map((e=>(0,ge.ZP)(e,(e=>{e.recipient=e.recipient.filter((e=>!e.integrationId))})))).map((e=>(0,B.OO)(e)))),ma.isEqual);if(g.find((e=>![je.k$.EMAIL_SUBSCRIPTION,je.k$.DRAWER].includes(e.type))))throw new Error("Only email and drawer subscriptions are created when assigning behavior groups");g.length>0&&l(!0);const v=await Promise.all(g.map((e=>{return n((t=e,(0,je.K4)(t)?bt.B.EndpointResourceGetOrCreateEmailSubscriptionEndpoint.actionCreator({body:{only_admins:t.props.onlyAdmins,group_id:t.props.groupId}}):(0,je.L6)(t)?bt.B.EndpointResourceGetOrCreateDrawerSubscriptionEndpoint.actionCreator({body:{only_admins:t.props.onlyAdmins,group_id:t.props.groupId}}):void(0,ae.ZP)(t))).then((e=>{var t;return"Endpoint"===(null===(t=e.payload)||void 0===t?void 0:t.type)?e.payload.value.id:void 0}));var t}))).then((e=>{if(e.includes(void 0))throw new Error("Unexpected ids were returned when querying for system endpoints");const t=[...e];return((e,t)=>{const n=t?[...t]:void 0;return e.reduce(((a,l)=>{if((0,je.Yh)(l))l.recipient.forEach((l=>{if(l.integrationId)a.push(l.integrationId);else if(void 0===n)a.push(void 0);else{if(!(n.length>0))throw new Error(`No more ids remaining to assign: actions ${e} newIds: ${t}`);a.push(n.shift())}}));else{if(!(0,je._f)(l))throw new Error(`Unknown action type: ${l}`);a.push(l.integration.id)}return a}),[])})(a.actions,t)})),h={...a,displayName:u?a.displayName:void 0,endpointIds:d?v:void 0,eventTypesIds:m?a.events.map((e=>e.id)):void 0};return u||d||m?c(h).then((e=>{var t;return{operation:void 0===a.id?ca.CREATE:ca.UPDATE,status:200===(null===(t=e.payload)||void 0===t?void 0:t.status)}})).catch((()=>({operation:void 0===a.id?ca.CREATE:ca.UPDATE,status:!1}))):{operation:void 0===a.id?ca.CREATE:ca.UPDATE,status:!0}}),[t.mutate,n,e]),isSaving:(0,s.useMemo)((()=>t.loading||a),[t.loading,a])}})(e.behaviorGroup),{values:o}=(0,ta.useFormikContext)(),{addDangerNotification:r,addSuccessNotification:c}=(0,Bt.l)(),u=((e,t,n,a)=>{const l=s.useMemo((()=>({name:tl,component:s.createElement(nl,null),schema:al})),[]),i=(({applications:e,bundle:t})=>s.useMemo((()=>({name:Ja,component:s.createElement(el,{applications:e,bundle:t})})),[e,t]))(e),o=s.useMemo((()=>({name:Ha,component:s.createElement(qa,null),schema:Wa})),[]),[r,c]=(0,s.useState)(0),[u,d]=(0,s.useState)((()=>new Set));(0,s.useEffect)((()=>{c((e=>Math.max(t,e)))}),[t]),(0,s.useEffect)((()=>{d((0,ge.ZP)((e=>{n?e.delete(t):e.add(t)})))}),[t,n]);const m=0===u.size?r:Math.min(...Array.from(u));return(0,s.useMemo)((()=>[l,o,i,{name:ll,component:s.createElement(rl,null),nextButtonText:"Finish"}].map(((e,t)=>({...e,id:t,canJumpTo:!a&&t<=m,hideCancelButton:!1,enableNext:n})))),[l,o,n,m,a,i])})({bundle:e.bundle,applications:e.applications},t,a,i.isSaving),d=u[t],m=null==d?void 0:d.schema;s.useEffect((()=>{e.setValidationSchema(m)}),[t]),s.useEffect((()=>{l()}),[e.validationSchema,l]);const p=s.useCallback((async()=>{const t=e.onClose,n=i.save,a={...o,bundleId:e.bundle.id},l=await n(a);l.status?(l.operation===ca.CREATE?c("New behavior group created",s.createElement(s.Fragment,null,"Group ",s.createElement("b",null," ",a.displayName," ")," created successfully.")):c("Behavior group saved",s.createElement(s.Fragment,null,"Group ",s.createElement("b",null," ",a.displayName," ")," was saved successfully.")),t(!0)):l.operation===ca.CREATE?r("Behavior group failed to be created",s.createElement(s.Fragment,null,"Failed to create group ",s.createElement("b",null," ",a.displayName),".",s.createElement("br",null),"Please try again.")):r("Behavior group failed to save",s.createElement(s.Fragment,null,"Failed to save group ",s.createElement("b",null," ",a.displayName),".",s.createElement("br",null),"Please try again."))}),[o,i.save,e.bundle,e.onClose,r,c]);return s.createElement(ia,{steps:u,onNext:async e=>{let t=!0;(null==d?void 0:d.isValid)&&(t=await d.isValid()),t&&(n((e=>Math.min(e+1,u.length))),e())},onBack:async e=>{n((e=>e-1)),e()},onGoToStep:n,loading:i.isSaving,onClose:()=>{e.onClose(!1)},onSave:p})},ul=e=>{var t;const n=(()=>{const e=(0,da.P)();return(0,s.useCallback)((async()=>e.groups.map((e=>new An.nc(void 0,e.id,e.name)))),[e])})(),a=(()=>{const{query:e}=(0,s.useContext)(f.ClientContext);return s.useCallback((async(t,n)=>e((0,ua.Kr)(o.Page.of(1,20,(new o.Filter).and("type",o.Operator.EQUAL,[t]).and("name",o.Operator.EQUAL,null!=n?n:"")))).then((e=>{let t=[];const n=e.payload?(0,ua.us)(e.payload):void 0;return"IntegrationPage"===(null==n?void 0:n.type)&&(t=n.value.data),t}))),[e])})(),l=s.useMemo((()=>({getIntegrations:a,getNotificationRecipients:n})),[a,n]),[i,r]=s.useState();return s.createElement(sa,{value:l},s.createElement(ta.Formik,{validateOnMount:!0,onSubmit:sl,initialValues:null!==(t=e.behaviorGroup)&&void 0!==t?t:{actions:[],events:[],displayName:void 0},validationSchema:i,validateOnBlur:!0,validateOnChange:!0},s.createElement(cl,{...e,validationSchema:i,setValidationSchema:r})))},dl=e=>{const t=((e,t)=>(0,s.useCallback)((()=>e(t)),[e,t]))(e.onDelete,e.behaviorGroup),n=s.useMemo((()=>0===e.conflictingNotifications.length?"Cancel":"Close"),[e.conflictingNotifications]),l=s.useMemo((()=>0===e.conflictingNotifications.length?a.ButtonVariant.link:a.ButtonVariant.secondary),[e.conflictingNotifications]),[i,r]=s.useState(!1),c=s.useMemo((()=>{if(0===e.conflictingNotifications.length)return s.createElement(a.Stack,{hasGutter:!0},s.createElement(a.StackItem,null,"Action and recipient pairings assigned in ",s.createElement("b",null,e.behaviorGroup.displayName)," will lost. You will no longer be able to assign this behavior group to events."),s.createElement(a.StackItem,null,s.createElement(a.Checkbox,{id:"checkbox-delete-i-acknowledge",label:"I acknowledge that this action cannot be undone",onChange:r,isChecked:i})));{const t=e.conflictingNotifications;return s.createElement(a.Stack,{hasGutter:!0},s.createElement(a.StackItem,null,"You will no longer be able to assign ",s.createElement("b",null,e.behaviorGroup.displayName)," to events, and existing associations to events listed below will be removed."),s.createElement(a.StackItem,null,s.createElement(a.ExpandableSection,{toggleText:`View ${t.length} event${0===t.length?"":"s"}`},s.createElement(a.List,null,t.map((e=>s.createElement(a.ListItem,{key:e.id},`${e.applicationDisplayName} - ${e.eventTypeDisplayName}`)))))),s.createElement(a.StackItem,null,s.createElement(a.Checkbox,{id:"checkbox-delete-i-acknowledge",label:"I acknowledge that this action cannot be undone",onChange:r,isChecked:i})))}}),[e.conflictingNotifications,e.behaviorGroup,i,r]);return s.createElement(o.DeleteModal,{isOpen:!0,isDeleting:e.isDeleting,title:"Delete behavior group",content:c,onClose:e.onClose,onDelete:t,error:e.error,titleIconVariant:"warning",actionButtonDisabled:!i,cancelButtonTitle:n,cancelButtonVariant:l})},ml=()=>!1,pl=e=>s.createElement(o.DeleteModal,{isOpen:!0,title:"Delete behavior group",actionButtonDisabled:!0,titleIconVariant:"warning",content:s.createElement(a.Stack,{hasGutter:!0},s.createElement(a.StackItem,null,s.createElement(a.Skeleton,{width:"500px"})),s.createElement(a.StackItem,null,s.createElement(a.Skeleton,{width:"500px"}))),onClose:e.onClose,isDeleting:!1,onDelete:ml}),El=e=>y.B.NotificationResourceDeleteBehaviorGroup.actionCreator({id:e}),gl=(0,G.validationResponseTransformer)((e=>200===e.status?(0,G.validatedResponse)("Notifications",200,(0,B.Jc)(e.value),e.errors):e)),vl=e=>{var t;const n=(0,f.useMutation)(El),a=(c=e.behaviorGroup.id,(0,o.useTransformQueryResponse)((0,f.useQuery)((e=>y.B.NotificationResourceGetEventTypesAffectedByRemovalOfBehaviorGroup.actionCreator({behaviorGroupId:e}))(c)),gl)),{addDangerNotification:l,addSuccessNotification:i}=(0,Bt.l)(),r=s.useCallback((async e=>{var t;const a=n.mutate;return 200===(null===(t=(await a(e.id)).payload)||void 0===t?void 0:t.status)?(i("Behavior group deleted",s.createElement(s.Fragment,null,"Group ",s.createElement("b",null,e.displayName)," deleted successfully.")),!0):(l("Behavior group failed to be deleted",s.createElement(s.Fragment,null,"Failed to delete group ",s.createElement("b",null," ",e.displayName),".",s.createElement("br",null),"Please try again.")),!1)}),[n.mutate,l,i]);var c;return(0,s.useEffect)((()=>{const t=a.payload,n=e.onClose;t&&200!==t.status&&(l("Associated events failed to load ",s.createElement(s.Fragment,null,"Failed to load associated events for group ",s.createElement("b",null," ",e.behaviorGroup.displayName),".",s.createElement("br",null),"Please try again.")),n(!1))}),[l,a.payload,e.behaviorGroup,e.onClose]),a.loading?s.createElement(pl,{onClose:e.onClose}):200!==(null===(t=a.payload)||void 0===t?void 0:t.status)?null:s.createElement(dl,{onDelete:r,isDeleting:n.loading,onClose:e.onClose,behaviorGroup:e.behaviorGroup,conflictingNotifications:a.payload.value})},hl={backgroundColor:Dt.C.var,paddingLeft:Lt.J.var,paddingRight:Lt.J.var},fl=(0,u.style)(hl,{paddingBottom:Lt.J.var}),yl=(0,u.style)(hl,{paddingTop:Lt.J.var}),bl=(0,u.style)({marginTop:"-0.15em",color:vn.U.var}),Cl=(0,u.style)({marginTop:"2px",marginLeft:"-16px"}),Tl=(0,u.style)({marginTop:"10px",marginLeft:"-16px"}),Sl=(0,u.style)({marginTop:"-0.2em"}),kl=e=>{const{isDisabled:t,...n}=e,{isOrgAdmin:l}=(0,E.b)(),i=s.createElement(a.Button,{...n,isAriaDisabled:t,variant:a.ButtonVariant.primary},"Create new group");if(t){const e=l?"You need the Notifications administrator role to perform this action":"You do not have permissions to perform this action. Contact your org admin for more information";return s.createElement(a.Tooltip,{content:e},i)}return i},Il=e=>{const[t,n]=s.useState(!0),[l,i]=s.useState(""),{rbac:o}=(0,E.b)(),r=s.useMemo((()=>{if(!e.behaviorGroupContent.isLoading&&!e.behaviorGroupContent.hasError){const t=l.toLowerCase();return e.behaviorGroupContent.content.filter((e=>e.displayName.toLowerCase().includes(t)))}return Ht}),[l,e.behaviorGroupContent]),[c,u]=(0,ea.A)(),[d,m]=(0,Xn.S)(),p=s.useCallback((e=>{e.stopPropagation(),u.create({events:[],actions:[],displayName:""})}),[u]),g=s.useCallback((t=>{const n=e.behaviorGroupContent.reload;t&&n(),u.reset()}),[u,e.behaviorGroupContent.reload]),v=s.useCallback((e=>{u.edit({id:e.id,events:e.events,actions:e.actions,displayName:e.displayName})}),[u]),h=s.useCallback((e=>{m.delete(e)}),[m]),f=s.useCallback((t=>{const n=e.behaviorGroupContent.reload;t&&n(),m.reset()}),[m,e.behaviorGroupContent.reload]),y=s.useCallback((()=>{i("")}),[i]),b="behavior-group-section-content";return s.createElement(s.Fragment,null,s.createElement("div",{className:yl},s.createElement(a.Split,{hasGutter:!0},s.createElement(a.ExpandableSectionToggle,{isExpanded:t,onToggle:n,contentId:b,direction:"down"},s.createElement(a.SplitItem,null,s.createElement(a.Title,{className:bl,headingLevel:"h2"},"Behavior groups"))),s.createElement(a.SplitItem,null,!e.behaviorGroupContent.isLoading&&!e.behaviorGroupContent.hasError&&(e.behaviorGroupContent.content.length>0?s.createElement(a.Badge,{className:Tl,isRead:!0},e.behaviorGroupContent.content.length):s.createElement(kl,{className:Sl,component:"a",onClick:p,isDisabled:!o.canWriteNotifications}))),s.createElement(a.SplitItem,null,s.createElement(a.Popover,{position:"right",hideOnOutsideClick:!0,appendTo:()=>document.body,headerContent:s.createElement("div",{className:"pf-u-color-100"},"Behavior groups"),bodyContent:s.createElement("div",{className:"pf-u-font-size-sm pf-u-color-100"},"Behavior groups are made up of action/recipient pairings that allow you to configure which notification actions different users will be able to receive. Once you've created a behavior group, you can assign it to an event using the Events table below. "),footerContent:s.createElement("div",{className:"pf-u-font-size-sm pf-u-color-100"}," You may also prevent users from changing assigned actions by locking action/recipient pairings when creating or editing behavior groups.")},s.createElement(a.Button,{className:Cl,variant:"plain","aria-label":"Help"},s.createElement(L.OutlinedQuestionCircleIcon,null)))))),s.createElement(a.ExpandableSection,{className:fl,contentId:b,isExpanded:t,onToggle:n,isDetached:!0},s.createElement(a.Stack,{hasGutter:!0},(e.behaviorGroupContent.isLoading||e.behaviorGroupContent.hasError||e.behaviorGroupContent.content.length>0)&&s.createElement(s.Fragment,null,s.createElement(a.StackItem,null,s.createElement(a.Split,{hasGutter:!0},s.createElement(a.SplitItem,null,s.createElement(a.SearchInput,{value:l,onChange:i,onClear:y,type:"text","aria-label":"Search by name",placeholder:"Search by name",isDisabled:e.behaviorGroupContent.isLoading})),s.createElement(a.SplitItem,null,s.createElement(kl,{isDisabled:e.behaviorGroupContent.isLoading||!o.canWriteNotifications,onClick:p})))),s.createElement(a.StackItem,null,e.behaviorGroupContent.isLoading?s.createElement(Jn,null):e.behaviorGroupContent.hasError?s.createElement("div",null,"Error loading behavior groups"):s.createElement(Jn,{onEdit:o.canWriteNotifications?v:void 0,onDelete:o.canWriteNotifications?h:void 0,behaviorGroups:r})))),c.isOpen&&s.createElement(ul,{bundle:e.bundle,applications:e.applications,behaviorGroup:c.template,onClose:g}),d.isOpen&&s.createElement(vl,{behaviorGroup:d.data,onClose:f})))};var Nl=n(96702);const wl=(0,G.validationResponseTransformer)((e=>200===e.status?(0,G.validatedResponse)("BehaviorGroups",200,e.value.map(Nl.V),e.errors):e));class Al extends Error{}const Ll=(e,t)=>{const n=e.find(Yt(t));if(!n)throw new Al("Notification not found in rows");return n},Dl=(0,u.style)({marginBottom:$t.K.var}),Pl=[],Ol=e=>{var t;const n=(e=>{const t=(e=>(0,o.useTransformQueryResponse)((0,f.useQuery)(y.B.NotificationResourceFindBehaviorGroupsByBundleId.actionCreator({bundleId:e})),wl))(e),{groups:n,isLoading:a}=(0,da.P)(),l=s.useMemo((()=>{const e=t.payload,n=t.errorObject,a=t.loading,l=t.query;return a?{isLoading:!0,reload:l}:200===(null==e?void 0:e.status)?{isLoading:!1,hasError:!1,content:e.value,reload:l}:{isLoading:!1,hasError:!0,error:n.toString(),reload:l}}),[t.payload,t.loading,t.errorObject,t.query]);return(0,s.useMemo)((()=>l.isLoading||l.hasError?l:(0,ge.ZP)(l,(e=>{const t=(0,ge.Js)(e);t&&t.content.forEach(((t,l)=>t.actions.forEach(((t,i)=>{(0,je.Yh)(t)&&t.recipient.forEach(((t,o)=>{var r;if(t instanceof An.nc&&t.isLoading){const t=e.content[l].actions[i].recipient,s=t[o];t[o]=new An.nc(s.integrationId,s.groupId,(null===(r=n.find((e=>e.id===s.groupId)))||void 0===r?void 0:r.name)||a)}}))}))))}))),[l,n,a])})(e.bundle.id),{rbac:l}=(0,E.b)(),i=s.useCallback((e=>{console.log("Export to",e)}),[]),r=gn(e.bundle,e.applications,!0),c=V(r.pageController.page),u=s.useMemo((()=>{const e=c.payload;return 200===(null==e?void 0:e.status)?e.value.meta.count:0}),[c.payload]),d=n.isLoading||n.hasError?void 0:n.content,{rows:m,updateBehaviorGroupLink:p,startEditMode:g,finishEditMode:v,cancelEditMode:h,updateBehaviorGroups:b}=((e,t)=>{const[n,a]=s.useState([]),l=(0,pa.Z)(e),{query:i}=s.useContext(f.ClientContext),r=s.useCallback(((e,t)=>{a((0,ge.ZP)((n=>{const a=Ll(n,e),l=a.behaviors.findIndex(Yt(t));if(-1===l)throw new Error("Behavior group not found in rows");a.behaviors.splice(l,1)})))}),[a]),c=s.useCallback((e=>{a((0,ge.ZP)((t=>{for(const n of t)n.behaviors=[],e.forEach((e=>{e.events.find((e=>e.id===n.id))&&n.behaviors.push((0,ge.cA)(e))}))})))}),[a]),u=s.useCallback(((e,t,n)=>{n?a((0,ge.ZP)((n=>{Ll(n,e).behaviors.push({...(0,ge.cA)(t)})}))):r(e,t.id)}),[r,a]),d=s.useCallback((async(e,t)=>{var l;if("finish"===t){const t=Ll(n,e);t.isEditMode&&(a((0,ge.ZP)((t=>{Ll(t,e).loadingActionStatus="loading"}))),200===(null===(l=(await i(Z(e,t.behaviors.map((e=>e.id))))).payload)||void 0===l?void 0:l.status)?a((0,ge.ZP)((t=>{const n=Ll(t,e);n.isEditMode=!1,n.loadingActionStatus="done"}))):((0,o.addDangerNotification)("Saving behavior",s.createElement(s.Fragment,null,"There was an error saving the behavior of ",s.createElement("b",null,t.applicationDisplayName," - ",t.eventTypeDisplayName),".")),a((0,ge.ZP)((t=>{const n=Ll(t,e);n.isEditMode=!0,n.loadingActionStatus="done"})))))}else a((0,ge.ZP)((n=>{const a=Ll(n,e);a.isEditMode&&"cancel"===t&&(a.behaviors=a.oldBehaviors),a.isEditMode="edit"===t,a.isEditMode&&(a.oldBehaviors=a.behaviors)})))}),[a,n,i]),m=s.useCallback((e=>{d(e,"edit")}),[d]),p=s.useCallback((e=>{d(e,"finish")}),[d]),E=s.useCallback((e=>{d(e,"cancel")}),[d]);return s.useEffect((()=>{e!==l&&(a((t=>e.map((e=>({...e,loadingActionStatus:"done",behaviors:[],isEditMode:!1}))))),t&&c(t))}),[t,e,l,a,c]),{rows:n,updateBehaviorGroupLink:u,updateBehaviorGroups:c,startEditMode:m,finishEditMode:p,cancelEditMode:E}})(c.loading||"eventTypesArray"!==(null===(t=c.payload)||void 0===t?void 0:t.type)?Pl:c.payload.value.data,d);s.useEffect((()=>{d&&b(d)}),[d,b]);const C=s.useCallback(((e,t,n)=>{t&&p(e.id,t,n)}),[p]),T=s.useCallback((e=>{g(e)}),[g]),S=s.useCallback((e=>{v(e)}),[v]),k=s.useCallback((e=>{h(e)}),[h]);return s.createElement(Ft,{configuration:e.children,settings:e.children},s.createElement(a.Tab,{eventKey:0,title:s.createElement(a.TabTitleText,null,"Configuration")},s.createElement(En,{filters:r.filters,setFilters:r.setFilters,clearFilter:r.clearFilters,appFilterOptions:e.applications,onExport:i,count:u,pageAdapter:r.pageController},s.createElement(sn,{notifications:m,behaviorGroupContent:n,onBehaviorGroupLinkUpdated:C,onStartEditing:l.canWriteNotifications?T:void 0,onFinishEditing:l.canWriteNotifications?S:void 0,onCancelEditing:l.canWriteNotifications?k:void 0,onSort:r.onSort,sortBy:r.sortBy,sortDirection:r.sortDirection}))),s.createElement(a.Tab,{eventKey:1,title:s.createElement(a.TabTitleText,null,"Behavior Groups")},s.createElement("div",{className:Dl},s.createElement(Il,{bundle:e.bundle,applications:e.applications,behaviorGroupContent:n}))))},Fl=e=>{const{updateDocumentTitle:t}=(0,i.Z)();null==t||t(`${e.bundle.displayName} - Notifications`);const n=(0,m.useFlag)("platform.notifications.overhaul"),{rbac:r}=(0,E.b)(),d=c().useMemo((()=>Ul.eventLog(e.bundle.name)),[e.bundle.name]),p=At(),[g,v]=(0,s.useState)(0),h=c().createElement(l.Main,null,c().createElement(Ol,{applications:e.applications,bundle:e.bundle})),f=(0,u.style)({paddingLeft:Lt.J.value}),y=()=>n?null:c().createElement(le,{isDisabled:!r.canReadEvents,to:d,variant:a.ButtonVariant.secondary},N.V.pages.notifications.list.viewHistory),b=c().createElement(l.Main,null,c().createElement(Vt,null));(0,s.useEffect)((()=>{n&&(0,p.query)(e.bundleTabs[g].name)}),[g,p.query,e.bundleTabs,n]);const C=(0,s.useMemo)((()=>p.payload?p.payload.value:[]),[p.payload]);if(n){const t=(e,t)=>{v(t)};return c().createElement(c().Fragment,null,c().createElement(dt,{title:n?"Configure Events":`${N.V.pages.notifications.list.title} | ${e.bundle.displayName}`,subtitle:c().createElement("span",null,"This service allows you to configure which notifications different users within your organization will be entitled to receiving. To do this, create behavior groups and apply",c().createElement("a",{href:(0,o.localUrl)(`/user-preferences/notifications/${e.bundle.name}`,(0,o.getInsights)().chrome.isBeta())}," User Preferences"),"."),action:y()}),c().createElement(a.Flex,{direction:{default:"column"}},c().createElement(a.FlexItem,null,c().createElement(a.Tabs,{activeKey:g,onSelect:t,className:f},c().createElement(a.Tab,{eventKey:0,title:c().createElement(a.TabTitleText,null,"Red Hat Enterprise Linux")},c().createElement(l.Main,null,c().createElement(Ol,{applications:C,bundle:e.bundleTabs[0]}))),c().createElement(a.Tab,{eventKey:1,title:c().createElement(a.TabTitleText,null,"Console")},c().createElement(l.Main,null,c().createElement(Ol,{applications:C,bundle:e.bundleTabs[1]}))),c().createElement(a.Tab,{eventKey:2,title:c().createElement(a.TabTitleText,null,"Openshift")},c().createElement(l.Main,null,c().createElement(Ol,{applications:C,bundle:e.bundleTabs[2]})))))))}return c().createElement(c().Fragment,null,c().createElement(dt,{title:`${N.V.pages.notifications.list.title} | ${e.bundle.displayName}`,subtitle:c().createElement("span",null,"This service allows you to configure which notifications different users within your organization will be entitled to receiving. To do this, create behavior groups and apply them to different events. Users will be able to opt-in or out of receiving authorized event notifications in their",c().createElement("a",{href:(0,o.localUrl)(`/user-preferences/notifications/${e.bundle.name}`,(0,o.getInsights)().chrome.isBeta())}," User Preferences"),"."),action:y()}),c().createElement(Ft,{configuration:e.children,settings:e.children},c().createElement(a.Tab,{eventKey:0,title:c().createElement(a.TabTitleText,null,"Configuration")},h),c().createElement(a.Tab,{eventKey:1,title:c().createElement(a.TabTitleText,null,"Settings")},b)))};var xl;!function(e){e[e.LOADING=0]="LOADING",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.FAILED_TO_LOAD=2]="FAILED_TO_LOAD"}(xl||(xl={}));const Rl=()=>{const e=(0,p.useNavigate)(),t=(0,p.useParams)(),n=(0,m.useFlag)("platform.notifications.overhaul"),a=["rhel","console","openshift"],l=(0,s.useMemo)((()=>n?"rhel":t.bundleName),[n,t.bundleName]),i=b(),o=At(),r=(0,s.useMemo)((()=>{var e,t;return 200===(null===(e=i.payload)||void 0===e?void 0:e.status)?null!==(t=i.payload.value.find((e=>e.name===l)))&&void 0!==t?t:xl.NOT_FOUND:i.payload?xl.FAILED_TO_LOAD:xl.LOADING}),[i.payload,l]),c=[];n&&(()=>{var e;if(200!==(null===(e=i.payload)||void 0===e?void 0:e.status)){if(i.payload)throw new Error("Unable to load bundle information");return s.createElement(Nt,null)}a.forEach((e=>{var t,n;(null===(t=i.payload)||void 0===t?void 0:t.value)&&c.push(null!==(n=i.payload.value.find((t=>t.name===e)))&&void 0!==n?n:xl.NOT_FOUND)}))})(),s.useEffect((()=>{const e=o.query;(e=>"number"==typeof e)(r)||e(r.name)}),[r,o.query]);const u=(0,s.useMemo)((()=>{if(o.payload)return 200===o.payload.status?o.payload.value:null}),[o.payload]);if(r===xl.NOT_FOUND){if("/rhel"===l)throw new Error("Default bundle information not found");return e("/notifications/rhel"),s.createElement(s.Fragment,null)}if(r===xl.FAILED_TO_LOAD)throw new Error("Unable to load bundle information");if(null===u)throw new Error("Unable to load application facets");return r!==xl.LOADING&&u?s.createElement(Fl,{bundleTabs:c,bundle:r,applications:u}):s.createElement(Nt,null)},Gl=n.p+"fonts/notifications-product-icon.svg";var Bl;!function(e){e.USER="user",e.RUNNING="running",e.INTEGRATION="integration",e.USERS="users",e.BELL="bell"}(Bl||(Bl={}));const Ml=({icon:e,heading:t,linkTitle:n,linkTarget:l,expandableContent:i,isRedirect:o})=>{const r=(0,p.useNavigate)();let s=null;const[u,d]=c().useState(!1);switch(e){case Bl.USER:s=c().createElement(L.UserIcon,{className:"pf-u-primary-color-100"});break;case Bl.RUNNING:s=c().createElement(L.RunningIcon,{className:"pf-u-primary-color-100"});break;case Bl.INTEGRATION:s=c().createElement(L.IntegrationIcon,{className:"pf-u-primary-color-100"});break;case Bl.USERS:s=c().createElement(L.UsersIcon,{className:"pf-u-primary-color-100"});break;case Bl.BELL:s=c().createElement(L.BellIcon,{className:"pf-u-primary-color-100"})}return c().createElement(c().Fragment,null,c().createElement(a.DataListItem,{"aria-labelledby":"item1",isExpanded:u},c().createElement(a.DataListItemRow,{className:"pf-u-align-items-center"},c().createElement(a.DataListToggle,{isExpanded:u,id:"toggle1","aria-controls":"expand1",onClick:()=>d(!u)}),c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"cell-"+e.toString().toLowerCase()},c().createElement("div",null,c().createElement(a.Flex,{className:"pf-u-flex-nowrap"},c().createElement(a.FlexItem,{className:"pf-u-align-self-center"},c().createElement(a.Icon,{size:"lg"},s)),c().createElement(a.Divider,{orientation:{default:"vertical"}}),c().createElement(a.FlexItem,{className:"pf-u-align-self-center"},c().createElement(a.Title,{headingLevel:"h4"},t)))))]}),n&&l&&c().createElement(a.DataListAction,{"aria-labelledby":"item1 action1",id:"action1","aria-label":"Actions",isPlainButtonAction:!0},c().createElement(a.Button,{component:"a",href:l,variant:"link",onClick:e=>{o||(e.preventDefault(),r(l.replace("/preview","")))}},n))),c().createElement(a.DataListContent,{"aria-label":t+" - Detailed Explanation",id:"expand1",isHidden:!u},c().createElement("p",null,i))))},Ul={overview:()=>"/",configureEvents:()=>"/configure-events",integrations:()=>"/integrations",notifications:e=>`/${e}`,eventLog:e=>"/eventlog"+(e?`?bundle=${e}`:""),splunk:()=>"/integrations/splunk-setup"},Vl=[{path:"/",component:()=>null},{path:Ul.integrations(),component:A},{path:Ul.eventLog(),component:It},{path:Ul.notifications(":bundleName"),component:Rl},{path:Ul.splunk(),component:()=>{const[e,t]=(0,s.useState)(2),[n,i]=(0,s.useState)(!1),[o,r]=(0,s.useState)("info"),[u,d]=(0,s.useState)(""),[m,p]=(0,s.useState)(""),[E,g]=(0,s.useState)(["Logs from the automation would appear here\n"]),[v,h]=(0,s.useState)();return c().createElement(c().Fragment,null,c().createElement(l.PageHeader,null,c().createElement(ne,null)),c().createElement(S,null,c().createElement(a.Card,null,c().createElement(a.CardBody,null,c().createElement(a.Split,{hasGutter:!0},c().createElement(a.SplitItem,null,c().createElement(a.ProgressStepper,{isVertical:!0},c().createElement(a.ProgressStep,{isCurrent:1===e,variant:"success",description:"Create Index and HEC",id:"step1-splunk-app-step",titleId:"step1-splunk-app-step","aria-label":"completed Splunk app step (step 1)"},"Step 1"),c().createElement(a.ProgressStep,{isCurrent:2===e,icon:2===e&&n?c().createElement(L.InProgressIcon,null):void 0,variant:e<2?"info":o,description:"Configure Splunk integration in Insights",id:"step2-setup-step",titleId:"step2-setup-step","aria-label":"setup step (step 2)"},"Step 2"),c().createElement(a.ProgressStep,{isCurrent:3===e,variant:e<3?"pending":o,description:"Review",id:"step3-review-step",titleId:"step3-review-step","aria-label":"review step (step 3)"},"Step 3"))),c().createElement(a.Divider,{isVertical:!0}),c().createElement(a.SplitItem,{isFilled:!0},2===e&&c().createElement(X,{setStep:t,stepIsInProgress:n,setStepIsInProgress:i,stepVariant:o,setStepVariant:r,hecToken:u,setHecToken:d,splunkServerHostName:m,setHostName:p,automationLogs:E,setAutomationLogs:g,setError:h}),3===e&&c().createElement(O,{isSuccess:"success"===o,error:v})))))))}}],_l=[{path:Ul.overview(),component:()=>{const e=(0,p.useNavigate)(),t=(0,m.useFlag)("platform.sources.integrations"),[n,o]=c().useState(null),{auth:r,isBeta:s,getBundle:u}=(0,i.Z)(),d=(0,m.useFlag)("platform.notifications.overhaul");return c().useEffect((()=>{r&&(async()=>{const{identity:{user:e}}=await r.getUser();o(e.is_org_admin)})()}),[r]),c().createElement(c().Fragment,null,c().createElement(l.PageHeader,null,c().createElement(a.Flex,{className:"pf-u-flex-nowrap"},c().createElement(a.FlexItem,null,c().createElement("img",{src:Gl})),c().createElement(a.Divider,{orientation:{default:"vertical"}}),c().createElement(a.FlexItem,{className:"pf-u-align-self-flex-start"},c().createElement(l.PageHeaderTitle,{title:"Notifications",className:"pf-u-mb-sm"}),c().createElement("p",{className:"pf-u-mb-sm"},"A standardized way of notifying users of events for supported services on the Hybrid Cloud Console."),n&&c().createElement("a",{href:"#"},"Learn more ",c().createElement(L.ExternalLinkAltIcon,null))))),c().createElement(l.Main,null,n?c().createElement(c().Fragment,null,c().createElement(a.Card,{className:"pf-u-mb-lg"},c().createElement(a.Grid,{hasGutter:!0},c().createElement(a.GridItem,{sm:12,md:6,lg:8},c().createElement(a.CardTitle,null,c().createElement(a.Title,{headingLevel:"h2"},"Manage events for your organization")),c().createElement(a.CardBody,null,c().createElement("p",null,"This service allows you to configure which notifications different users within your organization will be entitled to receiving. To do this, create behavior groups and apply them to different events. Users will be able to opt-in or out of receiving authorized event notifications in their ",c().createElement("a",{href:"#"},"User Preferences"),".")),c().createElement(a.CardFooter,null,c().createElement(a.Button,{variant:"primary",component:"a",href:`${s()?"/preview":""}/${u()}/notifications/configure-events`,isLarge:!0,onClick:t=>{t.preventDefault(),e(`/${u()}/notifications/configure-events`)}},"Configure events"))),c().createElement(a.GridItem,{md:6,lg:4,className:"pf-u-display-none pf-u-display-block-on-md pf-c-card__cover-image"})))):c().createElement(c().Fragment,null,c().createElement(a.Title,{headingLevel:"h2",className:"pf-u-mb-md"},"Get started with Notifications on the Hybrid Cloud Console"),c().createElement(a.Grid,{hasGutter:!0,className:"pf-u-mb-lg"},c().createElement(a.GridItem,{sm:12,md:6},c().createElement(a.Card,{className:"pf-u-h-100"},c().createElement(a.CardTitle,null,c().createElement(a.Flex,{className:"pf-u-flex-nowrap"},c().createElement(a.FlexItem,null,c().createElement(a.Icon,{size:"lg"},c().createElement(L.UserIcon,{className:"pf-u-primary-color-100"}))),c().createElement(a.FlexItem,null,c().createElement(a.Title,{headingLevel:"h2"},"Manage your own notifications with My User Preferences")))),c().createElement(a.CardBody,null,c().createElement("p",null,"This service allows you to opt-in and out of receiving notifications. Your Organization Administrator has configured which notifications you can or can not receive in their Settings.")),c().createElement(a.CardFooter,null,c().createElement(a.Button,{variant:"primary",isLarge:!0,component:"a",href:`${s()?"/preview":""}/${u()}/notifications/user-preferences`,onClick:t=>{t.preventDefault(),e(`/${u()}/notifications/user-preferences`)}},"Go to My User Preferencesss")))),c().createElement(a.GridItem,{sm:12,md:6},c().createElement(a.Card,{className:"pf-u-h-100"},c().createElement(a.CardTitle,null,c().createElement(a.Flex,{className:"pf-u-flex-nowrap"},c().createElement(a.FlexItem,null,c().createElement(a.Icon,{size:"lg"},c().createElement(L.RunningIcon,{className:"pf-u-primary-color-100"}))),c().createElement(a.FlexItem,null,c().createElement(a.Title,{headingLevel:"h2"},"Monitor all fired events with the Event log")))),c().createElement(a.CardBody,null,c().createElement("p",null,"See all the events affecting your organization and view details around the events fired.")),c().createElement(a.CardFooter,null,!d&&c().createElement(a.Button,{variant:"secondary",isLarge:!0,component:"a",href:`${s()?"/preview":""}/${u()}/notifications/user-preferences`,onClick:t=>{t.preventDefault(),e(`/${u()}/notifications/eventlog`)}},"View Event log")))))),n?c().createElement(c().Fragment,null,c().createElement(a.Title,{headingLevel:"h2",className:"pf-u-mb-md"},"Supporting features"),c().createElement(a.DataList,{"aria-label":"Supporting features list",className:"pf-u-mb-lg"},c().createElement(Ml,{icon:Bl.USER,heading:"Manage your own notifications with My User Preferences",linkTitle:"Go to My User Preferences",linkTarget:`${s()?"/preview":""}/${u()}/notifications/user-preferences`,expandableContent:"This service allows you to opt-in and out of receiving notifications. Your Organization\n                            Administrator has configured which notifications you can or can not receive in their Settings."}),c().createElement(Ml,{icon:Bl.RUNNING,heading:"Monitor all fired events with the Event log",linkTitle:"View Event log",linkTarget:`${s()?"/preview":""}/${u()}/notifications/eventlog `,expandableContent:"See all the events affecting your organization and view details around the events fired."}),c().createElement(Ml,{icon:Bl.INTEGRATION,heading:"Set up Integrations to customize your notifications",linkTitle:"Set up Integrations",...t&&{isRedirect:!0},linkTarget:t?(s()?"/preview":"")+"/settings/sources?category=Integrations":`${s()?"/preview":""}/${u()}/notifications/integrations`,expandableContent:"Notifications and integrations services work together to transmit messages to third-party application\n                    endpoints, such as instant messaging platforms and external ticketing systems, when triggering events occur. Integrations\n                    include Splunk, Slack, ServiceNow, and more."}),c().createElement(Ml,{icon:Bl.USERS,heading:"Create behavior groups to easily notify the right users",linkTitle:"Create new behavior group",linkTarget:`${s()?"/preview":""}/${u()}/notifications/configure-events`,expandableContent:"Behavior groups are made up of action/recipient pairings that allow you to configure which notification\n                    actions different users will be able to receive. Once you've created a behavior group, you can assign it to an event. You\n                    may also prevent users from changing assigned actions by locking action/recipient pairings when creating or editing behavior\n                    groups."}))):c().createElement(c().Fragment,null,c().createElement(a.DataList,{"aria-label":"Supporting features list",className:"pf-u-mb-lg"},c().createElement(Ml,{icon:Bl.BELL,heading:"About Notifications",expandableContent:"Notifications are a way for users to be alerted of important events that occur in the Hybrid Cloud\n                            Console. You can receive notifications within the console via the notifications drawer as well as through email and\n                            third-party integrations, such as Slack or ServiceNow."}))),c().createElement(a.Title,{headingLevel:"h2",className:"pf-u-mb-md"},"Recommended content"),n?c().createElement(c().Fragment,null,c().createElement(a.DataList,{"aria-label":"Recommended content list",className:"pf-u-mb-lg"},c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row1-col1"},c().createElement("span",null,"Configuring notifications and integrations")),c().createElement(a.DataListCell,{key:"row1-col2"},c().createElement(a.Label,{color:"orange"},"Documentation")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row1-col3"},c().createElement("a",{href:"#"},"View documentation ",c().createElement(L.ExternalLinkAltIcon,null)))]}))),c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row2-col1"},c().createElement("span",null,"Configuring integrations and events")),c().createElement(a.DataListCell,{key:"row2-col2"},c().createElement(a.Label,{color:"orange"},"Documentation")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row2-col3"},c().createElement("a",{href:"#"},"View documentation ",c().createElement(L.ExternalLinkAltIcon,null)))]}))),c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row3-col1"},c().createElement("span",null,"Restricting access to a service to a team")),c().createElement(a.DataListCell,{key:"row3-col2"},c().createElement(a.Label,{color:"green"},"Quick start")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row3-col3"},c().createElement("a",{href:"#"},"Begin Quick start ",c().createElement(L.ArrowRightIcon,null)))]}))))):c().createElement(c().Fragment,null,c().createElement(a.DataList,{"aria-label":"Recommended content list",className:"pf-u-mb-lg"},c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row1-col1"},c().createElement("span",null,"Configuring notifications and integrations")),c().createElement(a.DataListCell,{key:"row1-col2"},c().createElement(a.Label,{color:"orange"},"Documentation")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row1-col3"},c().createElement("a",{href:"#"},"View documentation ",c().createElement(L.ExternalLinkAltIcon,null)))]}))),c().createElement(a.DataListItem,null,c().createElement(a.DataListItemRow,null,c().createElement(a.DataListItemCells,{dataListCells:[c().createElement(a.DataListCell,{key:"row2-col1"},c().createElement("span",null,"Configuring sources for Red Hat services")),c().createElement(a.DataListCell,{key:"row2-col2"},c().createElement(a.Label,{color:"orange"},"Documentation")),c().createElement(a.DataListCell,{alignRight:!0,isFilled:!1,key:"row2-col3"},c().createElement("a",{href:"#"},"View documentation ",c().createElement(L.ExternalLinkAltIcon,null)))]}))))),c().createElement("a",{href:"#",className:"pf-u-mb-lg"},"View all Settings Learning Resources")))}},{path:Ul.integrations(),component:A},{path:Ul.configureEvents(),component:Rl},{path:Ul.eventLog(),component:It}],$l=()=>{const e=(0,m.useFlag)("platform.notifications.overhaul"),t=s.useMemo((()=>e?_l:Vl),[e]);return s.createElement(p.Routes,null,t.map((e=>s.createElement(p.Route,{key:e.path,path:e.path,element:s.createElement(I,null,s.createElement(e.component,null))}))),!e&&s.createElement(p.Route,{path:"*",element:s.createElement(p.Navigate,{to:"/",replace:!0})}))};var Zl=n(54926),Hl=n(56335),zl=n(3121);const ql="HH:mm",Wl="hh:mma",Ql=(0,u.style)({padding:8}),Yl=()=>{const{updateDocumentTitle:e}=(0,i.Z)();null==e||e("Notifications");const{rbac:t,server:n,isOrgAdmin:c}=(0,zl.q)(),u=(0,o.getInsights)(),[m,p]=s.useState(!1),g=s.useCallback((e=>{e?(u.chrome.getEnvironmentOriginal=u.chrome.getEnvironment,u.chrome.getEnvironment=()=>"ci"):u.chrome.getEnvironment=u.chrome.getEnvironmentOriginal,p(e)}),[u]);if(!t||!n)return s.createElement(Nt,null);if(n.status===Zl.U.MAINTENANCE){const e=(0,r.Z)((0,o.toUtc)(n.from),ql),t=(0,r.Z)((0,o.toUtc)(n.to),ql),a=(0,r.Z)(n.from,Wl),i=(0,r.Z)(n.to,Wl),c=(0,r.Z)(n.to,"O");return s.createElement(l.Maintenance,{utcStartTime:e,utcEndTime:t,startTime:a,endTime:i,timeZone:c})}return s.createElement(E.I.Provider,{value:{rbac:t,server:n,isOrgAdmin:!!c}},s.createElement(Hl.d,null,s.createElement(d.q,null),s.createElement(o.InsightsEnvDetector,{insights:u,onEnvironment:mn.ok},s.createElement(o.RenderIfTrue,null,s.createElement(a.Switch,{className:Ql,isChecked:m,onChange:g,labelOff:"Enable experimental features",label:"Disable experimental features"}))),s.createElement($l,null)))}}}]);
//# sourceMappingURL=../sourcemaps/5595.d3644b0b1cb6f6be95c1f4eb00e70c27.js.map